(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{568:function(s,a,t){"use strict";t.r(a);var e=t(8),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),a("p",[s._v("查看表状态")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("hbase:003:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" is_enabled "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test_0104'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                                                                                                                                                                                                                          \nTook "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0072")]),s._v(" seconds                                                                                                                                                                                                            \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nhbase:004:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" is_disabled "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test_0104'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                                                                                                                                                                                                                          \nTook "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0061")]),s._v(" seconds                                                                                                                                                                                                            \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("发现表既不处于"),a("code",[s._v("enabel")]),s._v("也不处于"),a("code",[s._v("disable")])]),s._v(" "),a("p",[s._v("查看元数据表该表状态")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("hbase:009:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" get "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hbase:meta'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test_0104'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table:state'")]),s._v("\nCOLUMN                                                   CELL                                                                                                                                                                  \n table:state                                             "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timestamp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("-01-04T16:12:46.001, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("x08"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("x02                                                                                                                     \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTook "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0053")]),s._v(" seconds   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("可以看到他的值是\\x08\\x02 (disabling)，但是正常的值是\\x08\\x00(Enabled)或者\\x08\\x01(Disabled)")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("Hbase webUI")]),s._v("中查看该表发现是处于"),a("code",[s._v("disabling")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2023/03/10/vnzjuiHIR2oDFyg.png",alt:"image-20230104162215662"}})]),s._v(" "),a("h4",{attrs:{id:"通过list-locks查看是否上锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过list-locks查看是否上锁"}},[s._v("#")]),s._v(" 通过list_locks查看是否上锁")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("hbase:011:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" list_locks\nNAMESPACE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                                                                                                                                                             \nLock type: SHARED, count: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("                                                                                                                                                                                                    \n                                                                                                                                                                                                                               \nTABLE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test_0104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("发现表的确是锁住了")]),s._v(" "),a("p",[s._v("随后在WebUI中看到了RIT问题")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2023/03/10/ex3NiTmO5ADZkHK.png",alt:"image-20230104162632296"}})]),s._v(" "),a("p",[s._v("Region-In-Transition说的是Region变迁机制，实际上是指在一次特定操作行为中Region状态的变迁。")]),s._v(" "),a("h2",{attrs:{id:"解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),a("h3",{attrs:{id:"使用hbck2工具修复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用hbck2工具修复"}},[s._v("#")]),s._v(" 使用HBCK2工具修复")]),s._v(" "),a("ul",[a("li",[s._v("下载HBCK2代码")])]),s._v(" "),a("p",[s._v("https://github.com/apache/hbase-operator-tools")]),s._v(" "),a("blockquote",[a("p",[s._v("git使用命令：git clone https://github.com/apache/hbase-operator-tools.git")])]),s._v(" "),a("ul",[a("li",[s._v("修改适配的Hbase版本")])]),s._v(" "),a("p",[s._v("修改"),a("code",[s._v("pom.xml")]),s._v("中"),a("code",[s._v("hbase.verion")]),s._v("版本号为我们集群的版本")]),s._v(" "),a("ul",[a("li",[s._v("编译打包")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mvn clean package "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DskipTests")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("打包后生成工具目录为"),a("code",[s._v("hbase-operator-tools/hbase-hbck2/target/hbase-hbck2-1.3.0-SNAPSHOT.jar")])]),s._v(" "),a("ul",[a("li",[s._v("将工具上传到集群总任意目录")])]),s._v(" "),a("p",[s._v("上传到能够执行hbase命令机器")]),s._v(" "),a("ul",[a("li",[s._v("工具使用方法")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("hbase hbck "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" hbase-hbck2-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${hbck2-version}")]),s._v(".jar\n或\nhbase "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config")]),s._v(" /etc/hbase-conf hbck "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" hbase-hbck2-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${hbck2-version}")]),s._v(".jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("执行修复命令")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("hbase hbck "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" hbase-hbck2-1.3.0-SNAPSHOT.jar setTableState "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test_0104'")]),s._v(" DISABLED\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时查看表的状态是恢复到了disable")]),s._v(" "),a("p",[s._v("参考：https://www.modb.pro/db/579496")])])}),[],!1,null,null,null);a.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{472:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("[toc]")]),s._v(" "),t("h2",{attrs:{id:"组件启动顺序设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#组件启动顺序设置"}},[s._v("#")]),s._v(" 组件启动顺序设置")]),s._v(" "),t("p",[s._v("配置文件名为"),t("code",[s._v("role_command_order.json")]),s._v("，位置在自定义服务的根目录下。")]),s._v(" "),t("p",[s._v("该配置文件主要实现功能就是组织各组件启动、安装、停止等执行的顺序，如启动A服务前必须启动B服务，停止B服务前必须停止A服务等。")]),s._v(" "),t("p",[t("strong",[s._v("在服务器位置")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("role_command_order.json 文件在  /var/lib/ambari-server/resources/common-services 目录的每个服务下面有，每个 Stack  目录下的服务下面也有 role_command_order.json 。相同的配置，Stack 下面的会覆盖全局的。不同的配置，Ambari  会拼接在一起。高版本的 Stack 会继承低版本的配置。相同的也会覆盖，不同的会合并 。\n")])])]),t("h3",{attrs:{id:"配置文件格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件格式"}},[s._v("#")]),s._v(" 配置文件格式")]),s._v(" "),t("p",[s._v("拿Hbase的配置来举例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"general_deps"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_comment"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dependencies for HBase"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"HBASE_REGIONSERVER-START"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBASE_MASTER-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" # 在启动 HBASE_REGIONSERVER 之前，启动HBASE_MASTER\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"HBASE_SERVICE_CHECK-SERVICE_CHECK"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBASE_MASTER-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBASE_REGIONSERVER-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" # 执行HBASE_SERVICE_CHECK 服务检查前，需要启动HBASE_MASTER和HBASE_REGIONSERVER\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"HBASE_MASTER-STOP"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBASE_REGIONSERVER-STOP"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" # 在停止HBASE_MASTER服务前，停止HBASE_REGIONSERVER\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"HBASE_MASTER-START"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NAMENODE-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DATANODE-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ZOOKEEPER_SERVER-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RANGER_USERSYNC-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RANGER_KMS_SERVER-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"PHOENIX_QUERY_SERVER-START"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBASE_MASTER-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("格式如下")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_comment"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Section 1 comment"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"section_name_1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_comment"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Section containing role command orders"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"<DEPENDENT_COMPONENT_1>-<COMMAND>"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<DEPENDS_ON_COMPONENT_1>-<COMMAND>"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<DEPENDS_ON_COMPONENT_1>-<COMMAND>"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"<DEPENDENT_COMPONENT_2>-<COMMAND>"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<DEPENDS_ON_COMPONENT_3>-<COMMAND>"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    ...\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_comment"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Next section comment"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("strong",[s._v("section_name_1 取值")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("general_deps")]),s._v(" "),t("th",[s._v("Command orders are applied in all situations")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("namenode_optional_ha")]),s._v(" "),t("td",[s._v("Command orders are applied when HDFS service is installed and JOURNALNODE component exists (HDFS HA is enabled)")])]),s._v(" "),t("tr",[t("td",[s._v("optional_glusterfs")]),s._v(" "),t("td",[s._v("Command orders are applied when cluster has instance of GLUSTERFS service")])]),s._v(" "),t("tr",[t("td",[s._v("optional_no_glusterfs")]),s._v(" "),t("td",[s._v("Command orders are applied when cluster does not have instance of GLUSTERFS service")])]),s._v(" "),t("tr",[t("td",[s._v("resourcemanager_optional_ha")]),s._v(" "),t("td",[s._v("Command orders are applied when YARN service is installed and multiple  RESOURCEMANAGER host-components exist (YARN HA is enabled)")])])])]),s._v(" "),t("p",[t("strong",[s._v("<COMMAND>取值")])]),s._v(" "),t("ul",[t("li",[s._v("INSTALL")]),s._v(" "),t("li",[s._v("UNINSTALL")]),s._v(" "),t("li",[s._v("START")]),s._v(" "),t("li",[s._v("RESTART")]),s._v(" "),t("li",[s._v("STOP")]),s._v(" "),t("li",[s._v("EXECUTE")]),s._v(" "),t("li",[s._v("ABORT")]),s._v(" "),t("li",[s._v("UPGRADE")]),s._v(" "),t("li",[s._v("SERVICE_CHECK")]),s._v(" "),t("li",[s._v("CUSTOM_COMMAND")]),s._v(" "),t("li",[s._v("ACTIONEXECUTE")])]),s._v(" "),t("p",[t("strong",[s._v("规则配置样例")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v('"HIVE_METASTORE-START": ["MYSQL_SERVER-START", "NAMENODE-START"]')]),s._v(" "),t("th",[s._v("Start MySQL and NameNode components before starting Hive Metastore")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v('"MAPREDUCE_SERVICE_CHECK-SERVICE_CHECK": ["NODEMANAGER-START", "RESOURCEMANAGER-START"],')]),s._v(" "),t("td",[s._v("MapReduce service check needs ResourceManager and NodeManagers started")])]),s._v(" "),t("tr",[t("td",[s._v('"ZOOKEEPER_SERVER-STOP" : ["HBASE_MASTER-STOP", "HBASE_REGIONSERVER-STOP", "METRICS_COLLECTOR-STOP"],')]),s._v(" "),t("td",[s._v("Before stopping ZooKeeper servers, make sure HBase Masters, HBase RegionServers and AMS Metrics Collector are stopped.")])])])]),s._v(" "),t("h2",{attrs:{id:"验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),t("p",[s._v("配置启动顺序如下：SPARK2_JOBHISTORYSERVER -> BACKEND -> FRONTEND")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"general_deps"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_comment"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dependencies for DORIS"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"BACKEND-START"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SPARK2_JOBHISTORYSERVER-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"FRONTEND-START"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BACKEND-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"DORIS_SERVICE_CHECK-SERVICE_CHECK"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FRONTEND-START"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("没有配置的时候安装完成默认启动顺序如下")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/04/08/QYAjNUb8LICeihm.png",alt:"image-20240306110337855"}})]),s._v(" "),t("p",[s._v("单独启动Doirs服务是这样的")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/04/08/XPB8VmdaHyZNklj.png",alt:"image-20240306110704252"}})]),s._v(" "),t("p",[s._v("将自定义服务更新到服务器上，更新完配置再次安装服务可以看到顺序按照我们设置的运行")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/04/08/2NwnIDrBTeSqUH8.png",alt:"image-20240306144753588"}})]),s._v(" "),t("p",[s._v("单独启动服务发现顺序也按照我们设置的运行")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/04/08/dq7C1u8HmOIgZR3.png",alt:"image-20240306145049500"}})]),s._v(" "),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),t("p",[s._v("https://cwiki.apache.org/confluence/display/AMBARI/How-To+Define+Stacks+and+Services#How-ToDefineStacksandServices-RoleCommandOrder")]),s._v(" "),t("h2",{attrs:{id:"相关演示代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关演示代码"}},[s._v("#")]),s._v(" 相关演示代码")]),s._v(" "),t("p",[s._v("https://download.csdn.net/download/zhangshenghang/88917467")])])}),[],!1,null,null,null);t.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[267],{633:function(a,s,t){"use strict";t.r(s);var e=t(8),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("[toc]")]),a._v(" "),s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),s("p",[a._v("Apache 软件基金会发布了包含许多新特性和改进的 Kafka 3.3.1。这是第一个标志着可以在生产环境中使用 KRaft（Kafka Raft）共识协议的版本。在几年的开发过程中，它先是在 Kafka 2.8 早期访问版本中发布，然后又在 Kafka 3.0 预览版本中发布。")]),a._v(" "),s("p",[a._v("KRaft 是一种共识协议，可以直接在 Kafka 中管理元数据。元数据的管理被整合到了 Kafka 当中，而不需要使用像 ZooKeeper 这样的第三方工具，这大大简化了 Kafka 的架构。这种新的 KRaft 模式提高了分区的可伸缩性和弹性，同时简化了 Kafka 的部署，现在可以不依赖 ZooKeeper 单独部署 Kafka 了。")]),a._v(" "),s("p",[a._v("KRaft 使用了 Raft 共识算法的一种基于事件的变体，因此得名。")]),a._v(" "),s("h2",{attrs:{id:"基础环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础环境"}},[a._v("#")]),a._v(" 基础环境")]),a._v(" "),s("h3",{attrs:{id:"服务器三台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器三台"}},[a._v("#")]),a._v(" 服务器三台")]),a._v(" "),s("p",[a._v("172.16.1.1\tbigdata-1")]),a._v(" "),s("p",[a._v("172.16.1.2\tbigdata-2")]),a._v(" "),s("p",[a._v("172.16.1.3\tbigdata-3")]),a._v(" "),s("p",[a._v("JDK 1.8")]),a._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),s("h3",{attrs:{id:"下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[a._v("#")]),a._v(" 下载")]),a._v(" "),s("p",[a._v("下载地址："),s("a",{attrs:{href:"https://downloads.apache.org/kafka/3.4.0/kafka_2.12-3.4.0.tgz",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://downloads.apache.org/kafka/3.4.0/kafka_2.12-3.4.0.tgz"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("在"),s("code",[a._v("/opt")]),a._v("目录下解压")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" kafka_2.12-3.4.0.tgz \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"安装-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),s("p",[a._v("进入"),s("code",[a._v("/opt/kafka_2.12-3.4.0/config/kraft")]),a._v("目录")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/kafka_2.12-3.4.0/config/kraft\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("修改"),s("code",[a._v("server.properties")]),a._v("配置文件")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("process.roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("broker,controller")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 节点ID，自己设置每个节点的值要不同")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("node.id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Controller节点配置，用于管理状态的节点（替换Zookeeper作用）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("controller.quorum.voters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1@172.16.1.1:9093,2@172.16.1.2:9093,3@172.16.1.3:9093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("listeners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://:9092,CONTROLLER://:9093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("inter.broker.listener.name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用IP端口，每个节点填写自己节点的IP")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("advertised.listeners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://172.16.1.1:9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("controller.listener.names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("CONTROLLER")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("listener.security.protocol.map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("num.network.threads")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("num.io.threads")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("socket.send.buffer.bytes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("102400")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("socket.receive.buffer.bytes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("102400")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("socket.request.max.bytes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("104857600")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("num.partitions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("num.recovery.threads.per.data.dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("offsets.topic.replication.factor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("transaction.state.log.replication.factor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("transaction.state.log.min.isr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log.retention.hours")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("168")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log.segment.bytes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1073741824")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log.retention.check.interval.ms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("300000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 数据存储位置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log.dirs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/opt/kafka/data")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br")])]),s("p",[a._v("三台服务器配置文件都需要修改，不同的地方为")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 节点ID，自己设置每个节点的值要不同")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("node.id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用IP端口，每个节点填写自己节点的IP")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("advertised.listeners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://172.16.1.1:9092")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"初始化集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化集群"}},[a._v("#")]),a._v(" 初始化集群")]),a._v(" "),s("blockquote",[s("p",[a._v("在其中一台服务器上执行下面命令生成一个uuid")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" bin/kafka-storage.sh random-uuid\n 2kBbskpoS0aYrSeJk-HVfw\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("用该uuid格式化"),s("code",[a._v("kafka")]),a._v("存储目录，三台服务器都要执行以下命令")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sh bin/kafka-storage.sh format -t 2kBbskpoS0aYrSeJk-HVfw -c config/kraft/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"启动集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动集群"}},[a._v("#")]),a._v(" 启动集群")]),a._v(" "),s("p",[a._v("三台都需要启动")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" bin/kafka-server-start.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-daemon")]),a._v(" config/kraft/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("在日志中可以查看到启动成功")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[2023-04-06 21:10:22,705] INFO [KafkaRaftServer nodeId=1] Kafka Server started (kafka.server.KafkaRaftServer)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("在进程中可以看到Kafka进程")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# jps\n29128 Jps\n28875 Kafka\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[a._v("#")]),a._v(" 验证")]),a._v(" "),s("h4",{attrs:{id:"创建topic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建topic"}},[a._v("#")]),a._v(" 创建Topic")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# sh bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic test --partitions 3 --replication-factor 3")]),a._v("\nCreated topic test.\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"查看topic详情"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看topic详情"}},[a._v("#")]),a._v(" 查看Topic详情")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# sh bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe test  ")]),a._v("\nTopic: "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("     TopicId: LB20VbGWTvOi7IgVqTsC3g PartitionCount: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("       ReplicationFactor: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("    Configs: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("segment.bytes")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1073741824")]),a._v("\n        Topic: "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("     Partition: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("    Leader: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("       Replicas: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1,2")]),a._v(",3 Isr: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1,2")]),a._v(",3\n        Topic: "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("     Partition: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("    Leader: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("       Replicas: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2,3")]),a._v(",1 Isr: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2,3")]),a._v(",1\n        Topic: "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("     Partition: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("    Leader: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("       Replicas: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3,1")]),a._v(",2 Isr: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3,1")]),a._v(",2\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"运行之后额外添加一个数据目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行之后额外添加一个数据目录"}},[a._v("#")]),a._v(" 运行之后额外添加一个数据目录")]),a._v(" "),s("p",[a._v("添加数据目录不能直接更改配置直接运行，直接运行会提示下面这个错误")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("org.apache.kafka.common.KafkaException: No `meta.properties` found in /data2 (have you run `kafka-storage.sh` to format the directory?)\n        at kafka.server.BrokerMetadataCheckpoint$.$anonfun$getBrokerMetadataAndOfflineDirs$2(BrokerMetadataCheckpoint.scala:179)\n        at scala.collection.Iterator.foreach(Iterator.scala:943)\n        at scala.collection.Iterator.foreach$(Iterator.scala:943)\n        at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)\n        at scala.collection.IterableLike.foreach(IterableLike.scala:74)\n        at scala.collection.IterableLike.foreach$(IterableLike.scala:73)\n        at scala.collection.AbstractIterable.foreach(Iterable.scala:56)\n        at kafka.server.BrokerMetadataCheckpoint$.getBrokerMetadataAndOfflineDirs(BrokerMetadataCheckpoint.scala:168)\n        at kafka.server.KafkaRaftServer$.initializeLogDirs(KafkaRaftServer.scala:141)\n        at kafka.server.KafkaRaftServer.<init>(KafkaRaftServer.scala:57)\n        at kafka.Kafka$.buildServer(Kafka.scala:83)\n        at kafka.Kafka$.main(Kafka.scala:91)\n        at kafka.Kafka.main(Kafka.scala)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("p",[a._v("需要先执行下面这个命令,重新加载配置的目录，然后再启动kafka服务")]),a._v(" "),s("blockquote",[s("p",[a._v("cluster-id 在原配置的data目录下 meta.properties 文件中")]),a._v(" "),s("p",[a._v("--ignore-formatted 命令会跳过之前已经创建的目录")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("> bin/kafka-storage.sh format --ignore-formatted --config /data/kafka_2.12-3.5.1/config/kraft/server.properties --cluster-id Bu0LsdAcTc2mZbecpe6fUg\n\nFormatting /data2 with metadata.version 3.5-IV2.\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);
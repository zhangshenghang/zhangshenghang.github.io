(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{469:function(a,s,t){"use strict";t.r(s);var e=t(8),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("[toc]")]),a._v(" "),s("h2",{attrs:{id:"日志输出调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志输出调试"}},[a._v("#")]),a._v(" 日志输出调试")]),a._v(" "),s("h3",{attrs:{id:"代码中日志输出查看"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码中日志输出查看"}},[a._v("#")]),a._v(" 代码中日志输出查看")]),a._v(" "),s("p",[a._v("在开发时代码中为了方便调试会需要加一些日志输出，如下代码：")]),a._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" resource_management"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("logger "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" Logger\n\nconfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("get_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nstack_root "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("get_stack_root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\ntmp_dir "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("get_tmp_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nLogger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"sync info : "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("在WebUI中执行时的日志：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2024/04/08/lDNfUoL3xsu1kBW.png",alt:"image-20240220175756036"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2024/04/08/I9DRFEpXbwzUHV4.png",alt:"image-20240220175810845"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2024/04/08/1T3JhXbBi9c4tqP.png",alt:"image-20240220175954918"}})]),a._v(" "),s("blockquote",[s("p",[a._v("tip: 也可以在代码中直接使用print('xxxx')进行日志输出，输出结果和上面就差一个时间，上面输出的内容去掉日志前面的时间就是print方法输出")])]),a._v(" "),s("h3",{attrs:{id:"终极调试方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#终极调试方法"}},[a._v("#")]),a._v(" 终极调试方法")]),a._v(" "),s("p",[a._v("如果我们使用日志输出招不到日志在哪个文件，我们可以使用下面这个暴力方法，直接创建一个文件，将想要打印的日志写入进去")]),a._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[a._v("File"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/var/run/test/file.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n         mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0644")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n         content"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'日志内容'")]),a._v("\n         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h2",{attrs:{id:"开发修改代码发布到服务器如何快速生效"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发修改代码发布到服务器如何快速生效"}},[a._v("#")]),a._v(" 开发修改代码发布到服务器如何快速生效")]),a._v(" "),s("p",[a._v("常规调试的步骤是：")]),a._v(" "),s("p",[a._v("步骤1:卸载服务")]),a._v(" "),s("p",[a._v("步骤2:重启 ambari-server 进程，执行命令：ambari-server restart")]),a._v(" "),s("p",[a._v("步骤3:重装服务")]),a._v(" "),s("p",[a._v("下面针对修改每个不同的配置文件如何快速生效进行介绍:")]),a._v(" "),s("h3",{attrs:{id:"metainfo-xml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metainfo-xml"}},[a._v("#")]),a._v(" metainfo.xml")]),a._v(" "),s("p",[a._v("替换文件到 "),s("code",[a._v("ambari-server")]),a._v(" 所在节点的 "),s("code",[a._v("/var/lib/ambari-server/resources/stacks/HDP/3.1/services/DORIS")]),a._v(" 目录下，重启 ambari-server 后生效，无需重装所属服务。")]),a._v(" "),s("h3",{attrs:{id:"configuration-xxx-xml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-xxx-xml"}},[a._v("#")]),a._v(" configuration/xxx.xml")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("先卸载该服务")])]),a._v(" "),s("li",[s("p",[a._v("重启 ambari-server 服务进程。")])]),a._v(" "),s("li",[s("p",[a._v("再安装该服务，这时的 configuration/xxx.xml 文件才会生效。")])]),a._v(" "),s("li",[s("p",[a._v("如果是修改 xml 文件中的已有属性<name>，重启 ambari-server 后，被修改的属性就消失了，因为之前的属性被修改了，")])])]),a._v(" "),s("h3",{attrs:{id:"package-python代码调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#package-python代码调试"}},[a._v("#")]),a._v(" package - python代码调试")]),a._v(" "),s("ol",[s("li",[a._v("在"),s("code",[a._v("ambari-server")]),a._v("重启的过程中，它会将"),s("code",[a._v("common-services")]),a._v("和"),s("code",[a._v("stacks/HDP")]),a._v("等相关的服务部署脚本分发到"),s("code",[a._v("ambari-agent")]),a._v("节点的"),s("code",[a._v("/var/lib/ambari-agent/cache")]),a._v("目录下。")])]),a._v(" "),s("p",[a._v("不过"),s("code",[a._v("stacks/HDP/\\<version>/services/")]),a._v("目录下的服务，只会将"),s("code",[a._v("package")]),a._v("目录下的文件分发下来。")]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[a._v("然后等安装部署服务的时候，每个"),s("code",[a._v("ambari-agent")]),a._v("节点都分配了一些安装组件嘛，这时候执行的部署脚本就是用的各自节点"),s("code",[a._v("/var/lib/ambari-agent/cache")]),a._v("目录下的脚本。比如"),s("code",[a._v("DORIS")]),a._v(" ，就是执行的"),s("code",[a._v("/var/lib/ambari-agent/cache/stacks/HDP/3.1/services/DORIS")]),a._v("里面的文件。")])]),a._v(" "),s("li",[s("p",[a._v("知道了这种安装部署机制以后，比如你修改了"),s("code",[a._v("DORIS/package")]),a._v("下面的文件，你可以直接将文件替换到"),s("code",[a._v("/var/lib/ambari-agent/cache/stacks/HDP/3.1/services/DORIS/package")]),a._v("目录下，它是实时生效的，不用重启"),s("code",[a._v("ambari-server")]),a._v("和重装服务。")])])]),a._v(" "),s("blockquote",[s("p",[a._v("tip:")]),a._v(" "),s("p",[a._v("需要确认 package 下面的文件是哪个服务组件触发的。如果是"),s("code",[a._v("DORIS")]),a._v("这个组件用到文件，那么替换到这个组件所在节点的"),s("code",[a._v("/var/lib/ambari-agent/cache/stacks/HDP/3.1/services/DORIS")]),a._v("目录下。然后就可以重启"),s("code",[a._v("DORIS")]),a._v("服务组件，来看效果了。这样更节省时间。")])]),a._v(" "),s("h3",{attrs:{id:"alerts-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alerts-json"}},[a._v("#")]),a._v(" alerts.json")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("如果是修改 "),s("code",[a._v("alerts.json")]),a._v(" 文件内容，将其替换到ambari-server所在节点的"),s("code",[a._v("/var/lib/ambari-server/resources/stacks/HDP/3.1/services/DORIS")]),a._v("下。则需要重启 "),s("code",[a._v("Ambari Server")]),a._v(" ，之后，并卸载、重新安装服务，Ambari 会将新预定义的 Alert 信息保存到数据库中。")])]),a._v(" "),s("li",[s("p",[a._v("如果是修改 "),s("code",[a._v("SCRIPT")]),a._v(" 类型的 py 文件，则只需要将修改后的 py 文件放置到 告警组件所在机器的 "),s("code",[a._v("/var/lib/ambari-agent/cache/stacks/HDP/3.1/services/DORIS/package/alerts")]),a._v(" 目录下即可（以 DORIS 为例）。实时更新，不需要重启 "),s("code",[a._v("ambari-server")]),a._v(" ，大概等待一分钟后，程序刷新。")])])]),a._v(" "),s("h3",{attrs:{id:"quicklinks-quicklinks-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#quicklinks-quicklinks-json"}},[a._v("#")]),a._v(" quicklinks/quicklinks.json")]),a._v(" "),s("p",[a._v("将 "),s("code",[a._v("quicklinks.json")]),a._v(" 文件替换到 "),s("code",[a._v("ambari-server")]),a._v(" 节点的 "),s("code",[a._v("/var/lib/ambari-server/resources/stacks/HDP/3.1/services/DORIS/quicklinks")]),a._v(" 目录下，重启"),s("code",[a._v("ambari-server")]),a._v("即可生效，无需重装服务。")]),a._v(" "),s("h3",{attrs:{id:"widgets-json-与-metrics-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#widgets-json-与-metrics-json"}},[a._v("#")]),a._v(" widgets.json 与 metrics.json")]),a._v(" "),s("p",[a._v("有 widget 表会记录集群中的 widget 小部件信息，而且会随着你服务重装，这里面的信息也会越来越多。进而导致 ambari 页面上的")]),a._v(" "),s("p",[a._v("widget browser 里面有重复的 widget 。默认新的 widget 需要自己手动点击ADD按钮添加。")]),a._v(" "),s("p",[a._v("首次 widgets.json 和 metrics.json 文件上传到服务器后，仅需重启 ambari-server 即可生效。后续的 widgets.json 和 metrics.json 文件如果要修改的话，均需要重启 ambari-server 和 重装服务 才可生效。")]),a._v(" "),s("p",[a._v("但是，生效以后，需要在 “widget Browser” 里面手动添加最新的 widget 部件。默认，ambari 会一直展示旧的数据。这些 widget 部件信息存储在 widget 这个表中。所以需要在 “widget Browser” 里面手动添加最新的 widget 部件。")]),a._v(" "),s("h3",{attrs:{id:"themes-theme-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#themes-theme-json"}},[a._v("#")]),a._v(" themes/theme.json")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("在 ambari-server 所在主机上的自定义服务目录中替换 theme json 文件（主题文件类型是 json，需要在 metainfo.xml 中指定主题文件名称。）")])]),a._v(" "),s("li",[s("p",[a._v("重启 ambari-server 服务进程。")])]),a._v(" "),s("li",[s("p",[a._v("在 ambari 页面上，即可查看更新后的自定义服务配置样式。")])])]),a._v(" "),s("blockquote",[s("p",[a._v("tip：还是需要自己多调试，多修改看效果。")])]),a._v(" "),s("p",[s("strong",[a._v("如果没有出现预期的效果，建议多看一下 主题 json 文件内容，多和 已有的主题文件作对比（比如，HBase 的 theme.json 文件）。")])]),a._v(" "),s("h3",{attrs:{id:"rolecommandorder-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rolecommandorder-json"}},[a._v("#")]),a._v(" role"),s("em",[a._v("command")]),a._v("order.json")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("替换 role"),s("em",[a._v("command")]),a._v("order.json 文件")])]),a._v(" "),s("li",[s("p",[a._v("删除该服务与依赖的服务，比如本视频示例的 ELASTICSEARCH 与 ZOOKEEPER 服务。")])]),a._v(" "),s("li",[s("p",[a._v("重启 ambari-server 服务进程。")])]),a._v(" "),s("li",[s("p",[a._v("安装服务（ELASTICSEARCH 与 ZOOKEEPER ），进行验证。")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);
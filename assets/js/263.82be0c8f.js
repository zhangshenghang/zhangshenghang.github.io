(window.webpackJsonp=window.webpackJsonp||[]).push([[263],{629:function(a,t,s){"use strict";s.r(t);var e=s(8),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"arthas-java-程序问题定位神器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arthas-java-程序问题定位神器"}},[a._v("#")]),a._v(" Arthas：Java 程序问题定位神器")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/02/zsUjbxTqYHfae7D.png",alt:"image-20241028135043535"}})]),a._v(" "),t("p",[a._v("Arthas 是 Alibaba 开发的强大 Java 诊断工具，提供了一系列实用的命令用于探查和优化 Java 应用的运行情况。本文将带您详细了解如何使用 Arthas 进行分析、诊断和优化 Java 应用，以便快速定位并解决性能瓶颈和应用故障。")]),a._v(" "),t("h2",{attrs:{id:"arthas-与其他工具对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arthas-与其他工具对比"}},[a._v("#")]),a._v(" Arthas 与其他工具对比")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/6yXMROI1mUVl43v.png",alt:"image-20241028134602877"}})]),a._v(" "),t("h2",{attrs:{id:"快速启动-arthas"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#快速启动-arthas"}},[a._v("#")]),a._v(" 快速启动 Arthas")]),a._v(" "),t("p",[a._v("在启动 Arthas 过程中，我们可以选择需要分析的进程。选择 Java 进程后，Arthas 将自动下载并附加到指定进程上。")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-jar")]),a._v(" arthas-boot.jar --repo-mirror aliyun --use-http\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" JAVA_HOME: /opt/jdk1.8.0_151/jre\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" arthas-boot version: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.0")]),a._v(".2\n* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11490")]),a._v(" kafka.Kafka\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\t            \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".                                                                 \npid        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11490")]),a._v("          \n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11490"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("Arthas 启动后，可直接通过命令行或 Web 界面（http://localhost:3658）进行操作。")]),a._v(" "),t("h2",{attrs:{id:"dashboard-监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dashboard-监控"}},[a._v("#")]),a._v(" Dashboard 监控")]),a._v(" "),t("p",[a._v("Dashboard 提供了 Java 应用的 CPU、内存、线程等运行状态的实时监控，方便快速定位问题所在。")]),a._v(" "),t("p",[a._v("输入"),t("code",[a._v("dashborad")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11490"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ dashborad\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/rtqb4p5FK2X8Lil.png",alt:"img"}})]),a._v(" "),t("h3",{attrs:{id:"查看-cpu-占用线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-cpu-占用线程"}},[a._v("#")]),a._v(" 查看 CPU 占用线程")]),a._v(" "),t("p",[a._v("当应用负载过高时，我们可以用 "),t("code",[a._v("thread -n")]),a._v(" 命令查看占用 CPU 比较高的线程：")]),a._v(" "),t("p",[a._v("此命令将列出 CPU 占用率最高的两个线程，帮助我们识别出 CPU 密集型线程及其具体操作。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/OqvjLdVuBpA4C5a.png",alt:"image-20241028112951939"}})]),a._v(" "),t("h3",{attrs:{id:"找出当前阻塞其他线程的线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#找出当前阻塞其他线程的线程"}},[a._v("#")]),a._v(" 找出当前阻塞其他线程的线程")]),a._v(" "),t("p",[a._v("在 Java 应用中，可能存在某些线程阻塞其他线程的情况。"),t("code",[a._v("thread -b")]),a._v(" 命令可以帮助我们快速定位阻塞线程。")]),a._v(" "),t("blockquote",[t("p",[a._v("注意， 目前只支持找出 synchronized 关键字阻塞住的线程， 如果是"),t("code",[a._v("java.util.concurrent.Lock")]),a._v("， 目前还不支持。")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/HlUMpVjOFSbzvc5.png",alt:"image-20241028132912211"}})]),a._v(" "),t("h3",{attrs:{id:"类进行反编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#类进行反编译"}},[a._v("#")]),a._v(" 类进行反编译")]),a._v(" "),t("p",[a._v("比如我们通过Arthas分析到某一个类有问题，我们想看类的代码是什么，可以使用该方法。")]),a._v(" "),t("p",[t("code",[a._v("[arthas@11490]$ jad org.apache.kafka.common.network.Selector")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/lOQYvPtfmUj1k49.png",alt:"image-20241028113320310"}})]),a._v(" "),t("h3",{attrs:{id:"查看类的基础信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看类的基础信息"}},[a._v("#")]),a._v(" 查看类的基础信息")]),a._v(" "),t("p",[t("code",[a._v("sc -d ${类名}")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/AXlg71RmDPyF6Vd.png",alt:"image-20241028113432885"}})]),a._v(" "),t("h3",{attrs:{id:"查看类调用方法的堆栈信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看类调用方法的堆栈信息"}},[a._v("#")]),a._v(" 查看类调用方法的堆栈信息")]),a._v(" "),t("p",[a._v("我们可以使用 "),t("code",[a._v("stack")]),a._v(" 命令，实时追踪指定类的方法调用堆栈，找出调用链和执行顺序。\n当有方法调用了"),t("code",[a._v("org.apache.kafka.common.network.Selector select")]),a._v("就会打印出详细信息")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11490"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ stack org.apache.kafka.common.network.Selector "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("select")]),a._v(" \nPress Q or Ctrl+C to abort.\nAffect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("class count: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" , method count: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" cost "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1332")]),a._v(" ms, listenerId: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ts")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-10-28 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(":36:14.166"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("thread_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ReplicaFetcherThread-0-1001"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("297787")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("is_daemon")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("priority")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TCCL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("sun.misc.Launcher"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$AppClassLoader")]),a._v("@764c12b6\n    @org.apache.kafka.common.network.Selector.select"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.kafka.common.network.Selector.poll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Selector.java:409"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.kafka.clients.NetworkClient.poll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("NetworkClient.java:510"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.kafka.clients.NetworkClientUtils.isReady"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("NetworkClientUtils.java:41"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.kafka.clients.NetworkClientUtils.awaitReady"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("NetworkClientUtils.java:64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at kafka.server.ReplicaFetcherBlockingSend.sendRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ReplicaFetcherBlockingSend.scala:91"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at kafka.server.ReplicaFetcherThread.fetch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ReplicaFetcherThread.scala:240"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at kafka.server.ReplicaFetcherThread.fetch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ReplicaFetcherThread.scala:43"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at kafka.server.AbstractFetcherThread.processFetchRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AbstractFetcherThread.scala:149"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at kafka.server.AbstractFetcherThread.doWork"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AbstractFetcherThread.scala:114"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at kafka.utils.ShutdownableThread.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ShutdownableThread.scala:82"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br")])]),t("h3",{attrs:{id:"分析哪些方法执行慢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分析哪些方法执行慢"}},[a._v("#")]),a._v(" 分析哪些方法执行慢")]),a._v(" "),t("p",[a._v("使用 "),t("code",[a._v("trace")]),a._v(" 命令可以追踪方法的执行情况，分析哪些方法在执行中消耗了较多时间，从而定位性能瓶颈。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/fpijbvdYS7ThmCL.png",alt:"trace"}})]),a._v(" "),t("h3",{attrs:{id:"监听某一个方法的返回值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监听某一个方法的返回值"}},[a._v("#")]),a._v(" 监听某一个方法的返回值")]),a._v(" "),t("p",[a._v("通过 "),t("code",[a._v("watch")]),a._v(" 命令可以监听指定方法的返回值，例如：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("arthas@11490"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("watch")]),a._v(" org.apache.kafka.common.network.Selector "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("select")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("此命令会在每次 "),t("code",[a._v("select")]),a._v(" 方法执行完成时，返回其结果数据，以供调试。")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("method=org.apache.kafka.common.network.Selector.select location=AtExit\nts=2024-10-28 21:41:11.760; [cost=0.26099ms] result=@ArrayList[\n    @Object[][isEmpty=false;size=1],\n    @Selector[org.apache.kafka.common.network.Selector@3c7b65a1],\n    @Integer[1],\n]\nmethod=org.apache.kafka.common.network.Selector.select location=AtExit\nts=2024-10-28 21:41:11.761; [cost=0.04802ms] result=@ArrayList[\n    @Object[][isEmpty=false;size=1],\n    @Selector[org.apache.kafka.common.network.Selector@3c7b65a1],\n    @Integer[1],\n]\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br")])]),t("h3",{attrs:{id:"获取运行中类的的字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取运行中类的的字段"}},[a._v("#")]),a._v(" 获取运行中类的的字段")]),a._v(" "),t("p",[a._v("调用静态函数：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ ognl "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@java.lang.System@out.println(\"hello\")'")]),a._v("\nnull\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("获取静态类的静态字段：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ ognl "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@demo.MathGame@random'")]),a._v("\n@Random"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("serialVersionUID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Long"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3905348978240129619")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("seed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@AtomicLong"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("125451474443703")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("multiplier")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Long"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("25214903917")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("addend")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Long"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("mask")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Long"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("281474976710655")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOUBLE_UNIT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Double"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(".1102230246251565E-16"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BadBound")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@String"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("bound must be positive"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BadRange")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@String"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("bound must be greater than origin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BadSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@String"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("size must be non-negative"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("seedUniquifier")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@AtomicLong"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("-3282039941672302964"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("nextNextGaussian")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Double"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("haveNextNextGaussian")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Boolean"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("serialPersistentFields")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@ObjectStreamField"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("isEmpty"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("unsafe")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Unsafe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("sun.misc.Unsafe@28ea5898"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("seedOffset")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("@Long"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("24")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br")])]),t("p",[a._v("执行多行表达式，赋值给临时变量，返回一个 List：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ ognl "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'#value1=@System@getProperty("java.home"), #value2=@System@getProperty("java.runtime.name"), {#value1, #value2}\'')]),a._v("\n@ArrayList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    @String"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("/opt/java/8.0.181-zulu/jre"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n    @String"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("OpenJDK Runtime Environment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("h3",{attrs:{id:"方法执行监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法执行监控"}},[a._v("#")]),a._v(" 方法执行监控")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/hXozjD9I2sGFvTV.png",alt:"image-20241028114940933"}})]),a._v(" "),t("p",[a._v("监控维度说明：")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"right"}},[a._v("监控项")]),a._v(" "),t("th",{staticStyle:{"text-align":"left"}},[a._v("说明")])])]),a._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("timestamp")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("时间戳")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("class")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("Java 类")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("method")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("方法（构造方法、普通方法）")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("total")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("调用次数")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("success")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("成功次数")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("fail")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("失败次数")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("rt")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("平均 RT")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"right"}},[a._v("fail-rate")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("失败率")])])])]),a._v(" "),t("h2",{attrs:{id:"环境变量与系统属性查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境变量与系统属性查看"}},[a._v("#")]),a._v(" 环境变量与系统属性查看")]),a._v(" "),t("p",[a._v("在 Java 应用中，系统属性和环境变量影响着应用的运行配置。Arthas 提供了 "),t("code",[a._v("sysenv")]),a._v(" 和 "),t("code",[a._v("sysprop")]),a._v(" 命令以供查看和修改。")]),a._v(" "),t("h3",{attrs:{id:"查看环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看环境变量"}},[a._v("#")]),a._v(" 查看环境变量")]),a._v(" "),t("p",[t("code",[a._v("sysenv")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/EMNqhfrYRc5K9OP.png",alt:"image-20241028115628445"}})]),a._v(" "),t("p",[t("strong",[a._v("查看单个环境变量")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ sysenv "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h3",{attrs:{id:"查看当前-jvm-的系统属性-system-property"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看当前-jvm-的系统属性-system-property"}},[a._v("#")]),a._v(" 查看当前 JVM 的系统属性("),t("code",[a._v("System Property")]),a._v(")")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("sysprop\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/rNdzmZPBGV1e2bk.png",alt:"image-20241028115757185"}})]),a._v(" "),t("p",[t("strong",[a._v("查看，修改单个属性")])]),a._v(" "),t("blockquote",[t("p",[a._v("支持通过"),t("code",[a._v("TAB")]),a._v("键自动补全")])]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("$ sysprop user.country\nuser.country=US\n$ sysprop user.country CN\nSuccessfully changed the system property.\nuser.country=CN\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("h3",{attrs:{id:"火焰图生成-profiler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#火焰图生成-profiler"}},[a._v("#")]),a._v(" 火焰图生成-profiler")]),a._v(" "),t("p",[t("strong",[a._v("启动 profiler")])]),a._v(" "),t("blockquote",[t("p",[a._v("默认情况下，生成的是 cpu 的火焰图，即 event 为"),t("code",[a._v("cpu")]),a._v("。可以用"),t("code",[a._v("--event")]),a._v("参数指定其他性能分析模式，参考：https://arthas.aliyun.com/doc/profiler.html#profiler-%E6%94%AF%E6%8C%81%E7%9A%84-events。")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ profiler start\nStarted "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("cpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" profiling\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[t("strong",[a._v("获取已采集的 sample 的数量")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ profiler getSamples\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("23")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[t("strong",[a._v("查看 profiling 状态")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ profiler status\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("cpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" profiling is running "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" seconds\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[t("strong",[a._v("停止 profiler")])]),a._v(" "),t("p",[a._v("生成火焰图格式结果")]),a._v(" "),t("p",[a._v("默认情况下，结果是 "),t("a",{attrs:{href:"https://github.com/BrendanGregg/FlameGraph",target:"_blank",rel:"noopener noreferrer"}},[a._v("Flame Graph在新窗口打开"),t("OutboundLink")],1),a._v(" 格式的 "),t("code",[a._v("html")]),a._v(" 文件，也可以用 "),t("code",[a._v("-o")]),a._v(" 或 "),t("code",[a._v("--format")]),a._v(" 参数指定其他内容格式，包括 flat、traces、collapsed、flamegraph、tree、jfr。")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ profiler stop "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--format")]),a._v(" flamegraph\nprofiler output file: /tmp/test/arthas-output/20211207-111550.html\nOK\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("在"),t("code",[a._v("--file")]),a._v("参数指定的文件名后缀为 "),t("code",[a._v("html")]),a._v(" 或 "),t("code",[a._v("jfr")]),a._v(" 时，文件格式可以被推断出来。比如"),t("code",[a._v("--file /tmp/result.html")]),a._v(" 将自动生成火焰图。")]),a._v(" "),t("p",[t("strong",[a._v("效果如下")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/11/06/sJqOohNe1C9gtRU.png",alt:"img"}})]),a._v(" "),t("h2",{attrs:{id:"常见问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[a._v("#")]),a._v(" 常见问题")]),a._v(" "),t("h3",{attrs:{id:"target-process-not-responding-or-hotspot-vm-not-loaded"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#target-process-not-responding-or-hotspot-vm-not-loaded"}},[a._v("#")]),a._v(" target process not responding or HotSpot VM not loaded")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[ERROR] Start arthas failed, exception stack trace: \ncom.sun.tools.attach.AttachNotSupportedException: Unable to open socket file: target process not responding or HotSpot VM not loaded\n\tat sun.tools.attach.LinuxVirtualMachine.<init>(LinuxVirtualMachine.java:106)\n\tat sun.tools.attach.LinuxAttachProvider.attachVirtualMachine(LinuxAttachProvider.java:78)\n\tat com.sun.tools.attach.VirtualMachine.attach(VirtualMachine.java:250)\n\tat com.taobao.arthas.core.Arthas.attachAgent(Arthas.java:102)\n\tat com.taobao.arthas.core.Arthas.<init>(Arthas.java:27)\n\tat com.taobao.arthas.core.Arthas.main(Arthas.java:161)\n[ERROR] attach fail, targetPid: 11490\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[t("strong",[a._v("原因：")])]),a._v(" "),t("p",[a._v("Java程序运行用户与arthas运行用户不一致")]),a._v(" "),t("blockquote",[t("p",[a._v("官网：https://arthas.aliyun.com/")]),a._v(" "),t("p",[a._v("GitHub：https://github.com/alibaba/arthas")])])])}),[],!1,null,null,null);t.default=n.exports}}]);
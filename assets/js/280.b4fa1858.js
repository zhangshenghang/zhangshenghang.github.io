(window.webpackJsonp=window.webpackJsonp||[]).push([[280],{647:function(a,s,t){"use strict";t.r(s);var e=t(8),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("[toc]")]),a._v(" "),s("h2",{attrs:{id:"maxwell-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#maxwell-概述"}},[a._v("#")]),a._v(" Maxwell 概述")]),a._v(" "),s("h3",{attrs:{id:"_1-1-maxwell-定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-maxwell-定义"}},[a._v("#")]),a._v(" 1.1 Maxwell 定义")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("Maxwell 是由美国 Zendesk 开源，用 Java 编写的 MySQL 实时抓取软件。 实时读取\n")])])]),s("p",[a._v("MySQL 二进制日志 Binlog，并生成 JSON 格式的消息，作为生产者发送给 Kafka，Kinesis、")]),a._v(" "),s("p",[a._v("RabbitMQ、Redis、Google Cloud Pub/Sub、文件或其它平台的应用程序。")]),a._v(" "),s("p",[a._v("官网地址：http://maxwells-daemon.io/")]),a._v(" "),s("h3",{attrs:{id:"_1-2-maxwell工作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-maxwell工作原理"}},[a._v("#")]),a._v(" 1.2 Maxwell工作原理")]),a._v(" "),s("h4",{attrs:{id:"_1-2-1-mysql主从复制过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-mysql主从复制过程"}},[a._v("#")]),a._v(" 1.2.1 MySQL主从复制过程")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("Master 主库将改变记录，写到二进制日志(binary log)中")])]),a._v(" "),s("li",[s("p",[a._v("Slave 从库向 mysql master 发送 dump 协议，将 master 主库的 binary log events 拷贝")])])]),a._v(" "),s("p",[a._v("到它的中继日志(relay log)；")]),a._v(" "),s("ul",[s("li",[a._v("Slave 从库读取并重做中继日志中的事件，将改变的数据同步到自己的数据库。")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/0c7cf16cd07c4ac09ab47d1a78b8d390.png",alt:"在这里插入图片描述"}})]),a._v(" "),s("h4",{attrs:{id:"_1-2-2-maxwell的工作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-maxwell的工作原理"}},[a._v("#")]),a._v(" 1.2.2 Maxwell的工作原理")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("\tMaxwell 的工作原理很简单，就是**把自己伪装成 MySQL 的一个 slave，然后以 slave**\n")])])]),s("p",[s("strong",[a._v("的身份假装从 MySQL(master)复制数据。")])]),a._v(" "),s("h4",{attrs:{id:"_1-2-3-mysql-的-binlog"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-mysql-的-binlog"}},[a._v("#")]),a._v(" 1.2.3 "),s("strong",[a._v("MySQL")]),a._v(" "),s("strong",[a._v("的")]),a._v(" binlog")]),a._v(" "),s("ol",[s("li",[s("p",[s("strong",[a._v("什么是 binlog")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v(" MySQL 的二进制日志可以说 MySQL 最重要的日志了，它记录了所有的 DDL 和 DML(除\n")])])]),s("p",[a._v("了数据查询语句)语句，以事件形式记录，还包含语句所执行的消耗的时间，MySQL 的二进")]),a._v(" "),s("p",[a._v("制日志是事务安全型的。")]),a._v(" "),s("p",[a._v("一般来说开启二进制日志大概会有 1%的性能损耗。二进制有两个最重要的使用场景:")]),a._v(" "),s("ul",[s("li",[a._v("其一：MySQL Replication 在 Master 端开启 binlog，Master 把它的二进制日志传递")])]),a._v(" "),s("p",[a._v("给 slaves 来达到 master-slave 数据一致的目的。")]),a._v(" "),s("ul",[s("li",[a._v("其二：自然就是数据恢复了，通过使用 mysqlbinlog 工具来使恢复数据。")])]),a._v(" "),s("p",[a._v("二进制日志包括两类文件：二进制日志索引文件（文件名后缀为.index）用于记录所有")]),a._v(" "),s("p",[a._v("的二进制文件，二进制日志文件（文件名后缀为.00000*）记录数据库所有的 DDL 和 DML(除")]),a._v(" "),s("p",[a._v("了数据查询语句)语句事件。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("binlog 的开启")])]),a._v(" "),s("ul",[s("li",[s("p",[a._v("找到 MySQL 配置文件的位置")])]),a._v(" "),s("li",[s("p",[a._v("Linux: /etc/my.cnf")]),a._v(" "),s("p",[a._v("如果/etc 目录下没有，可以通过 locate my.cnf 查找位置")])]),a._v(" "),s("li",[s("p",[a._v("Windows: \\my.ini")]),a._v(" "),s("p",[a._v("在 mysql 的配置文件下,修改配置")])])]),a._v(" "),s("p",[a._v("在[mysqld] 区块，设置/添加 "),s("strong",[a._v("log-bin=mysql-bin")])]),a._v(" "),s("p",[a._v("这个表示 binlog 日志的前缀是 mysql-bin，以后生成的日志文件就是 mysql-bin.000001")]),a._v(" "),s("p",[a._v("的文件后面的数字按顺序生成，每次 mysql 重启或者到达单个文件大小的阈值时，新生一个")]),a._v(" "),s("p",[a._v("文件，按顺序编号。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("binlog 的分类设置")])]),a._v(" "),s("p",[a._v("mysql binlog 的格式有三种，分别是 STATEMENT,MIXED,ROW。")]),a._v(" "),s("p",[a._v("在配置文件中可以选择配置 "),s("strong",[a._v("binlog_format= statement|mixed|row")])]),a._v(" "),s("ul",[s("li",[s("p",[a._v("三种格式的区别：")]),a._v(" "),s("ul",[s("li",[s("p",[s("strong",[a._v("statement")])]),a._v(" "),s("p",[a._v("语句级，binlog 会记录每次一执行写操作的语句。")]),a._v(" "),s("p",[a._v("相对 row 模式节省空间，但是可能产生不一致性，比如")]),a._v(" "),s("p",[a._v("update test set create_date=now();")]),a._v(" "),s("p",[a._v("如果用 binlog 日志进行恢复，由于执行时间不同可能产生的数据就不同。")]),a._v(" "),s("p",[a._v("优点： 节省空间")]),a._v(" "),s("p",[a._v("缺点： 有可能造成数据不一致。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("row")])]),a._v(" "),s("p",[a._v("行级， binlog 会记录每次操作后每行记录的变化。")]),a._v(" "),s("p",[a._v("优点：保持数据的绝对一致性。因为不管 sql 是什么，引用了什么函数，他只记录")]),a._v(" "),s("p",[a._v("执行后的效果。")]),a._v(" "),s("p",[a._v("缺点：占用较大空间。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("mixed")])]),a._v(" "),s("p",[a._v("混合级别，statement 的升级版，一定程度上解决了 statement 模式因为一些情况")]),a._v(" "),s("p",[a._v("而造成的数据不一致问题。")]),a._v(" "),s("p",[a._v("默认还是 statement，在某些情况下，譬如：")]),a._v(" "),s("p",[a._v("当函数中包含 UUID() 时；")]),a._v(" "),s("p",[a._v("包含 AUTO_INCREMENT 字段的表被更新时；")]),a._v(" "),s("p",[a._v("执行 INSERT DELAYED 语句时；")]),a._v(" "),s("p",[a._v("用 UDF 时；")]),a._v(" "),s("p",[a._v("会按照 ROW 的方式进行处理")]),a._v(" "),s("p",[a._v("优点：节省空间，同时兼顾了一定的一致性。")]),a._v(" "),s("p",[a._v("缺点：还有些极个别情况依旧会造成不一致，另外 statement 和 mixed 对于需要对")]),a._v(" "),s("p",[a._v("binlog 监控的情况都不方便。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("综合上面对比，Maxwell 想做监控分析，选择 row 格式比较合适")])])])])])])])]),a._v(" "),s("h3",{attrs:{id:"_1-3-maxwell和canal的对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-maxwell和canal的对比"}},[a._v("#")]),a._v(" 1.3 Maxwell和Canal的对比")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("对比")]),a._v(" "),s("th",[a._v("Canal")]),a._v(" "),s("th",[a._v("Maxwell")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("语言")]),a._v(" "),s("td",[a._v("java")]),a._v(" "),s("td",[a._v("Java")])]),a._v(" "),s("tr",[s("td",[a._v("数据格式")]),a._v(" "),s("td",[a._v("格式自由")]),a._v(" "),s("td",[a._v("json")])]),a._v(" "),s("tr",[s("td",[a._v("数据采集模式")]),a._v(" "),s("td",[a._v("增量")]),a._v(" "),s("td",[a._v("增量/全量")])]),a._v(" "),s("tr",[s("td",[a._v("数据落地")]),a._v(" "),s("td",[a._v("定制")]),a._v(" "),s("td",[a._v("支持Kafka等多种平台")])]),a._v(" "),s("tr",[s("td",[a._v("HA")]),a._v(" "),s("td",[a._v("支持")]),a._v(" "),s("td",[a._v("支持")])])])]),a._v(" "),s("h2",{attrs:{id:"maxwell使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#maxwell使用"}},[a._v("#")]),a._v(" Maxwell使用")]),a._v(" "),s("h3",{attrs:{id:"_2-1-maxwell安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-maxwell安装"}},[a._v("#")]),a._v(" 2.1 Maxwell安装")]),a._v(" "),s("h4",{attrs:{id:"_2-1-1-安装地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-安装地址"}},[a._v("#")]),a._v(" 2.1.1 安装地址")]),a._v(" "),s("p",[a._v("Maxwell 官网地址："),s("a",{attrs:{href:"http://maxwells-daemon.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://maxwells-daemon.io/"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("文档地址："),s("a",{attrs:{href:"https://maxwells-daemon.io/quickstart/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://maxwells-daemon.io/quickstart/"),s("OutboundLink")],1)]),a._v(" "),s("h4",{attrs:{id:"_2-1-2-安装部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-安装部署"}},[a._v("#")]),a._v(" 2.1.2 安装部署")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("这里我们选择1.29.2版本进行介绍，该版本使用jdk1.8版本，之后的都是11")])]),a._v(" "),s("li",[s("p",[a._v("上传 maxwell-1.29.2.tar.gz 到/opt/software 下")])]),a._v(" "),s("li",[s("p",[a._v("解压 maxwell-1.29.2.tar.gz 的安装包到/opt/module 下")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 software]$ tar -zxvf maxwell-1.29.2.tar.gz -\nC /opt/module/\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])]),a._v(" "),s("h4",{attrs:{id:"_2-1-3-mysql环境准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-mysql环境准备"}},[a._v("#")]),a._v(" 2.1.3 MySQL环境准备")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("修改 mysql 的配置文件，开启 MySQL Binlog 设置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("atguigu@hadoop102 software]$ sudo vim /etc/my.cnf\n在[mysqld]模块下添加一下内容\n[mysqld]\nserver_id=1\nlog-bin=mysql-bin\nbinlog_format=row\n#设置多个数据库监控，不能使用逗号分隔，复制多行即可\n#binlog-do-db=test_maxwell\n\n并重启 Mysql 服务\n[atguigu@hadoop102 software]$ sudo systemctl restart mysqld\n登录 mysql 并查看是否修改完成\n[atguigu@hadoop102 ~]$ mysql -uroot -p123456\nmysql> show variables like '%binlog%';\n查看下列属性\nbinlog_format | ROW\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("进入/var/lib/mysql 目录，查看 MySQL 生成的 binlog 文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 ~]$ cd /var/lib/mysql\n[atguigu@hadoop102 mysql]$ sudo ls -l\n总用量 188500\n-rw-r-----. 1 mysql mysql 154 11 月 17 16:30 mysqlbin.000001\n-rw-r-----. 1 mysql mysql 19 11 月 17 16:30 mysqlbin.index\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("注：MySQL 生成的 binlog 文件初始大小一定是 154 字节，然后前缀是 log-bin 参数配")]),a._v(" "),s("p",[a._v("置的，后缀是默认从.000001，然后依次递增。除了 binlog 文件文件以外，MySQL 还会额外")]),a._v(" "),s("p",[a._v("生产一个.index 索引文件用来记录当前使用的 binlog 文件。")])])]),a._v(" "),s("h4",{attrs:{id:"_2-1-4-初始化maxwell元数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-初始化maxwell元数据库"}},[a._v("#")]),a._v(" 2.1.4 初始化Maxwell元数据库")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("在 MySQL 中建立一个 maxwell 库用于存储 Maxwell 的元数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 module]$ mysql -uroot -p123456\nmysql> CREATE DATABASE maxwell;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("设置 mysql 用户密码安全级别")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> set global validate_password_length=4;\nmysql> set global validate_password_policy=0;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("分配一个账号可以操作该数据库")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> GRANT ALL ON maxwell.* TO 'maxwell'@'%' IDENTIFIED BY '123456';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("分配这个账号可以监控其他数据库的权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> GRANT SELECT ,REPLICATION SLAVE , REPLICATION CLIENT ON \n*.* TO maxwell@'%';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("刷新 mysql 表权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> flush privileges;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])]),a._v(" "),s("blockquote",[s("p",[a._v("MySQL 8")]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建账户")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'root'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'172.16.10.203'")]),a._v(" identified "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'password'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#赋予权限，with grant option这个选项表示该用户可以将自己拥有的权限授权给别人")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("all")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("privileges")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'root'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'172.16.10.203'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("with")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("option")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#改密码&授权超用户，flush privileges 命令本质上的作用是将当前user和privilige表中的用户信息/权限设置从mysql库(MySQL数据库的内置库)中提取到内存里")]),a._v("\nflush "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("privileges")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-------")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DATABASE")]),a._v(" maxwell"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'maxwell'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'%'")]),a._v(" identified "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'123456'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("all")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("privileges")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'maxwell'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'%'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("with")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("option")]),a._v("\nflush "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("privileges")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])])]),a._v(" "),s("h4",{attrs:{id:"_2-1-5-maxwell进程启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-maxwell进程启动"}},[a._v("#")]),a._v(" 2.1.5 Maxwell进程启动")]),a._v(" "),s("p",[a._v("Maxwell 进程启动方式有如下两种：")]),a._v(" "),s("h5",{attrs:{id:"使用命令行参数启动-maxwell-进程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用命令行参数启动-maxwell-进程"}},[a._v("#")]),a._v(" 使用命令行参数启动 Maxwell 进程")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 maxwell-1.29.2]$ bin/maxwell --\nuser='maxwell' --password='123456' --host='hadoop102' --\nproducer=stdout\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("--user 连接 mysql 的用户")]),a._v(" "),s("p",[a._v("--password 连接 mysql 的用户的密码")]),a._v(" "),s("p",[a._v("--host mysql 安装的主机名/IP")]),a._v(" "),s("p",[a._v("--producer 生产者模式(stdout：控制台 kafka：kafka 集群)")]),a._v(" "),s("h5",{attrs:{id:"修改配置文件-定制化启动-maxwell-进程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件-定制化启动-maxwell-进程"}},[a._v("#")]),a._v(" 修改配置文件，定制化启动 Maxwell 进程")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 maxwell-1.29.2]$ cp \nconfig.properties.example config.properties\n[atguigu@hadoop102 maxwell-1.29.2]$ vim config.properties\n[atguigu@hadoop102 maxwell-1.29.2]$ bin/maxwell --\nconfig ./config.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"_2-2-maxwell入门案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-maxwell入门案例"}},[a._v("#")]),a._v(" 2.2 Maxwell入门案例")]),a._v(" "),s("h4",{attrs:{id:"_2-2-1-监控-mysql-数据并在控制台打印"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-监控-mysql-数据并在控制台打印"}},[a._v("#")]),a._v(" 2.2.1 监控 "),s("strong",[a._v("Mysql")]),a._v(" 数据并在控制台打印")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("运行 maxwell 来监控 mysql 数据更新")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 maxwell-1.29.2]$ bin/maxwell --\nuser='maxwell' --password='123456' --host='hadoop102' --\nproducer=stdout\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("向 mysql 的 test_maxwell 库的 test 表插入一条数据，查看 maxwell 的控制台输出")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('mysql> insert into test values(1,\'aaa\');\n{\n    "database": "test_maxwell", --库名\n    "table": "test", --表名\n    "type": "insert", --数据更新类型\n    "ts": 1637244821, --操作时间\n    "xid": 8714, --操作 id\n    "commit": true, --提交成功\n    "data": { --数据\n    "id": 1,\n    "name": "aaa"\n  \t} \n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("向 mysql 的 test_maxwell 库的 test 表同时插入 3 条数据，控制台出现了 3 条 json")]),a._v(" "),s("p",[a._v("日志，说明 maxwell 是以数据行为单位进行日志的采集的。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('mysql> INSERT INTO test VALUES(2,\'bbb\'),(3,\'ccc\'),(4,\'ddd\');\n{"database":"test_maxwell","table":"test","type":"insert","ts"\n:1637245127,"xid":9129,"xoffset":0,"data":{"id":2,"name":"bbb"\n}}\n{"database":"test_maxwell","table":"test","type":"insert","ts"\n:1637245127,"xid":9129,"xoffset":1,"data":{"id":3,"name":"ccc"\n}}\n{"database":"test_maxwell","table":"test","type":"insert","ts"\n:1637245127,"xid":9129,"commit":true,"data":{"id":4,"name":"dd\nd"}}\nmysql> update test set name=\'zaijian\' where id =1;\n{"database":"test_maxwell","table":"test","type":"update","ts"\n:1631618614,"xid":535,"commit":true,"data":{"id":1,"name":"zai\njian"},"old":{"name":"nihao"}}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("修改 test_maxwell 库的 test 表的一条数据，查看 maxwell 的控制台输出")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('mysql> update test set name=\'abc\' where id =1;\n{\n  "database": "test_maxwell",\n  "table": "test",\n  "type": "update",\n  "ts": 1637245338,\n  "xid": 9418,\n  "commit": true,\n  "data": { --修改后的数据\n  "id": 1,\n  "name": "abc"\n  },\n  "old": { --修改前的数据\n  "name": "aaa"\n  } \n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("删除 test_maxwell 库的 test 表的一条数据，查看 maxwell 的控制台输出")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('mysql> DELETE FROM test WHERE id =1;\n{\n  "database": "test_maxwell",\n  "table": "test",\n  "type": "delete",\n  "ts": 1637245630,\n  "xid": 9816,\n  "commit": true,\n  "data": {\n  "id": 1,\n  "name": "abc"\n  } \n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])])])]),a._v(" "),s("h4",{attrs:{id:"_2-2-2-监控-mysql-数据输出到-kafka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-监控-mysql-数据输出到-kafka"}},[a._v("#")]),a._v(" 2.2.2 监控 Mysql 数据输出到 kafka")]),a._v(" "),s("h5",{attrs:{id:"实现步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现步骤"}},[a._v("#")]),a._v(" 实现步骤")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("启动 zookeeper 和 kafka")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 bin]$ jpsall\n=============== hadoop102 ===============\n3511 QuorumPeerMain\n4127 Kafka\n=============== hadoop103 ===============\n1885 Kafka\n1342 QuorumPeerMain\n=============== hadoop104 ===============\n1345 QuorumPeerMain\n1886 Kafka\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("启动 Maxwell 监控 binlog")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("atguigu@hadoop102 maxwell-1.29.2]$ bin/maxwell --user='maxwell' \n--password='123456' --host='hadoop102' --producer=kafka --\nkafka.bootstrap.servers=hadoop102:9092 --kafka_topic=maxwell\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("打开 kafka 的控制台的消费者消费 maxwell 主题")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 ~]$ kafka-console-consumer.sh --bootstrapserver hadoop102:9092 --topic maxwell\n（4）向 test_maxwell 库的 test 表再次插入一条数据\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("向 test_maxwell 库的 test 表再次插入一条数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> insert into test values (5,'eee');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("通过 kafka 消费者来查看到了数据，说明数据成功传入 kafka")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('{"database":"test_maxwell","table":"test","type":"insert","ts"\n:1637245889,"xid":10155,"commit":true,"data":{"id":5,"name":"e\nee"}}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])])]),a._v(" "),s("h5",{attrs:{id:"kafka-主题数据的分区控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka-主题数据的分区控制"}},[a._v("#")]),a._v(" kafka 主题数据的分区控制")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("\t在公司生产环境中，我们一般都会用 maxwell 监控多个 mysql 库的数据，然后将这\n")])])]),s("p",[a._v("些数据发往 kafka 的一个主题 Topic，并且这个主题也肯定是多分区的，为了提高并发度。")]),a._v(" "),s("p",[a._v("那么如何控制这些数据的分区问题，就变得至关重要，实现步骤如下：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("修改 maxwell 的配置文件，定制化启动 maxwell 进程")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("[atguigu@hadoop102")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("maxwell-1.29.2]$ vim config.properties")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# tl;dr config")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_level")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("info")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("producer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("kafka.bootstrap.servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hadoop102:9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mysql login info")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hadoop102")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("maxwell")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("123456")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# *** kafka ***")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# list of kafka brokers")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#kafka.bootstrap.servers=hosta:9092,hostb:9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka topic to write to")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# this can be static, e.g. 'maxwell', or dynamic, e.g. ")]),a._v("\nnamespace_%{database}_%{table}\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# in the latter case 'database' and 'table' will be replaced ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("with")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("the values for the row being processed")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("kafka_topic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("maxwell3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# *** partitioning ***")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# What part of the data do we partition by?")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#producer_partition_by=database # [database, table, ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("primary_key,")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("transaction_id, column]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("producer_partition_by")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("database")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("控制数据分区模式，可选模式有")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("库名，表名，主键，列名")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# specify what fields to partition by when using ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("producer_partition_by")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("column")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# column separated list.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#producer_partition_columns=name")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# when using producer_partition_by=column, partition by this ")]),a._v("\nwhen\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# the specified column(s) don't exist.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#producer_partition_by_fallback=database")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("手动创建一个 3 个分区的 topic，名字就叫做 maxwell3")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 maxwell-1.29.2]$ kafka-topics.sh --zookeeper \nhadoop102:2181,hadoop103:2181,hadoop104:2181/kafka --create --\nreplication-factor 2 --partitions 3 --topic maxwell3\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("利用配置文件启动 Maxwell 进程")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 maxwell-1.29.2]$ bin/maxwell --\nconfig ./config.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("向 test_maxwell 库的 test 表再次插入一条数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> insert into test_maxwell.test values (6,'fff');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("通过 kafka tool 工具查看，此条数据进入了 maxwell3 主题的 1 号分区")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/ad3ca34a9fbe44a88c359493700b0a10.png",alt:"在这里插入图片描述"}})]),a._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[s("p",[a._v("向 test 库的 aaa 表插入一条数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> insert into test_maxwell2.test values (23,'dd');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("通过 kafka tool 工具查看，此条数据进入了 maxwell3 主题的 0 号分区,说明库名")]),a._v(" "),s("p",[a._v("会对数据进入的分区造成影响。")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/dda03687f266437f8e6ef2174d275a23.png",alt:"在这里插入图片描述"}})]),a._v(" "),s("h4",{attrs:{id:"_2-2-3-监控-mysql-指定表数据输出控制台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-监控-mysql-指定表数据输出控制台"}},[a._v("#")]),a._v(" 2.2.3 监控 Mysql 指定表数据输出控制台")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("运行 maxwell 来监控 mysql 指定表数据更新")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 maxwell-1.29.2]$ bin/maxwell --\nuser='maxwell' --password='123456' --host='hadoop102' --filter \n'exclude: *.*, include:test_maxwell.test' --producer=stdout\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("向 test_maxwell.test 表插入一条数据，查看 maxwell 的监控")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('mysql> insert into test_maxwell.test values(7,\'ggg\');\n{"database":"test_maxwell","table":"test","type":"insert","ts"\n:1637247760,"xid":11818,"commit":true,"data":{"id":7,"name":"g\ngg"}}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("向 test_maxwell.test2 表插入一条数据，查看 maxwell 的监控")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> insert into test1 values(1,'nihao');\n本次没有收到任何信息\n说明 include 参数生效，只能监控指定的 mysql 表的信息\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("注：还可以设置 include:test_maxwell.*，通过此种方式来监控 mysql 某个库的所有")]),a._v(" "),s("p",[a._v("表，也就是说过滤整个库。读者可以自行测试。")])])]),a._v(" "),s("h4",{attrs:{id:"_2-2-4-监控-mysql-指定表全量数据输出控制台-数据初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-监控-mysql-指定表全量数据输出控制台-数据初始化"}},[a._v("#")]),a._v(" 2.2.4 监控 Mysql 指定表全量数据输出控制台，数据初始化")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("\tMaxwell 进程默认只能监控 mysql 的 binlog 日志的新增及变化的数据，但是Maxwell 是支持数据初始化的，可以通过修改 Maxwell 的元数据，来对 MySQL 的某张表进行数据初始化，也就是我们常说的全量同步。具体操作步骤如下：\n")])])]),s("p",[a._v("需求：将 test_maxwell 库下的 test2 表的四条数据，全量导入到 maxwell 控制台进行打印。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/24dd63418fbe4d4fb6e7a8ef1b102199.png",alt:"在这里插入图片描述"}})]),a._v(" "),s("ol",[s("li",[s("p",[a._v("修改 Maxwell 的元数据，触发数据初始化机制，在 mysql 的 maxwell 库中 bootstrap表中插入一条数据，写明需要全量数据的库名和表名。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> insert into maxwell.bootstrap(database_name,table_name) \nvalues('test_maxwell','test2');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/19c622fca38e4a409716b0db2abec6e7.png",alt:"在这里插入图片描述"}})]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[a._v("启动 maxwell 进程，此时初始化程序会直接打印 test2 表的所有数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('[atguigu@hadoop102 maxwell-1.29.2]$ bin/maxwell --\nuser=\'maxwell\' --password=\'123456\' --host=\'hadoop102\' --\nproducer=stdout\nUsing kafka version: 1.0.0\n23:15:38,841 WARN MaxwellMetrics - Metrics will not be \nexposed: metricsReportingType not configured.\n23:15:39,110 INFO Maxwell - Maxwell v1.22.0 is booting \n(StdoutProducer), starting at Position[BinlogPosition[mysqlbin.000004:611096], lastHeartbeat=1637248429242]\n23:15:39,194 INFO MysqlSavedSchema - Restoring schema id 6 \n(last modified at Position[BinlogPosition[mysqlbin.000004:517625], lastHeartbeat=1637246435111])\n23:15:39,299 INFO MysqlSavedSchema - Restoring schema id 1 \n(last modified at Position[BinlogPosition[mysqlbin.000004:158612], lastHeartbeat=0])\n23:15:39,342 INFO MysqlSavedSchema - beginning to play \ndeltas...\n23:15:39,343 INFO MysqlSavedSchema - played 5 deltas in 1ms\n{"database":"test_maxwell","table":"test2","type":"bootstrapstart","ts":1637248539,"data":{}}\n23:15:39,367 INFO SynchronousBootstrapper - bootstrapping \nstarted for test_maxwell.test2\n23:15:39,369 INFO BinlogConnectorReplicator - Setting initial \nbinlog pos to: mysql-bin.000004:611096\n{"database":"test_maxwell","table":"test2","type":"bootstrapinsert","ts":1637248539,"data":{"id":1,"name":"aa"}}\n{"database":"test_maxwell","table":"test2","type":"bootstrapinsert","ts":1637248539,"data":{"id":2,"name":"bb"}}\n{"database":"test_maxwell","table":"test2","type":"bootstrapinsert","ts":1637248539,"data":{"id":3,"name":"cc"}}\n{"database":"test_maxwell","table":"test2","type":"bootstrapinsert","ts":1637248539,"data":{"id":4,"name":"dd"}}\n{"database":"test_maxwell","table":"test2","type":"bootstrapcomplete","ts":1637248539,"data":{}}\n23:15:39,387 INFO SynchronousBootstrapper - bootstrapping \nended for #8 test_maxwell.test2\n23:15:39,465 INFO BinaryLogClient - Connected to \nhadoop102:3306 at mysql-bin.000004/611096 (sid:6379, cid:108)\n23:15:39,465 INFO BinlogConnectorLifecycleListener - Binlog \nconnected.\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("当数据全部初始化完成以后，Maxwell 的元数据会变化")]),a._v(" "),s("p",[a._v("is_complete 字段从 0 变为 1")]),a._v(" "),s("p",[a._v("start_at 字段从 null 变为具体时间(数据同步开始时间)")]),a._v(" "),s("p",[a._v("complete_at 字段从 null 变为具体时间(数据同步结束时间)")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/334027a213f440f884dd7f8a5a2faa0b.png",alt:"在这里插入图片描述"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{423:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("[toc]")]),s._v(" "),t("h2",{attrs:{id:"安装前置依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装前置依赖"}},[s._v("#")]),s._v(" 安装前置依赖")]),s._v(" "),t("ul",[t("li",[s._v("mysql")]),s._v(" "),t("li",[s._v("redis")])]),s._v(" "),t("h2",{attrs:{id:"二进制方式部署-推荐"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二进制方式部署-推荐"}},[s._v("#")]),s._v(" 二进制方式部署（推荐）")]),s._v(" "),t("p",[s._v("在网站现在最新安装包"),t("a",{attrs:{href:"https://flashcat.cloud/download/nightingale/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://flashcat.cloud/download/nightingale/"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download.flashcat.cloud/n9e-v6.3.1-linux-amd64.tar.gz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建个 n9e 的目录，后面把 n9e 相关的文件解压到这里")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /opt/n9e \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" n9e-v6.3.1-linux-amd64.tar.gz n9e\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" n9e\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" n9e-v6.3.1-linux-amd64.tar.gz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压缩之后，可以看到 n9e.sql 是建表语句，导入数据库")]),s._v("\nmysql "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p1234")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" n9e.sql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 n9e，先使用 nohup 简单测试，如果需要 systemd 托管，请自行准备 service 文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./n9e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" n9e.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查 n9e.log 是否有异常日志，检查端口是否在监听，正常应该监听在 17000")]),s._v("\nss -tlnp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("如果日志和端口都没啥问题，恭喜，你完成了夜莺的安装！通过浏览器访问这个机器的 17000，理论上就可以看到登录页面了。")]),s._v(" "),t("p",[s._v("访问"),t("code",[s._v("http://ip:17000")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/LYFn2H1cRgpVrAK.png",alt:"image-20231018113109193"}})]),s._v(" "),t("p",[s._v("默认账号密码：root root.2020")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/zmXSFsca5xOMBqd.png",alt:"image-20231018113202192"}})]),s._v(" "),t("h3",{attrs:{id:"夜莺日志位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#夜莺日志位置"}},[s._v("#")]),s._v(" 夜莺日志位置")]),s._v(" "),t("p",[s._v("n9e/n9e.log")]),s._v(" "),t("h2",{attrs:{id:"安装-victoriametrics"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-victoriametrics"}},[s._v("#")]),s._v(" 安装 VictoriaMetrics")]),s._v(" "),t("p",[s._v("VictoriaMetrics 下载地址在 "),t("a",{attrs:{href:"https://github.com/VictoriaMetrics/VictoriaMetrics/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("github releases"),t("OutboundLink")],1),s._v(" 上，作为技术人员，我想，你应该可以下载的到。我的环境是 x86_64 的 linux，所以选择下载：victoria-metrics-linux-amd64-v1.93.6.tar.gz （撰写这个文档的时候，最新版本是 v1.93.6）。")]),s._v(" "),t("p",[s._v("VictoriaMetrics 解压缩之后，里边就一个二进制：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mkdir victoria\ncd victoria\nwget https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.6/victoria-metrics-linux-amd64-v1.93.6.tar.gz\ntar -zxvf victoria-metrics-linux-amd64-v1.93.6.tar.gz \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("查看解压后文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32476")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11579644")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":44 victoria-metrics-linux-amd64-v1.93.6.tar.gz\n-rwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21669672")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 05:45 victoria-metrics-prod\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./victoria-metrics-prod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" stdout.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看端口8428")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -tlnp|grep 8428")]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v("        *:8428                     *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"victoria'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('metric"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("726")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("访问接口"),t("code",[s._v("http://ip:8428")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/VSyNp2cQvUZ4rgP.png",alt:"image-20231018114759187"}})]),s._v(" "),t("p",[s._v("如上，就表示 VictoriaMetrics 安装成功，当然，我仅仅使用 nohup 简单启动的，如果生产环境，建议使用 systemd 托管并设置开机自启动。")]),s._v(" "),t("h4",{attrs:{id:"打通夜莺和-victoriametrics"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打通夜莺和-victoriametrics"}},[s._v("#")]),s._v(" 打通夜莺和 VictoriaMetrics")]),s._v(" "),t("p",[s._v("分两个步骤，首先就类似上面配置 Prometheus 数据源那种方式，在夜莺里配置一个 VictoriaMetrics 的数据源，比如我的配置：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/UirZp3sJ9MmPdqO.png",alt:"image-20231018114854988"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/MfRsY2icyDVK5Um.png",alt:"image-20231018114927994"}})]),s._v(" "),t("p",[s._v("填写信息并保存")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/JjbspeRm9G84gE2.png",alt:"image-20231018115156792"}})]),s._v(" "),t("p",[s._v("进入夜莺的配置目录"),t("code",[s._v("/opt/n9e/etc")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/n9e/etc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('vim config.toml\n\n# 在 [Pushgw] 下，添加信息\n[[Pushgw.Writers]]\nUrl = "http://172.16.24.214:8428/api/v1/write"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("重启")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pkill")]),s._v(" n9e\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./n9e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" n9e.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"安装categraf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装categraf"}},[s._v("#")]),s._v(" 安装Categraf")]),s._v(" "),t("p",[s._v("在网站"),t("a",{attrs:{href:"https://flashcat.cloud/download/categraf/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://flashcat.cloud/download/categraf/"),t("OutboundLink")],1),s._v("下载最新版本")]),s._v(" "),t("h3",{attrs:{id:"安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[s._v("#")]),s._v(" 安装依赖")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" libpcap\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"下载命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载命令"}},[s._v("#")]),s._v(" 下载命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/categraf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v("  /opt/categraf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download.flashcat.cloud/categraf-v0.3.32-linux-amd64-with-cgo-plugin.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" categraf-v0.3.32-linux-amd64-with-cgo-plugin.tar.gz \n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" categraf-v0.3.32-linux-amd64-with-cgo-plugin\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ./* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),t("blockquote",[t("p",[s._v("tip:")]),s._v(" "),t("p",[s._v("安装客户端可以使用这个命令一键替换IP")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sed -i 's/127.0.0.1/172.16.24.214/g' /opt/categraf/conf/config.toml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("p",[s._v("修改文件"),t("code",[s._v("conf/config.toml")])]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("writer_opt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# default: 2000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("batch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channel(as queue) size")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("chan_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("writers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改为夜莺n9e安装的服务器IP地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("url")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://N9E:17000/prometheus/v1/write"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Basic auth username")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("basic_auth_user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Basic auth password")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("basic_auth_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timeout settings, unit: ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("dial_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("max_idle_conns_per_host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"日志目录设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志目录设置"}},[s._v("#")]),s._v(" 日志目录设置")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# file_name is the file to write logs to")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#file_name = "stdout"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("file_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/test.log"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",[t("li",[t("p",[s._v("打开 Categraf 安装目录下的 "),t("code",[s._v("conf")]),s._v(" 子目录。")])]),s._v(" "),t("li",[t("p",[s._v("使用文本编辑器打开 "),t("code",[s._v("config.toml")]),s._v(" 文件。")])]),s._v(" "),t("li",[t("p",[s._v("找到 "),t("code",[s._v("[log]")]),s._v(" 部分。")])]),s._v(" "),t("li",[t("p",[s._v("取消注释 "),t("code",[s._v("file_name")]),s._v(" 行（如果已注释），并将其值更改为 "),t("code",[s._v("/opt/test.log")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("保存对 "),t("code",[s._v("config.toml")]),s._v(" 文件的更改。")])]),s._v(" "),t("li",[t("p",[s._v("重启 Categraf 服务以使新的日志配置生效。")])]),s._v(" "),t("li",[t("p",[s._v("Categraf 的日志就会保存到 "),t("code",[s._v("/opt")]),s._v(" 目录下的 "),t("code",[s._v("test.log")]),s._v(" 文件中。请确保运行 Categraf 的用户具有对 "),t("code",[s._v("/opt")]),s._v(" 目录的写入权限。")])])]),s._v(" "),t("h3",{attrs:{id:"设置linux-systemd托管"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置linux-systemd托管"}},[s._v("#")]),s._v(" 设置Linux Systemd托管")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" conf/categraf.service /etc/systemd/system\n \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以服务方式启动")]),s._v("\nsystemctl start categraf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止服务")]),s._v("\nsystemctl stop categraf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启服务")]),s._v("\nsystemctl restart categraf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\nsystemctl status categraf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("blockquote",[t("p",[s._v("启动时可能报错：/opt/categraf/categraf: error while loading shared libraries: libpcap.so.0.8: cannot open shared object file: No such file or directory")]),s._v(" "),t("p",[s._v("没有 "),t("code",[s._v("libpcap.so.0.8")])]),s._v(" "),t("p",[s._v("解决方法")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libpcap "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看安装版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-al")]),s._v(" /usr/lib64/libpcap.so*\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 软连接到需要的版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/lib64/libpcap.so.1.5.3 /usr/lib64/libpcap.so.0.8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("p",[s._v("查看运行状态")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status categraf")]),s._v("\n● categraf.service - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Categraf"')]),s._v("\n   Loaded: loaded "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/categraf.service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" disabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Wed "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("-10-18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 CST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 3s ago\n Main PID: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/categraf.service\n           └─2104 /opt/categraf/categraf\n\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.mem started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.net started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.netstat started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.nfsclient started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.processes started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.self_metrics started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.sockstat started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 metrics_agent.go:299: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.system started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 agent.go:47: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*agent.MetricsAgent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" started\nOct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 centos7.9-template categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2104")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("/10/18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":33:22 agent.go:50: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" agent started\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("安装完成后可以在基础设施中查看到机器的状态")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/ukZGtgpjMo1rwaI.png",alt:"image-20231018134445978"}})]),s._v(" "),t("h4",{attrs:{id:"查看时序指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看时序指标"}},[s._v("#")]),s._v(" 查看时序指标")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/jxODdHET9Kot2ua.png",alt:"image-20231018141241344"}})]),s._v(" "),t("p",[s._v("也可以在这个页面快速查看")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/CDnZwv6fR8eo29Q.png",alt:"image-20231018141338727"}})]),s._v(" "),t("h3",{attrs:{id:"多节点监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多节点监控"}},[s._v("#")]),s._v(" 多节点监控")]),s._v(" "),t("p",[s._v("与上面步骤相同，只需要部署多个Categraf即可")]),s._v(" "),t("h2",{attrs:{id:"配置服务器监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置服务器监控"}},[s._v("#")]),s._v(" 配置服务器监控")]),s._v(" "),t("p",[s._v("上面步骤我们已经在页面通过Victoria查询出数据，这里我们选择展示仪表盘")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/MiywDOCsFvUB5x6.png",alt:"image-20231018142404401"}})]),s._v(" "),t("p",[s._v("选择前三个模板，点击批量导出")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/vzfN29n1b8EtGca.png",alt:"image-20231018142426094"}})]),s._v(" "),t("p",[s._v("选择业务组后点击克隆")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/rzvkJhFbLUd1Zt4.png",alt:"image-20231018142440592"}})]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("仪表盘")]),s._v("->"),t("code",[s._v("监控仪表盘")]),s._v("中可以看到三个仪表盘")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/A3c8vyPnQ2whE71.png",alt:"image-20231018142519568"}})]),s._v(" "),t("p",[s._v("点进去后可以看到不同展示监控页面")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/OG3IZS9KYxosVWy.png",alt:"image-20231018142536458"}})]),s._v(" "),t("h2",{attrs:{id:"监控mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控mysql"}},[s._v("#")]),s._v(" 监控MySQL")]),s._v(" "),t("p",[s._v("官方配置说明："),t("a",{attrs:{href:"https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/mysql/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/mysql/"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"修改categraf配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改categraf配置文件"}},[s._v("#")]),s._v(" 修改categraf配置文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" conf/input.mysql/mysql.toml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("内容如下(真实监控的配置文件)")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # collect interval")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# interval = 15")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [[queries]]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# mesurement = "users"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# metric_fields = [ "total" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# label_fields = [ "service" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# timeout = "3s"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# request = '''")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# select 'n9e' as service, count(*) as total from n9e_v5.users")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# '''")]),s._v("\n\n\n[[instances]]\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" address")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"172.1.2.1:3306"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" username")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"root"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" password")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"root"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # set tls=custom to enable tls")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" parameters")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"tls=false"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" extra_status_metrics")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" extra_innodb_metrics")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" gather_processlist_processes_by_state")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" gather_processlist_processes_by_user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" gather_schema_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" gather_table_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" gather_system_table_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" gather_slave_status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # timeout")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" timeout_seconds")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("3")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # interval = global.interval * interval_times")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" interval_times")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# important! use global unique string to specify instance")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# labels = { instance="n9e-10.2.3.4:3306" }')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Optional TLS Config")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use_tls = false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# tls_min_version = "1.2"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# tls_ca = "/etc/categraf/ca.pem"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# tls_cert = "/etc/categraf/cert.pem"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# tls_key = "/etc/categraf/key.pem"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Use TLS but skip chain & host verification")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# insecure_skip_verify = true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[[instances.queries]]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# mesurement = "lock_wait"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# metric_fields = [ "total" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# timeout = "3s"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# request = '''")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SELECT count(*) as total FROM information_schema.innodb_trx WHERE trx_state='LOCK WAIT'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#'''")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [[instances.queries]]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# mesurement = "users"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# metric_fields = [ "total" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# label_fields = [ "service" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# # field_to_append = ""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# timeout = "3s"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# request = '''")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# select 'n9e' as service, count(*) as total from n9e_v5.users")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# '''")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br")])]),t("p",[s._v("配置文件说明如下:")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 定义mysql采集周期")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("interval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("15")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义全局要执行的sql")]),s._v("\n  [[queries]]\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  mesurement")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"users"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  metric_fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('[ "total" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  label_fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('[ "service" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"3s"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  request")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("'''")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("'n9e' as service, count(*) as total from n9e_v5.users")]),s._v("\n  '''\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义instance， 一个instance对应一个mysql实例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定mysql的地址，用户名，密码")]),s._v("\n[[instances]]\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  address")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"127.0.0.1:3306"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  username")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"root"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  password")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"1234"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 是否使用tls 等定制参数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  parameters")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"tls=false"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 show global status监控mysql，默认抓取一些基础指标，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果想抓取更多global status的指标，把下面的配置设置为true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  extra_status_metrics")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过show global variables监控mysql的全局变量，默认抓取一些常规的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 常规的基本够用了，扩展的部分，默认不采集，下面的配置设置为false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  extra_innodb_metrics")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控processlist，关注较少，默认不采集")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  gather_processlist_processes_by_state")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  gather_processlist_processes_by_user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控各个数据库的磁盘占用大小")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  gather_schema_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控所有的table的磁盘占用大小")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  gather_table_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否采集系统表的大小，通常不用，所以默认设置为false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  gather_system_table_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 show slave status监控slave的情况，比较关键，所以默认采集")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  gather_slave_status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 超时时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  timeout_seconds")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("3")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采集周期的倍数，比如设置为2，那么采集周期就是 interval * 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  interval_times")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为mysql实例附一个instance的标签，因为通过address=127.0.0.1:3306不好区分")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  labels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('{ instance="n9e-10.2.3.4:3306" }')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(" # # tls相关配置  可选配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(" # Optional TLS Config")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  use_tls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  tls_min_version")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"1.2"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  tls_ca")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"/etc/categraf/ca.pem"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  tls_cert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"/etc/categraf/cert.pem"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  tls_key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"/etc/categraf/key.pem"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(" # Use TLS but skip chain & host verification")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  insecure_skip_verify")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  # 定义当前instance的sql")]),s._v("\n [[instances.queries]]\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  mesurement")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"lock_wait"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  metric_fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('[ "total" ]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"3s"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  request")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("'''")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("count(*) as total FROM information_schema.innodb_trx WHERE trx_state='LOCK WAIT'")]),s._v("\n  '''\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br")])]),t("h3",{attrs:{id:"配置仪表盘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置仪表盘"}},[s._v("#")]),s._v(" 配置仪表盘")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/vkV2EXRS7gm9p4U.png",alt:"image-20231018151732438"}})]),s._v(" "),t("p",[s._v("选择克隆")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/tjJIWKh2cmVYxdR.png",alt:"image-20231018151922549"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/jEwtihpGMcPCN1f.png",alt:"image-20231018151929277"}})]),s._v(" "),t("p",[s._v("在仪表盘页面进入该监控，可以看到MySQL监控")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/kSqjUOyFnA7zuLc.png",alt:"image-20231018152026903"}})]),s._v(" "),t("h2",{attrs:{id:"监控进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控进程"}},[s._v("#")]),s._v(" 监控进程")]),s._v(" "),t("p",[s._v("官方说明:"),t("a",{attrs:{href:"https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/procstat/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/procstat/"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"修改categraf配置文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改categraf配置文件-2"}},[s._v("#")]),s._v(" 修改categraf配置文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" conf/input.procstat/procstat.toml \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("监控"),t("code",[s._v("categraf")]),s._v("与"),t("code",[s._v("categraf")]),s._v("进程")]),s._v(" "),t("blockquote",[t("p",[s._v("注意：如果配置多个监控，要将下面每个详细配置都单独配置一遍")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # collect interval")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("interval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("15")]),s._v("\n[[instances]]\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  search_cmdline_substring")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"categraf"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  gather_total")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tgather_per_pid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" \tgather_more_metrics")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("[")]),s._v('\n     "threads",\n     "fd",\n     "io",\n     "uptime",\n     "cpu",\n     "mem",\n     "limit",\n     "jvm"\n \t]\n[[instances]]\n'),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # executable name (ie, pgrep <search_exec_substring>)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#search_exec_substring = "nginx"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # pattern as argument for pgrep (ie, pgrep -f <search_cmdline_substring>)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" search_cmdline_substring")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"paddlenlp"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # windows service name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# search_win_service = ""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # search process with specific user, option with exec_substring or cmdline_substring")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# search_user = ""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # append some labels for series")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# labels = { region="cloud", product="n9e" }')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # interval = global.interval * interval_times")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# interval_times = 1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # mode to use when calculating CPU usage. can be one of 'solaris' or 'irix'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# mode = "irix"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sum of threads/fd/io/cpu/mem, min of uptime/limit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("gather_total")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# will append pid as tag")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("gather_per_pid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  gather jvm metrics only when jstat is ready")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v(" gather_more_metrics")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("[")]),s._v('\n     "threads",\n     "fd",\n     "io",\n     "uptime",\n     "cpu",\n     "mem",\n     "limit",\n     "jvm"\n ]\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br")])]),t("p",[s._v("去注释版本")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('interval = 15\n[[instances]]\n  search_cmdline_substring ="categraf"\n  gather_total = true\n\tgather_per_pid = false\n \tgather_more_metrics = [\n     "threads",\n     "fd",\n     "io",\n     "uptime",\n     "cpu",\n     "mem",\n     "limit",\n     "jvm"\n \t]\n[[instances]]\nsearch_cmdline_substring ="paddlenlp"\ngather_total = true\ngather_per_pid = false\ngather_more_metrics = [\n     "threads",\n     "fd",\n     "io",\n     "uptime",\n     "cpu",\n     "mem",\n     "limit",\n     "jvm"\n ]\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("选择仪表盘")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/jQxTpcZBylR19ft.png",alt:"image-20231018173414017"}})]),s._v(" "),t("p",[s._v("克隆")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/eXxE7lOsQuIJt4N.png",alt:"image-20231018173425439"}})]),s._v(" "),t("p",[s._v("点击进入可以看到监控状态")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/A3X8fnIqtvwF15x.png",alt:"image-20231018173510049"}})]),s._v(" "),t("h2",{attrs:{id:"告警配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#告警配置"}},[s._v("#")]),s._v(" 告警配置")]),s._v(" "),t("p",[s._v("进入 "),t("code",[s._v("系统配置")]),s._v(" -> "),t("code",[s._v("通知设置")]),s._v(" -> "),t("code",[s._v("SMTP设置")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/N2RI8oWckEJAFuz.png",alt:"image-20231018171757953"}})]),s._v(" "),t("p",[s._v("配置发送预警邮箱")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/q5kcyRD36ALr4hl.png",alt:"image-20231018171846780"}})]),s._v(" "),t("p",[s._v("进入"),t("code",[s._v("告警管理")]),s._v("->"),t("code",[s._v("内置规则")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/MwjVI8KOuGzpvge.png",alt:"image-20231018171914038"}})]),s._v(" "),t("p",[s._v("选择 "),t("code",[s._v("Procstat")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/od6G1EgpkIHuC9D.png",alt:"image-20231018172008856"}})]),s._v(" "),t("p",[s._v("选择第二个，并点击克隆，这个选项为当监控进程数为零则认为异常")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/ETDN7sagJkZob1V.png",alt:"image-20231018172033428"}})]),s._v(" "),t("p",[s._v("导入到指定业务组")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/76VnCARasd2y4MP.png",alt:"image-20231018172122355"}})]),s._v(" "),t("p",[s._v("选择"),t("code",[s._v("告警管理")]),s._v("->"),t("code",[s._v("告警规则")]),s._v("可以看到我们克隆的预警规则")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/V6LoOf21Nt8SQcw.png",alt:"image-20231018172144703"}})]),s._v(" "),t("p",[s._v("这里我们先设置一下人员组织，设置接收预警的人员")]),s._v(" "),t("p",[s._v("设置用户")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/sUtP3nmIR4agq58.png",alt:"image-20231018172554441"}})]),s._v(" "),t("p",[s._v("添加两个用户，并设置邮箱")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/YeK4mC6WnvwZBP1.png",alt:"image-20231018172719400"}})]),s._v(" "),t("p",[s._v("设置团队")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/3zAT8BpFjySOxlq.png",alt:"image-20231018172405896"}})]),s._v(" "),t("p",[s._v("点击新增、输入名称")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/ytQ14V9OPYBwCUW.png",alt:"image-20231018172425006"}})]),s._v(" "),t("p",[s._v("新增成员")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/9BWgFquwGlQhiNT.png",alt:"image-20231018172510271"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/q6A7yKokdcvpfQU.png",alt:"image-20231018172739711"}})]),s._v(" "),t("p",[s._v("回到"),t("code",[s._v("告警管理")]),s._v("->"),t("code",[s._v("告警规则")]),s._v(",点击名称进入规则")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/7m9kC2QbqTltAjp.png",alt:"image-20231018172918233"}})]),s._v(" "),t("p",[s._v("保存，点击启用")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/leig9yjkEuHo5T4.png",alt:"image-20231018172943172"}})]),s._v(" "),t("p",[s._v("上面我设置监控预警规则为进程数为1 时进行预警，为了测试效果，生产改为0。")]),s._v(" "),t("p",[s._v("过一会在邮件中可以看到预警邮件")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/iJMDs7PTSXICbKE.png",alt:"image-20231018173159245"}})]),s._v(" "),t("h3",{attrs:{id:"配置指定机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置指定机器"}},[s._v("#")]),s._v(" 配置指定机器")]),s._v(" "),t("p",[s._v("上面的预警配置，默认会应用的所有机器，下面介绍如何监控指定的机器进行预警。")]),s._v(" "),t("h4",{attrs:{id:"给机器配置标签"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#给机器配置标签"}},[s._v("#")]),s._v(" 给机器配置标签")]),s._v(" "),t("p",[s._v("选择"),t("code",[s._v("基础设置")]),s._v("->"),t("code",[s._v("机器列表")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/zAiSgCUFhtNO9Bd.png",alt:"image-20231019100821808"}})]),s._v(" "),t("p",[s._v("勾选我们需要设置标签的服务器，点击右上角"),t("code",[s._v("批量操作")]),s._v("->"),t("code",[s._v("绑定标签")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/yjINwJMpDU3mh2t.png",alt:"image-20231019100900687"}})]),s._v(" "),t("p",[s._v("输入需要设置的标签名,标签格式需要为"),t("code",[s._v("key=value")]),s._v("这样，key要是使用数字字母开头")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/10/24/avYbIHzjdpDuOJq.png",alt:"image-20231019101809938"}})]),s._v(" "),t("p",[s._v("这里我设置成"),t("code",[s._v("ip=xxxx")]),s._v("，每台机器都添加一个，方便后面设置区分。我们也可以根据服务器部署服务类型来这是其他的标签如"),t("code",[s._v("type=开发环境Hadoop集群")]),s._v("。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/11/08/3WNYQdFk1zajKDH.png",alt:"image-20231019102309124"}})]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("时序指标")]),s._v("->"),t("code",[s._v("即时查询")]),s._v("，搜索我们需要预警的指标")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/11/08/yUOFMImgwnvriJK.png",alt:"image-20231019143653664"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/11/08/rlqVtCe65w1Hyjv.png",alt:"image-20231019143800873"}})]),s._v(" "),t("p",[s._v("可以看到指标下有具体的参数。")]),s._v(" "),t("p",[s._v("在告警规则中配置告警条件,选择我们刚刚配置的标签")]),s._v(" "),t("p",[t("code",[s._v('procstat_lookup_count{ip="xxx",search_string="paddlenlp"} == 0 or procstat_lookup_count{ip="xxx",search_string="paddlenlp"} == 0 or procstat_lookup_count{ip="xxx",search_string="paddlenlp"} == 0')])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/11/08/tHrCzM1hgjq26Zf.png",alt:"image-20231019143906546"}})]),s._v(" "),t("p",[s._v("保存，这时预警就会根据设置的具体条件进行预警。")]),s._v(" "),t("h3",{attrs:{id:"多台机器告警时显示异常机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多台机器告警时显示异常机器"}},[s._v("#")]),s._v(" 多台机器告警时显示异常机器")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flashcat.cloud/docs/content/flashcat-monitor/nightingale-v6/usage/alert/alert-rule/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://flashcat.cloud/docs/content/flashcat-monitor/nightingale-v6/usage/alert/alert-rule/"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/11/08/jBWNpruTJoQLXEt.png",alt:"image-20231019155943036"}})]),s._v(" "),t("p",[s._v("配置样例：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/11/08/semnGIpHZKiJAE1.png",alt:"image-20231022135327727"}})]),s._v(" "),t("h2",{attrs:{id:"常用命令总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令总结"}},[s._v("#")]),s._v(" 常用命令总结")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以服务方式启动")]),s._v("\nsystemctl start categraf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止服务")]),s._v("\nsystemctl stop categraf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启服务")]),s._v("\nsystemctl restart categraf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\nsystemctl status categraf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"历史监控内容清除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#历史监控内容清除"}},[s._v("#")]),s._v(" 历史监控内容清除")])])}),[],!1,null,null,null);t.default=e.exports}}]);
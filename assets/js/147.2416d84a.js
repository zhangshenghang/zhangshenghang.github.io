(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{513:function(t,e,a){"use strict";a.r(e);var s=a(8),r=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("[toc]")]),t._v(" "),e("h2",{attrs:{id:"创建worker分组-指定执行机器使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建worker分组-指定执行机器使用"}},[t._v("#")]),t._v(" 创建Worker分组-指定执行机器使用")]),t._v(" "),e("p",[t._v("在这里设置分组后，执行程序时选择需要执行在哪个分组内的程序执行程序")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/e78zmfsYtb6uZvI.png",alt:"image-20230323152012277"}})]),t._v(" "),e("h2",{attrs:{id:"创建执行脚本用户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建执行脚本用户"}},[t._v("#")]),t._v(" 创建执行脚本用户")]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("安全中心")]),t._v("->"),e("code",[t._v("租户管理")]),t._v("->"),e("code",[t._v("创建用户")])]),t._v(" "),e("p",[t._v("这里创建的用户就是对应Linux操作系统的用户，在任务调度执行时选择在Linux中执行脚本的用户")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/bcYSgNChnualTHE.png",alt:"image-20230323144742610"}})]),t._v(" "),e("h1",{attrs:{id:"执行脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本"}},[t._v("#")]),t._v(" 执行脚本")]),t._v(" "),e("h2",{attrs:{id:"执行shell脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行shell脚本"}},[t._v("#")]),t._v(" 执行Shell脚本")]),t._v(" "),e("p",[e("code",[t._v("项目管理")]),t._v("->"),e("code",[t._v("工作流")]),t._v("->"),e("code",[t._v("工作流定义")]),t._v("->"),e("code",[t._v("创建工作流")])]),t._v(" "),e("p",[t._v("点击"),e("code",[t._v("创建工作流")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/zqEMjIwTNpvRigk.png",alt:"image-20230323145451220"}})]),t._v(" "),e("p",[t._v("参数说明：")]),t._v(" "),e("ul",[e("li",[t._v("任务名称：设置任务的名称。一个工作流定义中的节点名称是唯一的。")]),t._v(" "),e("li",[t._v("运行标志：标识这个节点是否能正常调度,如果不需要执行，可以打开禁止执行开关。")]),t._v(" "),e("li",[t._v("描述：描述该节点的功能。")]),t._v(" "),e("li",[t._v("任务优先级：worker 线程数不足时，根据优先级从高到低依次执行，优先级一样时根据先进先出原则执行。")]),t._v(" "),e("li",[t._v("Worker 分组：任务分配给 worker 组的机器机执行，选择 Default，会随机选择一台 worker 机执行。")]),t._v(" "),e("li",[t._v("环境名称：配置运行脚本的环境。")]),t._v(" "),e("li",[t._v("失败重试次数：任务失败重新提交的次数，支持下拉和手填。")]),t._v(" "),e("li",[t._v("失败重试间隔：任务失败重新提交任务的时间间隔，支持下拉和手填。")]),t._v(" "),e("li",[t._v("超时告警：勾选超时告警、超时失败，当任务超过”超时时长”后，会发送告警邮件并且任务执行失败.")]),t._v(" "),e("li",[t._v("脚本：用户开发的 SHELL 程序。")]),t._v(" "),e("li",[t._v("资源：是指脚本中需要调用的资源文件列表，资源中心-文件管理上传或创建的文件。")]),t._v(" "),e("li",[t._v("自定义参数：是 SHELL 局部的用户自定义参数，会替换脚本中以 "),e("code",[t._v("${变量}")]),t._v(" 的内容。")]),t._v(" "),e("li",[t._v("前置任务：选择当前任务的前置任务，会将被选择的前置任务设置为当前任务的上游。")])]),t._v(" "),e("p",[t._v("将"),e("code",[t._v("SHELL")]),t._v("拖入画布")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/kzoBs5WXlf2VhEY.png",alt:"image-20230323145528076"}})]),t._v(" "),e("p",[t._v("输入节点名称（命名为我们要做的内容）")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/MDgVXmSenCUjuRk.png",alt:"image-20230323145608036"}})]),t._v(" "),e("p",[t._v("输入脚本要执行的内容")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/DFMj98zBdiQhRVS.png",alt:"image-20230323145635963"}})]),t._v(" "),e("blockquote",[e("p",[t._v("需要执行多行内容回车换行就行，这里使用相同命令执行两次来验证多行命令")])]),t._v(" "),e("p",[t._v("再拖一个SHELL到画布，名称为：查看北京时间，内容为"),e("code",[t._v("curl http://worldtimeapi.org/api/timezone/Asia/Shanghai")])]),t._v(" "),e("p",[t._v("将两个任务连起来，即：执行完查看IP后，再执行查看北京时间，点击右上角"),e("code",[t._v("保存")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/aiIzBrnXUYCc9fe.png",alt:"image-20230323145943438"}})]),t._v(" "),e("p",[t._v("为工作流命名，租户选择我们配置的租户(可在"),e("code",[t._v("安全中心")]),t._v("->"),e("code",[t._v("租户管理")]),t._v("设置)，并设置执行策略为串行等待")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/XtZ2HQwsjDNnL8k.png",alt:"image-20230323150812095"}})]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("工作流定义")]),t._v("中可以看到我们创建的工作流")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/w3BXsmLOCb5l9Fg.png",alt:"image-20230323150205698"}})]),t._v(" "),e("p",[t._v("点击"),e("code",[t._v("上线")]),t._v("按钮后才可以执行")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/1uDBHpN6KOxljWc.png",alt:"image-20230323150224615"}})]),t._v(" "),e("p",[t._v("再点击"),e("code",[t._v("执行")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/9je5qO3mdV1sFEM.png",alt:"image-20230323150301281"}})]),t._v(" "),e("p",[t._v("配置启动参数，保存")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/oeYCl1EadNrp9iT.png",alt:"image-20230323150331448"}})]),t._v(" "),e("p",[t._v("说明：")]),t._v(" "),e("p",[e("strong",[t._v("Worker分组")]),t._v("：DolphinScheduler的Worker节点可以在"),e("code",[t._v("安全中心")]),t._v("->"),e("code",[t._v("Worker分组管理")]),t._v("将服务器进行分组，程序在执行时配置Worker分组即可在相对应的分组机器执行")]),t._v(" "),e("p",[t._v("执行后，在任务示例中可以看到我们执行的记录与状态，如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/lFvt2fcQSI4amDw.png",alt:"image-20230323151031069"}})]),t._v(" "),e("p",[t._v("查看执行日志")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/ekts9jYH1VilPdK.png",alt:"image-20230323151049292"}})]),t._v(" "),e("p",[t._v("查看IP的日志")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/qbW6fHGBpQSOyhd.png",alt:"image-20230323151122267"}})]),t._v(" "),e("p",[t._v("查看北京时间日志")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/57Y1LHCfKg6sAV3.png",alt:"image-20230323151209886"}})]),t._v(" "),e("p",[e("strong",[t._v("补充说明：")])]),t._v(" "),e("p",[t._v("在任务定义中可以看到我们刚刚创建的所有任务")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/cFJ8xMdDqezRwVG.png",alt:"image-20230323152415742"}})]),t._v(" "),e("p",[t._v("到此SHELL基础调度介绍到这里")]),t._v(" "),e("h2",{attrs:{id:"执行spark任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行spark任务"}},[t._v("#")]),t._v(" 执行Spark任务")]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("工作流定义")]),t._v("中拖入Spark到画布")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/VuapvjW4ICyskZg.png",alt:"image-20230324134219541"}})]),t._v(" "),e("p",[t._v("填写相关参数，参数说明：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("参数名称")]),t._v(" "),e("th",[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("节点名称")]),t._v(" "),e("td",[t._v("在画布和任务定义中显示任务的名称")])]),t._v(" "),e("tr",[e("td",[t._v("运行标志")]),t._v(" "),e("td",[t._v("正常/禁止运行，禁止运行后任务不会启动不会运行")])]),t._v(" "),e("tr",[e("td",[t._v("描述")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("任务优先级")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("Worker分组")]),t._v(" "),e("td",[t._v("任务执行在哪个分组的机器")])]),t._v(" "),e("tr",[e("td",[t._v("环境名称")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("任务组名称")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("组内优先级")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("失败重试次数")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("失败重试间隔")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("延时执行时间")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("超时警告")]),t._v(" "),e("td",[t._v("设置程序多久未执行完，未完成进行告警或失败")])]),t._v(" "),e("tr",[e("td",[t._v("程序类型")]),t._v(" "),e("td",[t._v("选择Scala、Java、Python、SQL")])]),t._v(" "),e("tr",[e("td",[t._v("Spark版本")]),t._v(" "),e("td",[t._v("Spark1，Spark2 具体执行脚本为我们安装集群配置的Spark的环境变量")])]),t._v(" "),e("tr",[e("td",[t._v("主函数的Class")]),t._v(" "),e("td",[t._v("需要执行的类")])]),t._v(" "),e("tr",[e("td",[t._v("主程序包")]),t._v(" "),e("td",[t._v("需要执行的程序Jar包，在资源中心上传后可以在这里选择")])]),t._v(" "),e("tr",[e("td",[t._v("集群部署方式")]),t._v(" "),e("td",[t._v("cluster/client/local")])]),t._v(" "),e("tr",[e("td",[t._v("任务名称")]),t._v(" "),e("td",[t._v("对应 --name")])]),t._v(" "),e("tr",[e("td",[t._v("Driver核心数")]),t._v(" "),e("td",[t._v("对应 --driver-cores")])]),t._v(" "),e("tr",[e("td",[t._v("Driver内存数")]),t._v(" "),e("td",[t._v("对应 --driver-memory")])]),t._v(" "),e("tr",[e("td",[t._v("Executor数量")]),t._v(" "),e("td",[t._v("对应 --num-executors")])]),t._v(" "),e("tr",[e("td",[t._v("Executor内存数")]),t._v(" "),e("td",[t._v("对应 --executor-memory")])]),t._v(" "),e("tr",[e("td",[t._v("Executor核心数")]),t._v(" "),e("td",[t._v("对应 --executor-cores")])]),t._v(" "),e("tr",[e("td",[t._v("主程序参数")]),t._v(" "),e("td",[t._v("程序入口传入的参数")])]),t._v(" "),e("tr",[e("td",[t._v("选项参数")]),t._v(" "),e("td",[t._v("自定义传入参数如：--jars $(echo /data/spark-job/label-offline/lib/*.jar --files /data/spark-job/cdp-label-offline/env.properties")])]),t._v(" "),e("tr",[e("td",[t._v("资源")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("自定义参数")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("前置任务")]),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/c1HFvyiEJpOlgor.png",alt:"image-20230324141240826"}})]),t._v(" "),e("h3",{attrs:{id:"执行spark任务可能的报错"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行spark任务可能的报错"}},[t._v("#")]),t._v(" 执行Spark任务可能的报错")]),t._v(" "),e("h4",{attrs:{id:"storage-service-config-does-not-exist"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#storage-service-config-does-not-exist"}},[t._v("#")]),t._v(" Storage service config does not exist!")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[ERROR] 2023-03-23 09:51:50.024 +0000 - Task execute failed, due to meet an exception\norg.apache.dolphinscheduler.common.exception.StorageOperateNoConfiguredException: Storage service config does not exist!\n\tat org.apache.dolphinscheduler.server.worker.utils.TaskExecutionCheckerUtils.downloadResourcesIfNeeded(TaskExecutionCheckerUtils.java:115)\n\tat org.apache.dolphinscheduler.server.worker.runner.WorkerTaskExecuteRunnable.beforeExecute(WorkerTaskExecuteRunnable.java:216)\n\tat org.apache.dolphinscheduler.server.worker.runner.WorkerTaskExecuteRunnable.run(WorkerTaskExecuteRunnable.java:170)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131)\n\tat com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74)\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n[INFO] 2023-03-23 09:51:50.026 +0000 - Get a exception when execute the task, will send the task execute result to master, the current task execute result is TaskExecutionStatus{code=6, desc='failure'}\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("p",[t._v("原因：")]),t._v(" "),e("p",[t._v("配置资源中心时"),e("code",[t._v("worker-server/conf/common.properties")]),t._v("忘记配置HDFS配置了，只配置了"),e("code",[t._v("api-server/conf/common.properties")])]),t._v(" "),e("p",[t._v("解决方法：")]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("worker-server/conf/common.properties")]),t._v("配置文件中添加HDFS配置，重新部署服务"),e("code",[t._v("sh bin/install.sh")])]),t._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# user data local directory path, please make sure the directory exists and have read write permissions")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("data.basedir.path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/tmp/dolphinscheduler")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# resource storage type: HDFS, S3, OSS, NONE")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("resource.storage.type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("HDFS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if resource.storage.type=HDFS, the user must have the permission to create directories under the HDFS root path")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("resource.hdfs.root.user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("hdfs")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if resource.storage.type=S3, the value like: s3a://dolphinscheduler; if resource.storage.type=HDFS and namenode HA is enabled, you need to copy core-site.xml and hdfs-site.xml to conf dir")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("resource.hdfs.fs.defaultFS")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("hdfs://172.16.24.194:8020")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# resourcemanager port, the default value is 8088 if not specified")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("resource.manager.httpaddress.port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("8088")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if resourcemanager HA is enabled, please set the HA IPs; if resourcemanager is single, keep this value empty")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("yarn.resourcemanager.ha.rm.ids")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if resourcemanager HA is enabled or not use resourcemanager, please keep the default value; If resourcemanager is single, you only need to replace ds1 to actual resourcemanager hostname")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("yarn.application.status.address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://172.16.4.194:%s/ws/v1/cluster/apps/%s")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# job history status url when application number threshold is reached(default 10000, maybe it was set to 1000)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("yarn.job.history.status.address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://172.16.24.195:19888/ws/v1/history/mapreduce/jobs/%s")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br")])]),e("h2",{attrs:{id:"执行hive任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行hive任务"}},[t._v("#")]),t._v(" 执行Hive任务")]),t._v(" "),e("p",[t._v("拖入Hive到画布，填写"),e("code",[t._v("节点名称")]),t._v(","),e("code",[t._v("Hive Clie任务类型")]),t._v(","),e("code",[t._v("Hive SQL脚本")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/7dUKzsDPOprE5Tf.png",alt:"image-20230324145755488"}})]),t._v(" "),e("p",[t._v("保存执行，在"),e("code",[t._v("任务实例")]),t._v("查看日志，可以查看到我们执行的命令结果")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/8DFZuK1Gbhsztp3.png",alt:"image-20230324145936414"}})]),t._v(" "),e("h2",{attrs:{id:"执行http任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行http任务"}},[t._v("#")]),t._v(" 执行HTTP任务")]),t._v(" "),e("p",[t._v("该节点用于执行 "),e("em",[t._v("http")]),t._v(" 类型的任务，例如常见的 POST、GET 等请求类型，此外还支持 "),e("em",[t._v("http")]),t._v(" 请求校验等功能。")]),t._v(" "),e("h3",{attrs:{id:"创建任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建任务"}},[t._v("#")]),t._v(" 创建任务")]),t._v(" "),e("ul",[e("li",[t._v("点击项目管理 -> 项目名称 -> 工作流定义，点击”创建工作流”按钮，进入 DAG 编辑页面：")]),t._v(" "),e("li",[t._v("拖动工具栏的 "),e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/ikoubX3S17yGscI.png",alt:"image-20230324151321850"}}),t._v(" 任务节点到画板中。")])]),t._v(" "),e("h3",{attrs:{id:"任务参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务参数"}},[t._v("#")]),t._v(" 任务参数")]),t._v(" "),e("ul",[e("li",[t._v("节点名称：设置任务的名称。一个工作流定义中的节点名称是唯一的。")]),t._v(" "),e("li",[t._v("运行标志：标识这个节点是否能正常调度,如果不需要执行，可以打开禁止执行开关。")]),t._v(" "),e("li",[t._v("描述：描述该节点的功能。")]),t._v(" "),e("li",[t._v("任务优先级：worker 线程数不足时，根据优先级从高到低依次执行，优先级一样时根据先进先出原则执行。")]),t._v(" "),e("li",[t._v("Worker 分组：任务分配给 worker 组的机器机执行，选择 Default，会随机选择一台 worker 机执行。")]),t._v(" "),e("li",[t._v("环境名称：配置运行任务的环境。")]),t._v(" "),e("li",[t._v("失败重试次数：任务失败重新提交的次数，支持下拉和手填。")]),t._v(" "),e("li",[t._v("失败重试间隔：任务失败重新提交任务的时间间隔，支持下拉和手填。")]),t._v(" "),e("li",[t._v("延迟执行时间：任务延迟执行的时间，以分为单位。")]),t._v(" "),e("li",[t._v("超时告警：勾选超时告警、超时失败，当任务超过”超时时长”后，会发送告警邮件并且任务执行失败。")]),t._v(" "),e("li",[t._v("请求地址："),e("em",[t._v("http")]),t._v(" 请求 URL。")]),t._v(" "),e("li",[t._v("请求类型：支持 GET、POST、HEAD、PUT、DELETE。")]),t._v(" "),e("li",[t._v("请求参数：支持 Parameter、Body、Headers。")]),t._v(" "),e("li",[t._v("校验条件：支持默认响应码、自定义响应码、内容包含、内容不包含。")]),t._v(" "),e("li",[t._v("校验内容：当校验条件选择自定义响应码、内容包含、内容不包含时，需填写校验内容。")]),t._v(" "),e("li",[t._v("自定义参数：是 "),e("em",[t._v("http")]),t._v(" 局部的用户自定义参数，会替换脚本中以 ${变量} 的内容。")]),t._v(" "),e("li",[t._v("前置任务：选择当前任务的前置任务，会将被选择的前置任务设置为当前任务的上游。")])]),t._v(" "),e("h3",{attrs:{id:"任务样例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务样例"}},[t._v("#")]),t._v(" 任务样例")]),t._v(" "),e("ul",[e("li")]),t._v(" "),e("p",[t._v("HTTP* 定义了与服务器交互的不同方法，最基本的方法有4种，分别是GET，POST，PUT，DELETE。这里我们使用 "),e("em",[t._v("http")]),t._v(" 任务节点，演示使用 POST 向系统的登录页面发送请求，提交数据。")]),t._v(" "),e("p",[t._v("主要配置参数如下：")]),t._v(" "),e("ul",[e("li",[t._v("URL：访问目标资源的地址，这里为系统的登录页面。")]),t._v(" "),e("li",[t._v("HTTP Parameters\n"),e("ul",[e("li",[t._v("userName：用户名；")]),t._v(" "),e("li",[t._v("userPassword：用户登录密码。")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/8cJRLs1g4VMeaAk.png",alt:"http_task"}})]),t._v(" "),e("h1",{attrs:{id:"参数使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数使用"}},[t._v("#")]),t._v(" 参数使用")]),t._v(" "),e("h2",{attrs:{id:"内置参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内置参数"}},[t._v("#")]),t._v(" 内置参数")]),t._v(" "),e("h3",{attrs:{id:"基础内置参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础内置参数"}},[t._v("#")]),t._v(" 基础内置参数")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("变量名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("声明方式")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("system.biz.date")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("${system.biz.date}")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("日常调度实例定时的定时时间前一天，格式为 yyyyMMdd")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("system.biz.curdate")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("${system.biz.curdate}")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("日常调度实例定时的定时时间，格式为 yyyyMMdd")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("system.datetime")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("${system.datetime}")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("日常调度实例定时的定时时间，格式为 yyyyMMddHHmmss")])])])]),t._v(" "),e("h3",{attrs:{id:"衍生内置参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#衍生内置参数"}},[t._v("#")]),t._v(" 衍生内置参数")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("支持代码中自定义变量名，声明方式：${变量名}。可以是引用 “系统参数”")])]),t._v(" "),e("li",[e("p",[t._v("我们定义这种基准变量为 $[…] 格式的，$[yyyyMMddHHmmss] 是可以任意分解组合的，比如：$[yyyyMMdd], $[HHmmss], $[yyyy-MM-dd] 等")])]),t._v(" "),e("li",[e("p",[t._v("也可以通过以下两种方式：")]),t._v(" "),e("p",[t._v("1.使用add_months()函数，该函数用于加减月份， 第一个入口参数为[yyyyMMdd]，表示返回时间的格式 第二个入口参数为月份偏移量，表示加减多少个月")]),t._v(" "),e("ul",[e("li",[t._v("后 N 年：$[add_months(yyyyMMdd,12*N)]")]),t._v(" "),e("li",[t._v("前 N 年：$[add_months(yyyyMMdd,-12*N)]")]),t._v(" "),e("li",[t._v("后 N 月：$[add_months(yyyyMMdd,N)]")]),t._v(" "),e("li",[t._v("前 N 月：$[add_months(yyyyMMdd,-N)]")])]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("2.直接加减数字 在自定义格式后直接“+/-”数字")]),t._v(" "),e("ul",[e("li",[t._v("后 N 周：$[yyyyMMdd+7*N]")]),t._v(" "),e("li",[t._v("前 N 周：$[yyyyMMdd-7*N]")]),t._v(" "),e("li",[t._v("后 N 天：$[yyyyMMdd+N]")]),t._v(" "),e("li",[t._v("前 N 天：$[yyyyMMdd-N]")]),t._v(" "),e("li",[t._v("后 N 小时：$[HHmmss+N/24]")]),t._v(" "),e("li",[t._v("前 N 小时：$[HHmmss-N/24]")]),t._v(" "),e("li",[t._v("后 N 分钟：$[HHmmss+N/24/60]")]),t._v(" "),e("li",[t._v("前 N 分钟：$[HHmmss-N/24/60]")])])])]),t._v(" "),e("h3",{attrs:{id:"画布中引用方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#画布中引用方法"}},[t._v("#")]),t._v(" 画布中引用方法")]),t._v(" "),e("h4",{attrs:{id:"方法一-通过自定义参数赋值引用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方法一-通过自定义参数赋值引用"}},[t._v("#")]),t._v(" 方法一：通过自定义参数赋值引用")]),t._v(" "),e("p",[t._v("IN 是在当前运行脚本中生效")]),t._v(" "),e("p",[t._v("OUT 是在DAG图的下一个脚本生效")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/6TZHnJpwy3I5ihe.png",alt:"image-20230324171529278"}})]),t._v(" "),e("h4",{attrs:{id:"方法二-直接在脚本中使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方法二-直接在脚本中使用"}},[t._v("#")]),t._v(" 方法二：直接在脚本中使用")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/dDMXqR26AxIuLaf.png",alt:"image-20230324171704153"}})]),t._v(" "),e("h2",{attrs:{id:"全局参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全局参数"}},[t._v("#")]),t._v(" 全局参数")]),t._v(" "),e("h3",{attrs:{id:"作用域"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#作用域"}},[t._v("#")]),t._v(" 作用域")]),t._v(" "),e("p",[t._v("全局参数是指针对"),e("strong",[t._v("整个工作流")]),t._v("的所有任务节点都有效的参数，在工作流定义页面配置。")]),t._v(" "),e("h3",{attrs:{id:"使用方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[t._v("#")]),t._v(" 使用方式")]),t._v(" "),e("p",[t._v("具体的使用方式可结合实际的生产情况而定，这里演示为使用 Shell 任务打印出前一天的日期。")]),t._v(" "),e("h4",{attrs:{id:"创建-shell-任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-shell-任务"}},[t._v("#")]),t._v(" 创建 Shell 任务")]),t._v(" "),e("p",[t._v("创建一个 Shell 任务，并在脚本内容中输入 "),e("code",[t._v("echo ${dt2}")]),t._v("。此时 dt2 则为我们需要声明的全局参数。如下图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/1rxJkfmXGUuOA3E.png",alt:"image-20230324205820071"}})]),t._v(" "),e("h4",{attrs:{id:"保存工作流-并设置全局参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#保存工作流-并设置全局参数"}},[t._v("#")]),t._v(" 保存工作流，并设置全局参数")]),t._v(" "),e("p",[t._v("全局参数配置方式如下：在工作流定义页面，点击“设置全局”右边的加号，填写对应的变量名称和对应的值，保存即可。如下图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/cx5U2YAeO4C1fHo.png",alt:"image-20230324205341329"}})]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/mENHoXLk21cTrCh.png",alt:"image-20230324205429638"}})]),t._v(" "),e("p",[t._v("​\t"),e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/UzZXR6otIBCQjv2.png",alt:"image-20230324205714878"}})]),t._v(" "),e("blockquote",[e("p",[t._v("注：这里定义的 dt2,dt3 参数可以被其它任一节点的局部参数引用。")])]),t._v(" "),e("h4",{attrs:{id:"任务实例查看执行结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务实例查看执行结果"}},[t._v("#")]),t._v(" 任务实例查看执行结果")]),t._v(" "),e("p",[t._v("进入任务实例页面，可以通过查看日志，验证任务的执行结果，判断参数是否有效。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/NcKjFMWZzet4E6R.png",alt:"image-20230324205757165"}})]),t._v(" "),e("h2",{attrs:{id:"本地参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本地参数"}},[t._v("#")]),t._v(" 本地参数")]),t._v(" "),e("h3",{attrs:{id:"作用域-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#作用域-2"}},[t._v("#")]),t._v(" 作用域")]),t._v(" "),e("p",[t._v("在任务定义页面配置的参数，默认作用域仅限该任务，如果配置了"),e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.0.1/user_doc/guide/parameter/context.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("参数传递"),e("OutboundLink")],1),t._v("则可将该参数作用到下游任务中。")]),t._v(" "),e("h3",{attrs:{id:"使用方式-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用方式-2"}},[t._v("#")]),t._v(" 使用方式")]),t._v(" "),e("p",[t._v("本地参数配置方式如下：在任务定义页面，点击“自定义参数”右边的加号，填写对应的变量名称和对应的值，保存即可。")]),t._v(" "),e("ul",[e("li",[t._v("如果要在单个任务中使用参数，请参阅通过自定义参数使用")]),t._v(" "),e("li",[t._v("如果要在任务中使用配置参数并在下游任务中使用它们：\n"),e("ul",[e("li",[t._v("如果你只是想要简单使用，且不使用自定义参数, 请参阅 通过 "),e("code",[t._v("setValue")]),t._v(" 和自定义参数 export 本地参数")]),t._v(" "),e("li",[t._v("如果想要使用自定义参数, 请参阅 通过 "),e("code",[t._v("setValue")]),t._v(" 和自定义参数 export 本地参数")]),t._v(" "),e("li",[t._v("如果想要使用 Bash 参数, 请参阅 通过 "),e("code",[t._v("setValue")]),t._v(" 和 Bash 环境变量参数 export 本地参数")])])])]),t._v(" "),e("h3",{attrs:{id:"任务样例-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务样例-2"}},[t._v("#")]),t._v(" 任务样例")]),t._v(" "),e("h4",{attrs:{id:"通过自定义参数使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过自定义参数使用"}},[t._v("#")]),t._v(" 通过自定义参数使用")]),t._v(" "),e("p",[t._v("本样例展示了如何使用本地参数，打印输出当前日期。创建一个 Shell 任务，并编写脚本内容为 "),e("code",[t._v("echo ${dt}")]),t._v("。点击配置栏中的"),e("strong",[t._v("自定义参数")]),t._v("，配置如下图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/XIdSckJ2u1e8Fpm.png",alt:"local-parameter01"}})]),t._v(" "),e("p",[t._v("参数说明：")]),t._v(" "),e("ul",[e("li",[t._v("dt：参数名")]),t._v(" "),e("li",[t._v("IN：IN 表示局部参数仅能在当前节点使用，OUT 表示局部参数可以向下游传递")]),t._v(" "),e("li",[t._v("DATE：数据类型，日期")]),t._v(" "),e("li",[t._v("$[yyyy-MM-dd]：自定义格式的衍生内置参数")])]),t._v(" "),e("p",[t._v("保存工作流并运行，查看 Shell 任务输出日志。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/jbdAK31YuJnyO9S.png",alt:"local-parameter02"}})]),t._v(" "),e("blockquote",[e("p",[t._v("注：本地参数可以在当前任务节点的工作流中，设置其为 OUT 则可以传递给下游的工作流使用，可以参考："),e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.0.1/user_doc/guide/parameter/context.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("参数传递"),e("OutboundLink")],1)])]),t._v(" "),e("h4",{attrs:{id:"通过-setvalue-export-本地参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过-setvalue-export-本地参数"}},[t._v("#")]),t._v(" 通过 "),e("code",[t._v("setValue")]),t._v(" export 本地参数")]),t._v(" "),e("p",[t._v("如果你想简单 export 参数然后在下游任务中使用它们，你可以在你的任务中使用 "),e("code",[t._v("setValue")]),t._v("，你可以将参数统一在一个任务中管理。在 Shell 任务中使用语法 "),e("code",[t._v("echo '${setValue(set_val=123)}'")]),t._v("("),e("strong",[t._v("不要忘记单引号")]),t._v(") 并添加新的 "),e("code",[t._v("OUT")]),t._v(" 自定义参数来 export 它。")]),t._v(" "),e("blockquote",[e("p",[t._v("注意：")]),t._v(" "),e("p",[e("code",[t._v("echo '${setValue(set_val=123)}'")]),t._v("不会再shell脚本中输出内容，就是做的赋值操作")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/jsARKLoPYvzNnBr.png",alt:"local-parameter-set-val"}})]),t._v(" "),e("p",[t._v("你可以在下游任务中使用语法 "),e("code",[t._v("echo '${set_val}'")]),t._v(" 在获取设定的值。")]),t._v(" "),e("h4",{attrs:{id:"通过-setvalue-和自定义参数-export-本地参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过-setvalue-和自定义参数-export-本地参数"}},[t._v("#")]),t._v(" 通过 "),e("code",[t._v("setValue")]),t._v(" 和自定义参数 export 本地参数")]),t._v(" "),e("p",[t._v("如果你想用自定义参数而不是常量值来实现参数 export，并下游任务中使用它们，你可以在通过 "),e("code",[t._v("setValue")]),t._v(" 和 自定义参数实现，当你想改变参数的值时可以直接改变 “自定义参数”模块中的值，这让程序更加容易维护。您可以在 Shell 任务中使用语法 "),e("code",[t._v('echo "#{setValue(set_val_param=${val})}"')]),t._v("（"),e("strong",[t._v("如果你想要将任何 变量赋值给 "),e("code",[t._v("setValue")])]),t._v(" 请不要忘记使用双引号）并添加新的 "),e("code",[t._v("IN")]),t._v(" 自定义参数用于输入变量 "),e("code",[t._v("val")]),t._v(" 和 "),e("code",[t._v("OUT")]),t._v(" 自定义参数用于 export 参数 "),e("code",[t._v("set_val_param")]),t._v("。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/uF6QDctnIYGP8XL.png",alt:"image-20230324221900909"}})]),t._v(" "),e("p",[t._v("你可以在下游任务中使用语法 "),e("code",[t._v("echo '${set_val_param}'")]),t._v(" 在获取设定的值。")]),t._v(" "),e("h4",{attrs:{id:"通过-setvalue-和-bash-环境变量参数-export-本地参数-根据接口返回结果赋值给下流"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过-setvalue-和-bash-环境变量参数-export-本地参数-根据接口返回结果赋值给下流"}},[t._v("#")]),t._v(" 通过 "),e("code",[t._v("setValue")]),t._v(" 和 Bash 环境变量参数 export 本地参数(根据接口返回结果赋值给下流)")]),t._v(" "),e("p",[t._v("如果你想用 bash 变量而不是常量值 export 参数，并在下游任务中使用它们，你可以在通过 "),e("code",[t._v("setValue")]),t._v(" 和 Bash 变量实现，它更灵活，例如你动态获取现有的本地 或 HTTP 资源获取设定变量。 您可以使用类似的语法。")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("lines_num")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://raw.githubusercontent.com/apache/dolphinscheduler/dev/README.md "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-q")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("wc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("xargs")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#{setValue(set_val_var='),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${lines_num}")]),t._v(')}"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("在 Shell 任务中（"),e("strong",[t._v("如果你想要将任何变量赋值给 "),e("code",[t._v("setValue")])]),t._v(" 请不要忘记使用双引号）和 "),e("code",[t._v("OUT")]),t._v(" 自定义参数用于 export 参数 "),e("code",[t._v("set_val_var")]),t._v("。 .")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/5C1m3w4WnpkoXay.png",alt:"local-parameter-set-val-bash"}})]),t._v(" "),e("p",[t._v("你可以在下游任务中使用语法 "),e("code",[t._v("echo '${set_val_var}'")]),t._v(" 在获取设定的值。")]),t._v(" "),e("h2",{attrs:{id:"参数传递"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数传递"}},[t._v("#")]),t._v(" 参数传递")]),t._v(" "),e("p",[t._v("DolphinScheduler 提供参数间相互引用的能力，包括：本地参数引用全局参数、上下游参数传递。因为有引用的存在，就涉及当参数名相同时，参数的优先级问题，详见"),e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/priority",target:"_blank",rel:"noopener noreferrer"}},[t._v("参数优先级"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"本地任务引用全局参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本地任务引用全局参数"}},[t._v("#")]),t._v(" 本地任务引用全局参数")]),t._v(" "),e("p",[t._v("本地任务引用全局参数的前提是，你已经定义了"),e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/global",target:"_blank",rel:"noopener noreferrer"}},[t._v("全局参数"),e("OutboundLink")],1),t._v("，使用方式和"),e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/local",target:"_blank",rel:"noopener noreferrer"}},[t._v("本地参数"),e("OutboundLink")],1),t._v("中的使用方式类似，但是参数的值需要配置成全局参数中的 key。")]),t._v(" "),e("h3",{attrs:{id:"上游任务传递给下游任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上游任务传递给下游任务"}},[t._v("#")]),t._v(" 上游任务传递给下游任务")]),t._v(" "),e("p",[t._v("DolphinScheduler 允许在任务间进行参数传递，目前传递方向仅支持上游单向传递给下游。目前支持这个特性的任务类型有：")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/task/shell",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shell"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/task/sql",target:"_blank",rel:"noopener noreferrer"}},[t._v("SQL"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/task/stored-procedure",target:"_blank",rel:"noopener noreferrer"}},[t._v("Procedure"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/task/python",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("当定义上游节点时，如果有需要将该节点的结果传递给有依赖关系的下游节点，需要在【当前节点设置】的【自定义参数】设置一个方向是 OUT 的变量。目前我们主要针对 SQL 和 SHELL 节点做了可以向下传递参数的功能。")]),t._v(" "),e("p",[t._v("上游传递的参数可以在下游节点中被更新，更新方法与"),e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/context#%E5%88%9B%E5%BB%BA-shell-%E4%BB%BB%E5%8A%A1%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0",target:"_blank",rel:"noopener noreferrer"}},[t._v("设置参数"),e("OutboundLink")],1),t._v("相同。")]),t._v(" "),e("p",[t._v("如果定义了同名的传递参数，上游节点的参数将被覆盖。")]),t._v(" "),e("blockquote",[e("p",[t._v("注：若节点之间没有依赖关系，则局部参数无法通过上游传递。")])]),t._v(" "),e("h3",{attrs:{id:"任务样例-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务样例-3"}},[t._v("#")]),t._v(" 任务样例")]),t._v(" "),e("p",[t._v("本样例展示了如何使用参数传递的功能，通过 SHELL 任务来创建本地参数并赋值传递给下游，SQL 任务通过获得上游任务的参数完成查询操作。")]),t._v(" "),e("h4",{attrs:{id:"创建-shell-任务并设置参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-shell-任务并设置参数"}},[t._v("#")]),t._v(" 创建 SHELL 任务并设置参数")]),t._v(" "),e("blockquote",[e("p",[t._v("用户需要传递参数，在定义 SHELL 脚本时，需要输出格式为 ${setValue(key=value)} 的语句，key 为对应参数的 prop，value 为该参数的值。")])]),t._v(" "),e("p",[t._v("创建 Node_A 任务，在自定义参数中添加 output 和 value 参数，并编写如下脚本：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/OaeB5G9thnAlVRH.png",alt:"context-parameter01"}})]),t._v(" "),e("p",[t._v("参数说明：")]),t._v(" "),e("ul",[e("li",[t._v("value：方向选择为 IN，并赋值为 66")]),t._v(" "),e("li",[t._v("output：方向选择为 OUT，通过脚本 "),e("code",[t._v("'${setValue(output=1)}'")]),t._v(" 赋值，并传递给下游参数")])]),t._v(" "),e("p",[t._v("SHELL 节点定义时当日志检测到 ${setValue(output=1)} 的格式时，会将 1 赋值给 output，下游节点便可以直接使用变量 output 的值。同样，您可以在【工作流实例】页面，找到对应的节点实例，便可以查看该变量的值。")]),t._v(" "),e("p",[t._v("创建 Node_B 任务，主要用于测试输出上游任务 Node_A 传递的参数。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/kHpQLawurB95WGC.png",alt:"context-parameter02"}})]),t._v(" "),e("h4",{attrs:{id:"创建-sql-任务并使用参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-sql-任务并使用参数"}},[t._v("#")]),t._v(" 创建 SQL 任务并使用参数")]),t._v(" "),e("p",[t._v("完成上述的 SHELL 任务之后，我们可以使用上游所传递的 output 作为 SQL 的查询对象。其中将所查询的 id 重命名为 ID，作为参数输出。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/akpFOTeoxt9X1Nf.png",alt:"context-parameter03"}})]),t._v(" "),e("blockquote",[e("p",[t._v("注：如果 SQL 节点的结果只有一行，一个或多个字段，参数的名字需要和字段名称一致。数据类型可选择为除 LIST 以外的其他类型。变量会选择 SQL 查询结果中的列名中与该变量名称相同的列对应的值。")]),t._v(" "),e("p",[t._v("如果 SQL 节点的结果为多行，一个或多个字段，参数的名字需要和字段名称一致。数据类型选择为 LIST。获取到 SQL 查询结果后会将对应列转化为 LIST，并将该结果转化为 JSON 后作为对应变量的值。")])]),t._v(" "),e("h4",{attrs:{id:"保存工作流并设置全局参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#保存工作流并设置全局参数"}},[t._v("#")]),t._v(" 保存工作流并设置全局参数")]),t._v(" "),e("p",[t._v("点击保存工作流图标，并设置全局参数 output 和 value。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/cxhFO2ptmESgYMU.png",alt:"context-parameter03"}})]),t._v(" "),e("h4",{attrs:{id:"查看运行结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看运行结果"}},[t._v("#")]),t._v(" 查看运行结果")]),t._v(" "),e("p",[t._v("创建完成工作流之后，上线运行该工作流，查看其运行结果。")]),t._v(" "),e("p",[t._v("Node_A 运行结果如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/e46Ou5UiLMcaNBH.png",alt:"context-log01"}})]),t._v(" "),e("p",[t._v("Node_B 运行结果如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/u9SEjGHKXYWrZCs.png",alt:"context-log02"}})]),t._v(" "),e("p",[t._v("Node_mysql 运行结果如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/fvrYBHpyMtdgLJu.png",alt:"context-log03"}})]),t._v(" "),e("p",[t._v("虽然在 Node_A 的脚本中为 output 赋值为 1，但日志中显示的值仍然为 100。但根据"),e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/priority",target:"_blank",rel:"noopener noreferrer"}},[t._v("参数优先级"),e("OutboundLink")],1),t._v("的原则："),e("code",[t._v("本地参数 > 上游任务传递的参数 > 全局参数")]),t._v("，在 Node_B 中输出的值为 1。则证明 output 参数参照预期的值在该工作流中传递，并在 Node_mysql 中使用该值完成查询操作。")]),t._v(" "),e("p",[t._v("但是 value 的值却只有在 Node_A 中输出为 66，其原因为 value 的方向选择为 IN，只有当方向为 OUT 时才会被定义为变量输出。")]),t._v(" "),e("h4",{attrs:{id:"python-任务传递参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#python-任务传递参数"}},[t._v("#")]),t._v(" Python 任务传递参数")]),t._v(" "),e("p",[t._v("使用 "),e("code",[t._v("print('${setValue(key=%s)}' % value)")]),t._v("，DolphinScheduler会捕捉输出中的 "),e("code",[t._v("${setValue(key=value}")]),t._v("来进行参数捕捉，从而传递到下游")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2023/04/26/XaAnQOBFt61wGP4.png",alt:"img.png"}})]),t._v(" "),e("h2",{attrs:{id:"参数优先级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数优先级"}},[t._v("#")]),t._v(" 参数优先级")]),t._v(" "),e("p",[t._v("DolphinScheduler 中所涉及的参数值的定义可能来自三种类型：")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/global",target:"_blank",rel:"noopener noreferrer"}},[t._v("全局参数"),e("OutboundLink")],1),t._v("：在工作流保存页面定义时定义的变量")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/context",target:"_blank",rel:"noopener noreferrer"}},[t._v("上游任务传递的参数"),e("OutboundLink")],1),t._v("：上游任务传递过来的参数")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.4/guide/parameter/local",target:"_blank",rel:"noopener noreferrer"}},[t._v("本地参数"),e("OutboundLink")],1),t._v("：节点的自有变量，用户在“自定义参数”定义的变量，并且用户可以在工作流定义时定义该部分变量的值")])]),t._v(" "),e("p",[t._v("因为参数的值存在多个来源，当参数名相同时，就需要会存在参数优先级的问题。DolphinScheduler 参数的优先级从高到低为："),e("code",[t._v("本地参数 > 上游任务传递的参数 > 全局参数")])]),t._v(" "),e("p",[t._v("在上游任务传递的参数中，由于上游可能存在多个任务向下游传递参数，当上游传递的参数名称相同时：")]),t._v(" "),e("ul",[e("li",[t._v("下游节点会优先使用值为非空的参数")]),t._v(" "),e("li",[t._v("如果存在多个值为非空的参数，则按照上游任务的完成时间排序，选择完成时间最早的上游任务对应的参数")])])])}),[],!1,null,null,null);e.default=r.exports}}]);
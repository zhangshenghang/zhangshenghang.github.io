(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{426:function(s,n,a){"use strict";a.r(n);var e=a(8),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("[toc]")]),s._v(" "),n("p",[n("strong",[s._v("步骤 1. 在我们安装任何软件之前，通过apt在终端中运行以下命令来确保您的系统是最新的很重要：")])]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[s._v("sudo apt update\nsudo apt upgrade\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("步骤 2. Debian 安装 OpenVPN 服务器。")]),s._v("\n现在我们使用以下命令从GitHub下载脚本安装程序 OpenVPN 服务器curl：")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[s._v("curl -O https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("下载后，对脚本赋予执行权限")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[s._v("chmod +x openvpn-install.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("安装过程中需要下载github上的代码，如果网络不通则需要设置可以访问github的代理，也可以直接下载好将文件放到"),n("code",[s._v("/root")]),s._v("目录下，这里我采用的是下载好将"),n("code",[s._v("EasyRSA.tgz")]),s._v("文件放在"),n("code",[s._v("/root")]),s._v("目录下")]),s._v(" "),n("p",[s._v("下载文件地址：https://github.com/OpenVPN/easy-rsa/releases/download/v3.1.2/EasyRSA-3.1.2.tgz")]),s._v(" "),n("p",[s._v("将文件上传到服务器"),n("code",[s._v("/root")]),s._v("目录下")]),s._v(" "),n("p",[s._v("将文件重命名为"),n("code",[s._v("esay-rsa.tgz")])]),s._v(" "),n("p",[s._v("修改安装脚本内容")]),s._v(" "),n("p",[s._v("屏蔽第710行（下载github安装包的那一行，这样后续就不在linux中下载了）")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://s2.loli.net/2023/12/06/fmVPTvU2WH1kS79.png",alt:"image-20231206111354112"}})]),s._v(" "),n("p",[s._v("安装OpenVPN")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" ./openvpn-install.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("系统将提示您输入一些信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("root@pve:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./openvpn-install.sh ")]),s._v("\nWelcome to the OpenVPN installer"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nThe "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" repository is available at: https://github.com/angristan/openvpn-install\n\nI need to ask you a few questions before starting the setup.\nYou can leave the default options and just press enter "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you are ok with them.\n\nI need to know the IPv4 address of the network interface you want OpenVPN listening to.\nUnless your server is behind NAT, it should be your public IPv4 address.\nIP address: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.133 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 回车")]),s._v("\n\nIt seems this server is behind NAT. What is its public IPv4 address or hostname?\nWe need it "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the clients to connect to the server.\nPublic IPv4 address or hostname: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.133\n\nChecking "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" IPv6 connectivity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nYour "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" does not appear to have IPv6 connectivity.\n\nDo you want to "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" IPv6 support "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NAT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": y\n\nWhat port "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" you want OpenVPN to listen to?\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Default: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1194")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Custom\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Random "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("49152")]),s._v("-65535"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   \nWhat protocol "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" you want OpenVPN to use?\nUDP is faster. Unless it is not available, you shouldn"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t use TCP.\n   1) UDP\n   2) TCP\nProtocol [1-2]: 2\n\nWhat DNS resolvers do you want to use with the VPN?\n   1) Current system resolvers (from /etc/resolv.conf)\n   2) Self-hosted DNS Resolver (Unbound)\n   3) Cloudflare (Anycast: worldwide)\n   4) Quad9 (Anycast: worldwide)\n   5) Quad9 uncensored (Anycast: worldwide)\n   6) FDN (France)\n   7) DNS.WATCH (Germany)\n   8) OpenDNS (Anycast: worldwide)\n   9) Google (Anycast: worldwide)\n   10) Yandex Basic (Russia)\n   11) AdGuard DNS (Anycast: worldwide)\n   12) NextDNS (Anycast: worldwide)\n   13) Custom\nDNS [1-12]: 13\nPrimary DNS: 8.8.8.8\nSecondary DNS (optional): 8.8.4.4\n\nDo you want to use compression? It is not recommended since the VORACLE attack makes use of it.\nEnable compression? [y/n]: n\n\nDo you want to customize encryption settings?\nUnless you know what you'")]),s._v("re doing, you should stick with the default parameters provided by the script.\nNote that whatever you choose, all the choices presented "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the script are safe. "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unlike OpenVPN"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'s defaults)\nSee https://github.com/angristan/openvpn-install#security-and-encryption to learn more.\n\nCustomize encryption settings? [y/n]: n\n\nOkay, that was all I needed. We are ready to setup your OpenVPN server now.\nYou will be able to generate a client at the end of the installation.\nPress any key to continue...  # 按回车即可开始安装\n* Applying /usr/lib/sysctl.d/10-pve-ct-inotify-limits.conf ...\n* Applying /usr/lib/sysctl.d/10-pve.conf ...\n* Applying /usr/lib/sysctl.d/50-pid-max.conf ...\n* Applying /etc/sysctl.d/99-openvpn.conf ...\n* Applying /usr/lib/sysctl.d/99-protect-links.conf ...\n* Applying /etc/sysctl.d/99-sysctl.conf ...\n* Applying /usr/lib/sysctl.d/pve-firewall.conf ...\n* Applying /etc/sysctl.conf ...\nfs.inotify.max_queued_events = 8388608\nfs.inotify.max_user_instances = 65536\nfs.inotify.max_user_watches = 4194304\nvm.max_map_count = 262144\nnet.ipv4.neigh.default.gc_thresh3 = 8192\nnet.ipv6.neigh.default.gc_thresh3 = 8192\nkernel.keys.maxkeys = 2000\nnet.bridge.bridge-nf-call-ip6tables = 0\nnet.bridge.bridge-nf-call-iptables = 0\nnet.bridge.bridge-nf-call-arptables = 0\nnet.bridge.bridge-nf-filter-vlan-tagged = 0\nnet.ipv4.igmp_link_local_mcast_reports = 0\nfs.aio-max-nr = 1048576\nkernel.pid_max = 4194304\nnet.ipv4.ip_forward = 1\nnet.ipv6.conf.all.forwarding = 1\nfs.protected_fifos = 1\nfs.protected_hardlinks = 1\nfs.protected_regular = 2\nfs.protected_symlinks = 1\nnet.ipv4.conf.all.rp_filter = 2\nCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn@server.service → /etc/systemd/system/openvpn@.service.\nJob for openvpn@server.service failed because the control process exited with error code.\nSee "systemctl status openvpn@server.service" and "journalctl -xeu openvpn@server.service" for details.\nCreated symlink /etc/systemd/system/multi-user.target.wants/iptables-openvpn.service → /etc/systemd/system/iptables-openvpn.service.\n\nTell me a name for the client.\nThe name must consist of alphanumeric character. It may also include an underscore or a dash.\nClient name: jast\n\nDo you want to protect the configuration file with a password?\n(e.g. encrypt the private key with a password)\n   1) Add a passwordless client\n   2) Use a password for the client\nSelect an option [1-2]: 1\n\n* Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023)\n\n* Using Easy-RSA configuration: /etc/openvpn/easy-rsa/vars\n\n* The preferred location for \'')]),s._v("vars"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' is within the PKI folder.\n  To silence this message move your '")]),s._v("vars"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' file to your PKI\n  or declare your '")]),s._v("vars"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' file with option: --vars=<FILE>\n-----\n\nNotice\n------\nKeypair and certificate request completed. Your files are:\nreq: /etc/openvpn/easy-rsa/pki/reqs/jast.req\nkey: /etc/openvpn/easy-rsa/pki/private/jast.key\nUsing configuration from /etc/openvpn/easy-rsa/pki/1a1d1295/temp.52ba975a\nCheck that the request matches the signature\nSignature ok\nThe Subject'")]),s._v("s Distinguished Name is as follows\ncommonName            :ASN.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jast'")]),s._v("\nCertificate is to be certified "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v(" Mar "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 02:57:26 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2026")]),s._v(" GMT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("825")]),s._v(" days"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nWrite out database with "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" new entries\nDatabase updated\n\nNotice\n------\nCertificate created at:\n* /etc/openvpn/easy-rsa/pki/issued/jast.crt\n\nNotice\n------\nInline "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" created:\n* /etc/openvpn/easy-rsa/pki/inline/jast.inline\nClient jast added.\n\nThe configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" has been written to /root/jast.ovpn.\nDownload the .ovpn "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" and "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" it "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your OpenVPN client.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br")])]),n("p",[s._v("将生成的配置文件"),n("code",[s._v("/root/jast.ovpn")]),s._v("下载到本地，通过VPN软件可以直接连接")]),s._v(" "),n("p",[s._v("我这里是Mac系统，使用的软件是"),n("code",[s._v("Viscosity")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://s2.loli.net/2023/12/06/VYGai6SC7qgsmXf.png",alt:"image-20231206111656854"}})]),s._v(" "),n("h3",{attrs:{id:"新增新用户-客户端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新增新用户-客户端"}},[s._v("#")]),s._v(" 新增新用户/客户端")]),s._v(" "),n("p",[s._v("运行脚本"),n("code",[s._v("./openvpn-install.sh")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("root@pve:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./openvpn-install.sh ")]),s._v("\nWelcome to OpenVPN-install"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nThe "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" repository is available at: https://github.com/angristan/openvpn-install\n\nIt looks like OpenVPN is already installed.\n\nWhat "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" you want to do?\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Add a new user\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Revoke existing user\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Remove OpenVPN\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Exit\nSelect an option "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("-4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择1，添加客户端")]),s._v("\n\nTell me a name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the client.\nThe name must consist of alphanumeric character. It may also include an underscore or a dash.\nClient name: test-user   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入需要创建的客户端密码")]),s._v("\n\nDo you want to protect the configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" with a password?\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. encrypt the private key with a password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Add a passwordless client\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Use a password "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the client\nSelect an option "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("-2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1是无需密码直接连接，2是设置密码连接")]),s._v("\n⚠️ You will be asked "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the client password below ⚠️\n\n* Using SSL: openssl OpenSSL "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(".11 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" Sep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Library: OpenSSL "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(".11 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" Sep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n* Using Easy-RSA configuration: /etc/openvpn/easy-rsa/vars\n\n* The preferred location "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vars'")]),s._v(" is within the PKI folder.\n  To silence this message move your "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vars'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to your PKI\n  or "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("declare")]),s._v(" your "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vars'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" with option: "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--vars")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("FILE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nEnter PEM pass phrase:  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置密码")]),s._v("\nVerifying - Enter PEM pass phrase: "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认密码")]),s._v("\n-----\n\nNotice\n------\nKeypair and certificate request completed. Your files are:\nreq: /etc/openvpn/easy-rsa/pki/reqs/test-user.req\nkey: /etc/openvpn/easy-rsa/pki/private/test-user.key\nUsing configuration from /etc/openvpn/easy-rsa/pki/54af4460/temp.394d8f7a\nCheck that the request matches the signature\nSignature ok\nThe Subject"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s Distinguished Name is as follows\ncommonName            :ASN.1 12:'")]),s._v("test-user'\nCertificate is to be certified "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v(" Mar "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 03:30:59 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2026")]),s._v(" GMT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("825")]),s._v(" days"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nWrite out database with "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" new entries\nDatabase updated\n\nNotice\n------\nCertificate created at:\n* /etc/openvpn/easy-rsa/pki/issued/test-user.crt\n\nNotice\n------\nInline "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" created:\n* /etc/openvpn/easy-rsa/pki/inline/test-user.inline\nClient test-user added.\n\nThe configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" has been written to /root/test-user.ovpn.\nDownload the .ovpn "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" and "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" it "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your OpenVPN client.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("p",[s._v("完成后会在"),n("code",[s._v("/root")]),s._v("目录下生成客户端配置文件")]),s._v(" "),n("h3",{attrs:{id:"客户端设置指定网段才走vpn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端设置指定网段才走vpn"}},[s._v("#")]),s._v(" 客户端设置指定网段才走VPN")]),s._v(" "),n("blockquote",[n("p",[s._v("注意要删除 redirect-gateway def1 这个意思是所有流量走VPN")])]),s._v(" "),n("h4",{attrs:{id:"所有流量走本地-部分流量走vpn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#所有流量走本地-部分流量走vpn"}},[s._v("#")]),s._v(" 所有流量走本地，部分流量走vpn")]),s._v(" "),n("p",[s._v("设置只有10.0.0.0网段的ip走VPN")]),s._v(" "),n("p",[s._v("添加参数如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("route-nopull\nroute 10.0.0.0 255.255.255.0 vpn_gateway\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("div",{staticClass:"language-properties line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[s._v("client\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proto")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("tcp-client")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("remote")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("47.98.183.51 50007")]),s._v("\nroute-nopull\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("route")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10.0.0.0 255.255.255.0 vpn_gateway")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dev")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("tun")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("resolv-retry")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("infinite")]),s._v("\nnobind\npersist-key\npersist-tun\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("remote-cert-tls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("server")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("verify-x509-name")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("server_aTxE4GMrmxVEqbU0 name")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("auth")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SHA256")]),s._v("\nauth-nocache\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("cipher")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("AES-128-GCM")]),s._v("\ntls-client\n"),n("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("tls-version-min")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1.2")]),s._v("\n...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h4",{attrs:{id:"所有流量走vpn-部分流量走本地"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#所有流量走vpn-部分流量走本地"}},[s._v("#")]),s._v(" 所有流量走vpn，部分流量走本地")]),s._v(" "),n("p",[s._v("在客户端配置文件增加以下配置：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("route 10.0.0.0 255.255.255.0 net_gateway\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("即可实现10.0.0.0网段走本地，其他流量走openvpn。")]),s._v(" "),n("blockquote",[n("p",[s._v("参考：")]),s._v(" "),n("p",[s._v("Debian 搭建 OpenVPN 服务器：https://mrwu.red/web/4060.html")]),s._v(" "),n("p",[s._v("openvpn客户端指定网段走本地流量：https://blog.eyyyye.com/article/63")])])])}),[],!1,null,null,null);n.default=t.exports}}]);
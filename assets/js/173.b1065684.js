(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{540:function(s,t,a){"use strict";a.r(t);var e=a(8),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"如何使用elasticsearch-exporter收集elasticsearch集群数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何使用elasticsearch-exporter收集elasticsearch集群数据"}},[s._v("#")]),s._v(" 如何使用Elasticsearch Exporter收集ElasticSearch集群数据")]),s._v(" "),t("p",[s._v("在现代数据系统中，监控是保障系统稳定性的重要环节。ElasticSearch作为一个广泛使用的搜索引擎，监控它的性能和状态至关重要。通过Prometheus结合"),t("code",[s._v("elasticsearch-exporter")]),s._v("，可以轻松收集ElasticSearch集群的各项数据指标，并进行监控。本文将详细介绍如何通过"),t("code",[s._v("docker-compose")]),s._v("部署"),t("code",[s._v("elasticsearch-exporter")]),s._v("并配置Prometheus以便收集ElasticSearch集群的监控数据。")]),s._v(" "),t("p",[s._v("先看效果，几乎你想要的节点状态都包括：集群健康状态、节点状态、索引状态、搜索请求统计、查询缓存统计、合并操作统计、分片状态以及磁盘使用情况等等")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/09/27/3uEVyXhWRp1bnrI.png",alt:"image.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/09/29/ATgHkeJCIjo7Piw.png",alt:"image-20240927214302180"}})]),s._v(" "),t("h3",{attrs:{id:"一、配置elasticsearch-exporter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、配置elasticsearch-exporter"}},[s._v("#")]),s._v(" 一、配置"),t("code",[s._v("elasticsearch-exporter")])]),s._v(" "),t("p",[s._v("GitHub地址：https://github.com/prometheus-community/elasticsearch_exporter/releases")]),s._v(" "),t("p",[s._v("首先，我们使用"),t("code",[s._v("docker-compose")]),s._v("来启动两个"),t("code",[s._v("elasticsearch-exporter")]),s._v("实例，它们分别用于收集不同ElasticSearch集群节点的数据。以下是完整的"),t("code",[s._v("docker-compose.yml")]),s._v("配置：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch_exporter1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/prometheuscommunity/elasticsearch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.uri=http://192.168.0.101:9200'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ElasticSearch集群节点1的地址")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.all'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取集群中所有节点状态")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.indices'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有索引的统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.indices_settings'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有索引的设置统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.indices_mappings'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有索引映射的统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.shards'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有分片的统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.timeout=20s'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置请求超时时间")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.200:9114:9114"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elasticsearch_exporter的外部暴露端口")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch_exporter2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/prometheuscommunity/elasticsearch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.uri=http://192.168.0.102:9200'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ElasticSearch集群节点2的地址")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.all'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取集群中所有节点状态")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.indices'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有索引的统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.indices_settings'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有索引的设置统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.indices_mappings'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有索引映射的统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.shards'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询集群中所有分片的统计信息")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.timeout=20s'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置请求超时时间")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.200:9115:9114"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elasticsearch_exporter的外部暴露端口")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h4",{attrs:{id:"主要配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主要配置参数"}},[s._v("#")]),s._v(" 主要配置参数：")]),s._v(" "),t("ol",[t("li",[t("strong",[t("code",[s._v("--es.uri")])]),s._v(": 指定ElasticSearch集群的地址。比如"),t("code",[s._v("http://192.168.0.101:9200")]),s._v("。")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("--es.all")])]),s._v(": 通过这个参数可以抓取集群中所有节点的状态信息。如果不设置，只会获取配置的那个节点的信息。")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("--es.indices")])]),s._v(": 抓取集群中的索引统计信息，包括索引数量、状态等。")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("--es.shards")])]),s._v(": 抓取分片级别的统计信息。")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("--es.timeout")])]),s._v(": 设定请求超时时间，避免因为响应延迟导致的数据抓取失败。")])]),s._v(" "),t("p",[s._v("启动该"),t("code",[s._v("docker-compose")]),s._v("服务后，两个"),t("code",[s._v("elasticsearch-exporter")]),s._v("实例将分别运行，监听不同的端口以提供监控数据。")]),s._v(" "),t("h3",{attrs:{id:"二、配置prometheus收集数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、配置prometheus收集数据"}},[s._v("#")]),s._v(" 二、配置Prometheus收集数据")]),s._v(" "),t("p",[s._v("接下来，我们需要配置Prometheus来抓取从"),t("code",[s._v("elasticsearch-exporter")]),s._v("获取的监控数据。以下是"),t("code",[s._v("prometheus.yml")]),s._v("的示例配置：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     5s "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局抓取间隔")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("evaluation_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prometheus'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Prometheus自带的默认抓取任务")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.200:9090'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Prometheus自己的抓取地址")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'elasticsearch-dev'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控ElasticSearch开发环境的Job")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 60s\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  30s\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics_path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.200:9114'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elasticsearch_exporter1的地址")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'elasticsearch-prod'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控ElasticSearch生产环境的Job")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 60s\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  30s\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics_path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.200:9115'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elasticsearch_exporter2的地址")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h4",{attrs:{id:"主要配置项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主要配置项"}},[s._v("#")]),s._v(" 主要配置项：")]),s._v(" "),t("ol",[t("li",[t("strong",[t("code",[s._v("scrape_interval")])]),s._v(": 定义Prometheus抓取目标数据的频率。通常可以设定为60秒，以避免过于频繁的请求对系统性能的影响。")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("scrape_timeout")])]),s._v(": 设置每次抓取的超时时间，确保Prometheus在抓取时不会长时间等待目标的响应。")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("metrics_path")])]),s._v(": 这是Prometheus抓取数据的默认路径，"),t("code",[s._v("elasticsearch-exporter")]),s._v("默认暴露的路径为"),t("code",[s._v("/metrics")]),s._v("。")])]),s._v(" "),t("h4",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker-compose up -d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("启动该"),t("code",[s._v("docker-compose")]),s._v("服务后，两个"),t("code",[s._v("elasticsearch-exporter")]),s._v("实例将分别运行，监听不同的端口以提供监控数据。")]),s._v(" "),t("p",[s._v("访问："),t("code",[s._v("http://192.168.0.200:9114/metrics")]),s._v(" 可以看到收集到的数据，如下")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/09/27/41BtRwvkcHNG3gj.png",alt:"image.png"}})]),s._v(" "),t("h3",{attrs:{id:"三、启动prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、启动prometheus"}},[s._v("#")]),s._v(" 三、启动Prometheus")]),s._v(" "),t("p",[s._v("配置完成后，通过以下命令启动Prometheus实例：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prometheus "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v(":9090 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /etc/prometheus.yml:/etc/prometheus/prometheus.yml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /data/prometheus_data:/prometheus "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),s._v(" always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  prom/prometheus:latest\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("此命令使用Docker启动Prometheus，并映射配置文件和数据存储目录。在浏览器中访问"),t("code",[s._v("http://<Prometheus_IP>:9090")]),s._v("即可查看Prometheus的监控页面，并通过"),t("code",[s._v("elasticsearch-exporter")]),s._v("获取ElasticSearch集群的监控数据。")]),s._v(" "),t("h3",{attrs:{id:"四、验证监控数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、验证监控数据"}},[s._v("#")]),s._v(" 四、验证监控数据")]),s._v(" "),t("p",[s._v("启动Prometheus后，您可以通过Prometheus的web界面来验证是否成功收集到了ElasticSearch的监控数据。在"),t("code",[s._v("/targets")]),s._v("页面，可以看到所有已配置的"),t("code",[s._v("elasticsearch-exporter")]),s._v("实例是否为“UP”状态。如果状态为“UP”，说明Prometheus已经成功抓取了ElasticSearch的监控数据。")]),s._v(" "),t("p",[s._v("五、Grafana配置监控\n官方模板：编号为2322")]),s._v(" "),t("p",[s._v("推荐模板：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("13071: Dashboard for Elasticsearch Cluster Stats\n13072: Dashboard for Elasticsearch Index Stats\n13073: Dashboard for Elasticsearch Node Stats\n13074: Dashboard for Elasticsearch History Stats\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("在Grafana中导入对应的模板编号，即可展示，这里推荐使用 13071")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/09/27/hvmSw8yJAxIge16.png",alt:"image.png"}})]),s._v(" "),t("h3",{attrs:{id:"效果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#效果"}},[s._v("#")]),s._v(" 效果")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/09/27/3uEVyXhWRp1bnrI.png",alt:"image.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/09/29/ATgHkeJCIjo7Piw.png",alt:"image-20240927214302180"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/09/29/pGNFWaVCRcD4Kho.png",alt:"image-20240927214407401"}})]),s._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("通过本文的介绍，我们了解了如何使用"),t("code",[s._v("elasticsearch-exporter")]),s._v("结合Prometheus来监控ElasticSearch集群的健康状态和性能数据。从下载"),t("code",[s._v("elasticsearch-exporter")]),s._v("，配置Prometheus，到成功收集并监控数据，我们涵盖了从头到尾的部署步骤。通过这种方式，可以轻松获取ElasticSearch集群的详细统计信息，包括节点状态、索引、分片等，帮助管理员及时了解系统运行情况并进行必要的调整。")])])}),[],!1,null,null,null);t.default=n.exports}}]);
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flink流处理高级操作之时间语义 | Jast blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="后端技术博客,专注大数据、java后端、运维学习与总结。Hadoop、Hbase、Spark、Flink等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.6b2f3ec1.css" as="style"><link rel="preload" href="/assets/js/app.a5c64990.js" as="script"><link rel="preload" href="/assets/js/2.9cc65402.js" as="script"><link rel="preload" href="/assets/js/183.4f593acd.js" as="script"><link rel="prefetch" href="/assets/js/10.ba6c1d32.js"><link rel="prefetch" href="/assets/js/100.ccd1a39e.js"><link rel="prefetch" href="/assets/js/101.91cade52.js"><link rel="prefetch" href="/assets/js/102.027c71bd.js"><link rel="prefetch" href="/assets/js/103.de30883d.js"><link rel="prefetch" href="/assets/js/104.da277c7f.js"><link rel="prefetch" href="/assets/js/105.3bf9d637.js"><link rel="prefetch" href="/assets/js/106.a9e6dde2.js"><link rel="prefetch" href="/assets/js/107.860f85f9.js"><link rel="prefetch" href="/assets/js/108.4db25d5c.js"><link rel="prefetch" href="/assets/js/109.25820bdd.js"><link rel="prefetch" href="/assets/js/11.f1952de8.js"><link rel="prefetch" href="/assets/js/110.b15ac071.js"><link rel="prefetch" href="/assets/js/111.2de3d63d.js"><link rel="prefetch" href="/assets/js/112.0d5386a4.js"><link rel="prefetch" href="/assets/js/113.0039984c.js"><link rel="prefetch" href="/assets/js/114.dbfd963d.js"><link rel="prefetch" href="/assets/js/115.1dcd21d8.js"><link rel="prefetch" href="/assets/js/116.48600243.js"><link rel="prefetch" href="/assets/js/117.bbcc1071.js"><link rel="prefetch" href="/assets/js/118.d7cd7dc2.js"><link rel="prefetch" href="/assets/js/119.7b7e1b39.js"><link rel="prefetch" href="/assets/js/12.83759251.js"><link rel="prefetch" href="/assets/js/120.330446cb.js"><link rel="prefetch" href="/assets/js/121.fd2c8119.js"><link rel="prefetch" href="/assets/js/122.ec0a20e0.js"><link rel="prefetch" href="/assets/js/123.256a201a.js"><link rel="prefetch" href="/assets/js/124.e46e6a5a.js"><link rel="prefetch" href="/assets/js/125.93869b30.js"><link rel="prefetch" href="/assets/js/126.6e6b45bb.js"><link rel="prefetch" href="/assets/js/127.7b7d0615.js"><link rel="prefetch" href="/assets/js/128.75398be2.js"><link rel="prefetch" href="/assets/js/129.1410d7a1.js"><link rel="prefetch" href="/assets/js/13.bd1c4176.js"><link rel="prefetch" href="/assets/js/130.bfe1cad6.js"><link rel="prefetch" href="/assets/js/131.286e4fb2.js"><link rel="prefetch" href="/assets/js/132.298f0154.js"><link rel="prefetch" href="/assets/js/133.25e9e0fd.js"><link rel="prefetch" href="/assets/js/134.a156117e.js"><link rel="prefetch" href="/assets/js/135.b5580f83.js"><link rel="prefetch" href="/assets/js/136.8446e66a.js"><link rel="prefetch" href="/assets/js/137.4291a0c3.js"><link rel="prefetch" href="/assets/js/138.03e36af0.js"><link rel="prefetch" href="/assets/js/139.753d5e11.js"><link rel="prefetch" href="/assets/js/14.c30cabe4.js"><link rel="prefetch" href="/assets/js/140.b136f09c.js"><link rel="prefetch" href="/assets/js/141.6e321584.js"><link rel="prefetch" href="/assets/js/142.19594f5a.js"><link rel="prefetch" href="/assets/js/143.83b5a670.js"><link rel="prefetch" href="/assets/js/144.143de838.js"><link rel="prefetch" href="/assets/js/145.ead82905.js"><link rel="prefetch" href="/assets/js/146.f037d4ec.js"><link rel="prefetch" href="/assets/js/147.2416d84a.js"><link rel="prefetch" href="/assets/js/148.c672f1e5.js"><link rel="prefetch" href="/assets/js/149.caf20103.js"><link rel="prefetch" href="/assets/js/15.a36cf9fa.js"><link rel="prefetch" href="/assets/js/150.43e61e26.js"><link rel="prefetch" href="/assets/js/151.d3d8d0ca.js"><link rel="prefetch" href="/assets/js/152.4ebef6e9.js"><link rel="prefetch" href="/assets/js/153.3c49a9bd.js"><link rel="prefetch" href="/assets/js/154.6d6660a6.js"><link rel="prefetch" href="/assets/js/155.e80efaba.js"><link rel="prefetch" href="/assets/js/156.1a2c1468.js"><link rel="prefetch" href="/assets/js/157.65dab597.js"><link rel="prefetch" href="/assets/js/158.5342d014.js"><link rel="prefetch" href="/assets/js/159.a1c44f33.js"><link rel="prefetch" href="/assets/js/16.01d2a439.js"><link rel="prefetch" href="/assets/js/160.f6de5687.js"><link rel="prefetch" href="/assets/js/161.4a33f4f3.js"><link rel="prefetch" href="/assets/js/162.293b5c45.js"><link rel="prefetch" href="/assets/js/163.94f8c46f.js"><link rel="prefetch" href="/assets/js/164.e9874af4.js"><link rel="prefetch" href="/assets/js/165.c40136e3.js"><link rel="prefetch" href="/assets/js/166.b9514f6f.js"><link rel="prefetch" href="/assets/js/167.b55df3a5.js"><link rel="prefetch" href="/assets/js/168.bfd7b561.js"><link rel="prefetch" href="/assets/js/169.ec8ee5ab.js"><link rel="prefetch" href="/assets/js/17.4a34d519.js"><link rel="prefetch" href="/assets/js/170.4e8ebcdb.js"><link rel="prefetch" href="/assets/js/171.046b515a.js"><link rel="prefetch" href="/assets/js/172.0bfdc048.js"><link rel="prefetch" href="/assets/js/173.b1065684.js"><link rel="prefetch" href="/assets/js/174.a26151c8.js"><link rel="prefetch" href="/assets/js/175.af67d813.js"><link rel="prefetch" href="/assets/js/176.8351882c.js"><link rel="prefetch" href="/assets/js/177.a5985895.js"><link rel="prefetch" href="/assets/js/178.3803a24d.js"><link rel="prefetch" href="/assets/js/179.943ff67a.js"><link rel="prefetch" href="/assets/js/18.40ac91d6.js"><link rel="prefetch" href="/assets/js/180.88c378a7.js"><link rel="prefetch" href="/assets/js/181.55d56274.js"><link rel="prefetch" href="/assets/js/182.2a01d579.js"><link rel="prefetch" href="/assets/js/184.a476b544.js"><link rel="prefetch" href="/assets/js/185.02a334a8.js"><link rel="prefetch" href="/assets/js/186.e13edcb1.js"><link rel="prefetch" href="/assets/js/187.522769b5.js"><link rel="prefetch" href="/assets/js/188.c7145e3e.js"><link rel="prefetch" href="/assets/js/189.19159109.js"><link rel="prefetch" href="/assets/js/19.c6a1d5d4.js"><link rel="prefetch" href="/assets/js/190.7eeef6ca.js"><link rel="prefetch" href="/assets/js/191.d891e4cd.js"><link rel="prefetch" href="/assets/js/192.d57db752.js"><link rel="prefetch" href="/assets/js/193.51d140b9.js"><link rel="prefetch" href="/assets/js/194.719c07fb.js"><link rel="prefetch" href="/assets/js/195.d1f4ad39.js"><link rel="prefetch" href="/assets/js/196.89045dfe.js"><link rel="prefetch" href="/assets/js/197.8b582e17.js"><link rel="prefetch" href="/assets/js/198.dd108c0b.js"><link rel="prefetch" href="/assets/js/199.6dcb685e.js"><link rel="prefetch" href="/assets/js/20.2c61c41b.js"><link rel="prefetch" href="/assets/js/200.980a6e3a.js"><link rel="prefetch" href="/assets/js/201.0022dd0a.js"><link rel="prefetch" href="/assets/js/202.b1771899.js"><link rel="prefetch" href="/assets/js/203.5b8c52fb.js"><link rel="prefetch" href="/assets/js/204.1de31510.js"><link rel="prefetch" href="/assets/js/205.e4c193e9.js"><link rel="prefetch" href="/assets/js/206.c43d57fd.js"><link rel="prefetch" href="/assets/js/207.a7696d68.js"><link rel="prefetch" href="/assets/js/208.5b51bd38.js"><link rel="prefetch" href="/assets/js/209.f2c6e228.js"><link rel="prefetch" href="/assets/js/21.9630f7d2.js"><link rel="prefetch" href="/assets/js/210.d499c1e8.js"><link rel="prefetch" href="/assets/js/211.7caf7044.js"><link rel="prefetch" href="/assets/js/212.eb88150d.js"><link rel="prefetch" href="/assets/js/213.7a66a771.js"><link rel="prefetch" href="/assets/js/214.650eca57.js"><link rel="prefetch" href="/assets/js/215.d58c9428.js"><link rel="prefetch" href="/assets/js/216.17c5fbbb.js"><link rel="prefetch" href="/assets/js/217.cc6016b1.js"><link rel="prefetch" href="/assets/js/218.0f2ad43c.js"><link rel="prefetch" href="/assets/js/219.0cc56748.js"><link rel="prefetch" href="/assets/js/22.ae388eb6.js"><link rel="prefetch" href="/assets/js/220.c6da1ce9.js"><link rel="prefetch" href="/assets/js/221.c2499e5c.js"><link rel="prefetch" href="/assets/js/222.b87b5047.js"><link rel="prefetch" href="/assets/js/223.14221086.js"><link rel="prefetch" href="/assets/js/224.48415224.js"><link rel="prefetch" href="/assets/js/225.3323e2fd.js"><link rel="prefetch" href="/assets/js/226.97115136.js"><link rel="prefetch" href="/assets/js/227.51ac123d.js"><link rel="prefetch" href="/assets/js/228.ac7adb8a.js"><link rel="prefetch" href="/assets/js/229.4423a81d.js"><link rel="prefetch" href="/assets/js/23.1b7a265e.js"><link rel="prefetch" href="/assets/js/230.93f5e7f6.js"><link rel="prefetch" href="/assets/js/231.5c829d72.js"><link rel="prefetch" href="/assets/js/232.b497791c.js"><link rel="prefetch" href="/assets/js/233.0759dd52.js"><link rel="prefetch" href="/assets/js/234.5c77c942.js"><link rel="prefetch" href="/assets/js/235.62c61b2a.js"><link rel="prefetch" href="/assets/js/236.d6e69fa9.js"><link rel="prefetch" href="/assets/js/237.0392f6c6.js"><link rel="prefetch" href="/assets/js/238.46dc8425.js"><link rel="prefetch" href="/assets/js/239.6f9df60c.js"><link rel="prefetch" href="/assets/js/24.32543ee9.js"><link rel="prefetch" href="/assets/js/240.bae013f7.js"><link rel="prefetch" href="/assets/js/241.c81b66a5.js"><link rel="prefetch" href="/assets/js/242.9296a5c8.js"><link rel="prefetch" href="/assets/js/243.4b16b49b.js"><link rel="prefetch" href="/assets/js/244.f9ee3d4b.js"><link rel="prefetch" href="/assets/js/245.a1a4b62f.js"><link rel="prefetch" href="/assets/js/246.3c7d7878.js"><link rel="prefetch" href="/assets/js/247.03056af4.js"><link rel="prefetch" href="/assets/js/248.cd672886.js"><link rel="prefetch" href="/assets/js/249.4c6c1707.js"><link rel="prefetch" href="/assets/js/25.bd2e359f.js"><link rel="prefetch" href="/assets/js/250.26ffc44a.js"><link rel="prefetch" href="/assets/js/251.85db4e67.js"><link rel="prefetch" href="/assets/js/252.d4febe54.js"><link rel="prefetch" href="/assets/js/253.df2ea5e2.js"><link rel="prefetch" href="/assets/js/254.b8d0d20e.js"><link rel="prefetch" href="/assets/js/255.49c4ec7d.js"><link rel="prefetch" href="/assets/js/256.98014536.js"><link rel="prefetch" href="/assets/js/257.25c9f009.js"><link rel="prefetch" href="/assets/js/258.1ae5e480.js"><link rel="prefetch" href="/assets/js/259.7333eaaf.js"><link rel="prefetch" href="/assets/js/26.dc9e3004.js"><link rel="prefetch" href="/assets/js/260.8edc3b07.js"><link rel="prefetch" href="/assets/js/261.e6ee2a4e.js"><link rel="prefetch" href="/assets/js/262.f248c8c3.js"><link rel="prefetch" href="/assets/js/263.82be0c8f.js"><link rel="prefetch" href="/assets/js/264.55691777.js"><link rel="prefetch" href="/assets/js/265.e346b753.js"><link rel="prefetch" href="/assets/js/266.92dc4b9b.js"><link rel="prefetch" href="/assets/js/267.c32ec0a7.js"><link rel="prefetch" href="/assets/js/268.0b55a11d.js"><link rel="prefetch" href="/assets/js/269.cc1d3112.js"><link rel="prefetch" href="/assets/js/27.f6948f93.js"><link rel="prefetch" href="/assets/js/270.8151a5d3.js"><link rel="prefetch" href="/assets/js/271.7a93b23b.js"><link rel="prefetch" href="/assets/js/272.473c500f.js"><link rel="prefetch" href="/assets/js/273.b9a56533.js"><link rel="prefetch" href="/assets/js/274.e7b60a0c.js"><link rel="prefetch" href="/assets/js/275.2adf8ff0.js"><link rel="prefetch" href="/assets/js/276.9777514a.js"><link rel="prefetch" href="/assets/js/277.c511d92a.js"><link rel="prefetch" href="/assets/js/278.abac46d2.js"><link rel="prefetch" href="/assets/js/279.5f806255.js"><link rel="prefetch" href="/assets/js/28.564c26dd.js"><link rel="prefetch" href="/assets/js/280.b4fa1858.js"><link rel="prefetch" href="/assets/js/281.5c28de7b.js"><link rel="prefetch" href="/assets/js/282.716ae2bd.js"><link rel="prefetch" href="/assets/js/283.39be7d8b.js"><link rel="prefetch" href="/assets/js/284.abc5f110.js"><link rel="prefetch" href="/assets/js/285.65637f3b.js"><link rel="prefetch" href="/assets/js/286.e004360d.js"><link rel="prefetch" href="/assets/js/287.d33c8cd1.js"><link rel="prefetch" href="/assets/js/288.ba9e1859.js"><link rel="prefetch" href="/assets/js/289.f8794ca0.js"><link rel="prefetch" href="/assets/js/29.7aa96265.js"><link rel="prefetch" href="/assets/js/290.eaebdbe2.js"><link rel="prefetch" href="/assets/js/291.bafcfffb.js"><link rel="prefetch" href="/assets/js/292.2a76dceb.js"><link rel="prefetch" href="/assets/js/293.f0ad6ee5.js"><link rel="prefetch" href="/assets/js/294.e6cd28e7.js"><link rel="prefetch" href="/assets/js/295.75c0c32e.js"><link rel="prefetch" href="/assets/js/296.1ba987c7.js"><link rel="prefetch" href="/assets/js/297.df4e6a7c.js"><link rel="prefetch" href="/assets/js/298.aa1d1380.js"><link rel="prefetch" href="/assets/js/299.dfe05cd0.js"><link rel="prefetch" href="/assets/js/3.cce5b785.js"><link rel="prefetch" href="/assets/js/30.c13ddbd0.js"><link rel="prefetch" href="/assets/js/300.19933949.js"><link rel="prefetch" href="/assets/js/301.9fa4f769.js"><link rel="prefetch" href="/assets/js/302.48bb0bca.js"><link rel="prefetch" href="/assets/js/303.60801364.js"><link rel="prefetch" href="/assets/js/304.0ec54d13.js"><link rel="prefetch" href="/assets/js/305.22aeb531.js"><link rel="prefetch" href="/assets/js/306.35173816.js"><link rel="prefetch" href="/assets/js/307.6f9f609e.js"><link rel="prefetch" href="/assets/js/308.69064216.js"><link rel="prefetch" href="/assets/js/309.185a8a53.js"><link rel="prefetch" href="/assets/js/31.e36024e9.js"><link rel="prefetch" href="/assets/js/310.39eacd5b.js"><link rel="prefetch" href="/assets/js/311.94730eab.js"><link rel="prefetch" href="/assets/js/312.372b86fb.js"><link rel="prefetch" href="/assets/js/313.79347503.js"><link rel="prefetch" href="/assets/js/314.df279936.js"><link rel="prefetch" href="/assets/js/315.a4ab6047.js"><link rel="prefetch" href="/assets/js/316.04812ac5.js"><link rel="prefetch" href="/assets/js/317.d4641ea0.js"><link rel="prefetch" href="/assets/js/318.f18535d4.js"><link rel="prefetch" href="/assets/js/319.20dfc68f.js"><link rel="prefetch" href="/assets/js/32.0ee96ddb.js"><link rel="prefetch" href="/assets/js/320.c929eba9.js"><link rel="prefetch" href="/assets/js/321.861a5c0a.js"><link rel="prefetch" href="/assets/js/322.f9e4950e.js"><link rel="prefetch" href="/assets/js/323.59cb4207.js"><link rel="prefetch" href="/assets/js/324.2747c5b1.js"><link rel="prefetch" href="/assets/js/325.b5376734.js"><link rel="prefetch" href="/assets/js/326.73ffe0f8.js"><link rel="prefetch" href="/assets/js/327.33f55ebb.js"><link rel="prefetch" href="/assets/js/328.fdd8e3ef.js"><link rel="prefetch" href="/assets/js/329.cf9000ee.js"><link rel="prefetch" href="/assets/js/33.edbffdcb.js"><link rel="prefetch" href="/assets/js/330.e9eb38bf.js"><link rel="prefetch" href="/assets/js/331.bd442f05.js"><link rel="prefetch" href="/assets/js/332.45c23042.js"><link rel="prefetch" href="/assets/js/333.73153fca.js"><link rel="prefetch" href="/assets/js/334.636199e0.js"><link rel="prefetch" href="/assets/js/335.4d0a6ae8.js"><link rel="prefetch" href="/assets/js/336.97a253e7.js"><link rel="prefetch" href="/assets/js/337.4c9b5efc.js"><link rel="prefetch" href="/assets/js/338.33f94fd1.js"><link rel="prefetch" href="/assets/js/34.4e043e27.js"><link rel="prefetch" href="/assets/js/35.6d49f989.js"><link rel="prefetch" href="/assets/js/36.f5960d39.js"><link rel="prefetch" href="/assets/js/37.74a2a80e.js"><link rel="prefetch" href="/assets/js/38.6269f916.js"><link rel="prefetch" href="/assets/js/39.141e11e0.js"><link rel="prefetch" href="/assets/js/4.64911f15.js"><link rel="prefetch" href="/assets/js/40.1bf4483c.js"><link rel="prefetch" href="/assets/js/41.c347bb50.js"><link rel="prefetch" href="/assets/js/42.e47b1df3.js"><link rel="prefetch" href="/assets/js/43.f7cad0d0.js"><link rel="prefetch" href="/assets/js/44.7a3d1f90.js"><link rel="prefetch" href="/assets/js/45.89306311.js"><link rel="prefetch" href="/assets/js/46.dc47b9d0.js"><link rel="prefetch" href="/assets/js/47.8eed0639.js"><link rel="prefetch" href="/assets/js/48.4f7cbfb6.js"><link rel="prefetch" href="/assets/js/49.e233ecee.js"><link rel="prefetch" href="/assets/js/5.9287b9e3.js"><link rel="prefetch" href="/assets/js/50.1e32c9d8.js"><link rel="prefetch" href="/assets/js/51.5e33bddb.js"><link rel="prefetch" href="/assets/js/52.70a3d801.js"><link rel="prefetch" href="/assets/js/53.82526036.js"><link rel="prefetch" href="/assets/js/54.0fa9bdf5.js"><link rel="prefetch" href="/assets/js/55.ebf4e851.js"><link rel="prefetch" href="/assets/js/56.e488aa6a.js"><link rel="prefetch" href="/assets/js/57.87413c7a.js"><link rel="prefetch" href="/assets/js/58.1c4f47bd.js"><link rel="prefetch" href="/assets/js/59.322d86a2.js"><link rel="prefetch" href="/assets/js/6.a8023fc9.js"><link rel="prefetch" href="/assets/js/60.d473b033.js"><link rel="prefetch" href="/assets/js/61.f8f26d39.js"><link rel="prefetch" href="/assets/js/62.5c5ed58e.js"><link rel="prefetch" href="/assets/js/63.e5abb75c.js"><link rel="prefetch" href="/assets/js/64.a65ce6e6.js"><link rel="prefetch" href="/assets/js/65.dbf5f0c6.js"><link rel="prefetch" href="/assets/js/66.7f4486d3.js"><link rel="prefetch" href="/assets/js/67.0bf55b7c.js"><link rel="prefetch" href="/assets/js/68.990bf5e4.js"><link rel="prefetch" href="/assets/js/69.f4b629ef.js"><link rel="prefetch" href="/assets/js/7.2b62e6bd.js"><link rel="prefetch" href="/assets/js/70.c02ca837.js"><link rel="prefetch" href="/assets/js/71.6ee1373d.js"><link rel="prefetch" href="/assets/js/72.ee903926.js"><link rel="prefetch" href="/assets/js/73.58dba419.js"><link rel="prefetch" href="/assets/js/74.a7d42e7d.js"><link rel="prefetch" href="/assets/js/75.4ffbe225.js"><link rel="prefetch" href="/assets/js/76.f2fcbfcd.js"><link rel="prefetch" href="/assets/js/77.d0c3deb7.js"><link rel="prefetch" href="/assets/js/78.0010c461.js"><link rel="prefetch" href="/assets/js/79.6a70a604.js"><link rel="prefetch" href="/assets/js/8.40ca4fd6.js"><link rel="prefetch" href="/assets/js/80.ae573a8e.js"><link rel="prefetch" href="/assets/js/81.eaf44acc.js"><link rel="prefetch" href="/assets/js/82.e6bb0732.js"><link rel="prefetch" href="/assets/js/83.23310e8c.js"><link rel="prefetch" href="/assets/js/84.54ca505b.js"><link rel="prefetch" href="/assets/js/85.9f70bfbc.js"><link rel="prefetch" href="/assets/js/86.74ddf3fb.js"><link rel="prefetch" href="/assets/js/87.60e01ba5.js"><link rel="prefetch" href="/assets/js/88.1226d6c3.js"><link rel="prefetch" href="/assets/js/89.507975f1.js"><link rel="prefetch" href="/assets/js/9.bce4872d.js"><link rel="prefetch" href="/assets/js/90.f306161d.js"><link rel="prefetch" href="/assets/js/91.3fe96e1e.js"><link rel="prefetch" href="/assets/js/92.bd84fdc8.js"><link rel="prefetch" href="/assets/js/93.0c6dbc9b.js"><link rel="prefetch" href="/assets/js/94.1eec16ff.js"><link rel="prefetch" href="/assets/js/95.84199af6.js"><link rel="prefetch" href="/assets/js/96.3a709dfa.js"><link rel="prefetch" href="/assets/js/97.388f4466.js"><link rel="prefetch" href="/assets/js/98.22f33c4e.js"><link rel="prefetch" href="/assets/js/99.3f832234.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6b2f3ec1.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Jast blog" class="logo"> <span class="site-name can-hide">Jast blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/bigdata/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/ambari/develop/" class="nav-link">《Ambari自定义开发教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/cdh/" class="nav-link">《CDH教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/clickhouse/" class="nav-link">《ClickHouse教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hdfs/" class="nav-link">《HDFS教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/dolphinscheduler/" class="nav-link">《DolphinScheduler教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hbase/" class="nav-link">《Hbase教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/iceberg/" class="nav-link">《Iceberg教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hive/" class="nav-link">《Hive教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/flume/" class="nav-link">《Flume教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/kafka/" class="nav-link">《Kafka教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/impala/" class="nav-link">《Impala教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hue/" class="nav-link">《Hue教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/spark/" class="nav-link">《Spark教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/flink/" class="nav-link">《Flink教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/phoenix/" class="nav-link">《Phoenix教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/elasticsearch/" class="nav-link">《ElasticSearch教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/kylin/" class="nav-link">《Kylin教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/storm/" class="nav-link">《Storm教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/yarn/" class="nav-link">《Yarn教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/presto/" class="nav-link">《Presto教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/graph/" class="nav-link">《图数据库教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/kerberos/" class="nav-link">《Kerberos教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/maxwell/" class="nav-link">《Maxwell教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/minio/" class="nav-link">《MinIO教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/datax/" class="nav-link">《DataX教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/superset/" class="nav-link">《Superset教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/iotdb/" class="nav-link">《IOTDB教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/bigdata/other/" class="nav-link">《大数据相关》笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="人工智能" class="dropdown-title"><a href="/ai/" class="link-title">人工智能</a> <span class="title" style="display:none;">人工智能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/paddlenlp/" class="nav-link">《PaddleNLP教程》笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/yunwei/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">《Nginx教程》笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">《Java技术文档》</a></li><li class="dropdown-item"><!----> <a href="/note/maven/" class="nav-link">《Maven教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/idea/" class="nav-link">《IDEA使用教程》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/head.jpeg"> <div class="blogger-info"><h3>Jast-zsh</h3> <span>如果你知道你要去哪里，全世界都会给你让路。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/bigdata/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/ambari/develop/" class="nav-link">《Ambari自定义开发教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/cdh/" class="nav-link">《CDH教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/clickhouse/" class="nav-link">《ClickHouse教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hdfs/" class="nav-link">《HDFS教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/dolphinscheduler/" class="nav-link">《DolphinScheduler教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hbase/" class="nav-link">《Hbase教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/iceberg/" class="nav-link">《Iceberg教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hive/" class="nav-link">《Hive教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/flume/" class="nav-link">《Flume教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/kafka/" class="nav-link">《Kafka教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/impala/" class="nav-link">《Impala教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/hue/" class="nav-link">《Hue教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/spark/" class="nav-link">《Spark教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/flink/" class="nav-link">《Flink教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/phoenix/" class="nav-link">《Phoenix教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/elasticsearch/" class="nav-link">《ElasticSearch教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/kylin/" class="nav-link">《Kylin教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/storm/" class="nav-link">《Storm教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/yarn/" class="nav-link">《Yarn教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/presto/" class="nav-link">《Presto教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/graph/" class="nav-link">《图数据库教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/kerberos/" class="nav-link">《Kerberos教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/maxwell/" class="nav-link">《Maxwell教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/minio/" class="nav-link">《MinIO教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/datax/" class="nav-link">《DataX教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/superset/" class="nav-link">《Superset教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/iotdb/" class="nav-link">《IOTDB教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/bigdata/other/" class="nav-link">《大数据相关》笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="人工智能" class="dropdown-title"><a href="/ai/" class="link-title">人工智能</a> <span class="title" style="display:none;">人工智能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/paddlenlp/" class="nav-link">《PaddleNLP教程》笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/yunwei/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">《Nginx教程》笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">《Java技术文档》</a></li><li class="dropdown-item"><!----> <a href="/note/maven/" class="nav-link">《Maven教程》笔记</a></li><li class="dropdown-item"><!----> <a href="/note/idea/" class="nav-link">《IDEA使用教程》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/095708/" class="sidebar-link">Flink Standalone集群安装</a></li><li><a href="/pages/4bae1b/" class="sidebar-link">Flink启动脚本</a></li><li><a href="/pages/f2f1f0/" class="sidebar-link">keyBy数据分配计算方法</a></li><li><a href="/pages/90a4bb/" aria-current="page" class="active sidebar-link">Flink流处理高级操作之时间语义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/90a4bb/#时间语义介绍" class="sidebar-link">时间语义介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/90a4bb/#_1-处理时间-processing-time" class="sidebar-link">1. 处理时间(Processing Time)</a></li><li class="sidebar-sub-header level3"><a href="/pages/90a4bb/#_2-事件时间-event-time" class="sidebar-link">2. 事件时间(Event Time)</a></li><li class="sidebar-sub-header level3"><a href="/pages/90a4bb/#_3-摄入时间-ingestion-time" class="sidebar-link">3.摄入时间(Ingestion Time)</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/90a4bb/#水位线-水印-watermark" class="sidebar-link">水位线/水印(Watermark)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/90a4bb/#什么是watermark" class="sidebar-link">什么是Watermark？</a></li><li class="sidebar-sub-header level3"><a href="/pages/90a4bb/#水位线特性" class="sidebar-link">水位线特性</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/90a4bb/#实际代码中应用" class="sidebar-link">实际代码中应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/90a4bb/#无序流应用" class="sidebar-link">无序流应用</a></li><li class="sidebar-sub-header level3"><a href="/pages/90a4bb/#有序流-不常用" class="sidebar-link">有序流(不常用)</a></li></ul></li></ul></li><li><a href="/pages/6ce2ab/" class="sidebar-link">Flink流处理之窗口Window</a></li><li><a href="/pages/481219/" class="sidebar-link">Flink流处理之ProcessFunction</a></li><li><a href="/pages/3977e7/" class="sidebar-link">Chain分隔</a></li><li><a href="/pages/2f6116/" class="sidebar-link">Backpressured详细介绍</a></li><li><a href="/pages/a06987/" class="sidebar-link">Flink消费Kafka</a></li><li><a href="/pages/a5f938/" class="sidebar-link">Flink操作MySQL</a></li><li><a href="/pages/591ad3/" class="sidebar-link">Flink自定义Connector-TableApi SQL</a></li><li><a href="/pages/40d79f/" class="sidebar-link">Flink使用异常处理</a></li><li><a href="/pages/d245fa/" class="sidebar-link">FlinkCDC</a></li><li><a href="/pages/417f48/" class="sidebar-link">LinkageError异常处理</a></li><li><a href="/pages/08d0e0/" class="sidebar-link">Flink日志Log4j发送到Kafka</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E3%80%8AFlink%E6%95%99%E7%A8%8B%E3%80%8B%E7%AC%94%E8%AE%B0" title="分类" data-v-06225672>《Flink教程》笔记</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://datamining.blog.csdn.net/" target="_blank" title="作者" class="beLink" data-v-06225672>Jast-zsh</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Flink流处理高级操作之时间语义<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="流处理高级操作之时间语义"><a href="#流处理高级操作之时间语义" class="header-anchor">#</a> 流处理高级操作之时间语义</h1> <p>[toc]</p> <h2 id="时间语义介绍"><a href="#时间语义介绍" class="header-anchor">#</a> 时间语义介绍</h2> <p>对于一台机器而言，“时间”自然就是指系统时间。但我们知道，Flink 是一个分布式处理 系统。分布式架构最大的特点， 就是节点彼此独立、互不影响，这带来了更高的吞吐量和容错 性；但有利必有弊， 最大的问题也来源于此。</p> <p>在分布式系统中，节点“各自为政”，是没有统一时钟的， 数据和控制信息都通过网络进 行传输。比如现在有一个任务是窗口聚合，我们希望将每个小时的数据收集起来进行统计处理。 而对于并行的窗口子任务，它们所在节点不同，系统时间也会有差异； 当我们希望统计 8  点 ~9 点的数据时，对并行任务来说其实并不是“同时”的， 收集到的数据也会有误差。</p> <p>那既然一个集群中有 JobManager 作为管理者， 是不是让它统一向所有 TaskManager 发送 同步时钟信号就行了呢？ 这也是不行的。因为网络传输会有延迟， 而且这延迟是不确定的， 所 以 JobManager 发出的同步信号无法同时到达所有节点；想要拥有一个全局统一的时钟， 在分 布式系统里是做不到的。</p> <p>另一个麻烦的问题是，在流式处理的过程中， 数据是在不同的节点间不停流动的， 这同样  也会有网络传输的延迟。这样一来， 当上下游任务需要跨节点传输数据时， 它们对于“时间” 的理解也会有所不同。例如， 上游任务在 8 点 59 分 59 秒发出一条数据， 到下游要做窗口计算  时已经是 9 点零 1 秒了， 那这条数据到底该不该被收到 8 点~9 点的窗口呢？</p> <p>所以， 当我们希望对数据按照时间窗口来进行收集计算时，“时间”到底以谁为标准就非 常重要了。</p> <p><img src="https://s2.loli.net/2023/03/10/G6L1ZmUDQWdsbgC.png" alt="image-20220406161349208"></p> <p>我们重新梳理一下流式数据处理的过程。如上图所示， 在事件发生之后， 生成的数据被 收集起来，首先进入分布式消息队列，然后被 Flink 系统中的 Source 算子读取消费，进而向下 游的转换算子（窗口算子）传递，最终由窗口算子进行计算处理。</p> <p>很明显，这里有两个非常重要的时间点： 一个是数据产生的时间， 我们把它叫作“事件时间”（Event Time）；另一个是数据真正被处理的时刻，叫作“处理时间”（Processing Time）。 我们所定义的窗口操作， 到底是以那种时间作为衡量标准，就是所谓的“时间语义”（Notions of Time）。由于分布式系统中网络传输的延迟和时钟漂移，处理时间相对事件发生的时间会有 所滞后。</p> <h3 id="_1-处理时间-processing-time"><a href="#_1-处理时间-processing-time" class="header-anchor">#</a> 1. 处理时间(Processing Time)</h3> <p>处理时间的概念非常简单，就是指执行处理操作的机器的系统时间。</p> <p>如果我们以它作为衡量标准，那么数据属于哪个窗口就很明显了： 只看窗口任务处理这条 数据时，当前的系统时间。比如之前举的例子，数据 8 点 59 分 59 秒产生， 而窗口计算时的时 间是 9 点零 1 秒，那么这条数据就属于 9 点—10 点的窗口；如果数据传输非常快， 9 点之前就 到了窗口任务，那么它就属于 8 点—9 点的窗口了。每个并行的窗口子任务，就只按照自己的 系统时钟划分窗口。假如我们在早上 8 点 10 分启动运行程序， 那么接下来一直到 9 点以前处 理的所有数据， 都属于第一个窗口； 9 点之后、10 点之前的所有数据就将属于第二个窗口。</p> <p>这种方法非常简单粗暴，不需要各个节点之间进行协调同步，也不需要考虑数据在流中的 位置， 简单来说就是“我的地盘听我的”。所以处理时间是最简单的时间语义。</p> <h3 id="_2-事件时间-event-time"><a href="#_2-事件时间-event-time" class="header-anchor">#</a> 2. 事件时间(Event Time)</h3> <p>事件时间， 是指每个事件在对应的设备上发生的时间，也就是数据生成的时间。</p> <p>数据一旦产生， 这个时间自然就确定了， 所以它可以作为一个属性嵌入到数据中。这其实 就是这条数据记录的“时间戳”（Timestamp）。</p> <p>在事件时间语义下，我们对于时间的衡量，就不看任何机器的系统时间了， 而是依赖于数 据本身。打个比方， 这相当于任务处理的时候自己本身是没有时钟的，所以只好来一个数据就 问一下“现在几点了”；而数据本身也没有表， 只有一个自带的“出厂时间”，于是任务就基于这 个时间来确定自己的时钟。由于流处理中数据是源源不断产生的， 一般来说， 先产生的数据也 会先被处理，所以当任务不停地接到数据时， 它们的时间戳也基本上是不断增长的，就可以代 表时间的推进。</p> <p>当然我们会发现，这里有个前提，就是“先产生的数据先被处理”，这要求我们可以保证 数据到达的顺序。但是由于分布式系统中网络传输延迟的不确定性，实际应用中我们要面对的 数据流往往是乱序的。在这种情况下，就不能简单地把数据自带的时间戳当作时钟了， 而需要 用另外的标志来表示事件时间进展，在 Flink 中把它叫作事件时间的“水位线”（Watermarks）。 关于水位线的概念和用法，我们会稍后介绍。</p> <h3 id="_3-摄入时间-ingestion-time"><a href="#_3-摄入时间-ingestion-time" class="header-anchor">#</a> 3.摄入时间(Ingestion Time)</h3> <p>TODO 待补充</p> <h2 id="水位线-水印-watermark"><a href="#水位线-水印-watermark" class="header-anchor">#</a> 水位线/水印(Watermark)</h2> <p>在介绍事件时间语义时， 我们提到了“水位线”的概念， 已经知道了它其实就是用来度量 事件时间的。那么水位线具体有什么含义，又跟数据的时间戳有什么关系呢？接下来我们就来 深入探讨一下这个流处理中的核心概念。</p> <p>在实际应用中， 一般会采用事件时间语义。而水位线， 就是基于事件时间提出的概念。所 以在介绍水位线之前，我们首先来梳理一下事件时间和窗口的关系。</p> <p>一个数据产生的时刻，就是流处理中事件触发的时间点， 这就是“事件时间”，一般都会以时间戳的形式作为一个字段记录在数据里。这个时间就像商品的“生产日期”一样， 一旦产 生就是固定的， 印在包装袋上， 不会因为运输辗转而变化。如果我们想要统计一段时间内的数 据，需要划分时间窗口， 这时只要判断一下时间戳就可以知道数据属于哪个窗口了。</p> <p>明确了一个数据的所属窗口， 还不能直接进行计算。因为窗口处理的是有界数据， 我们需 要等窗口的数据都到齐了，才能计算出最终的统计结果。那什么时候数据就都到齐了呢？对于 时间窗口来说这很明显： 到了窗口的结束时间，自然就应该收集到了所有数据， 就可以触发计 算输出结果了。比如我们想统计 8 点~9 点的用户点击量， 那就是从 8 点开始收集数据， 到 9 点截止，将收集的数据做处理计算。这有点类似于班车， 每小时发一班，那么 8 点之后来的人都会上同一班车，到 9 点钟准时发车； 9 点之后来的人，就只好等下一班 10 点发的车了。</p> <p>当然， 我们现在处理的数据本身是有时间戳的。所以为了更清楚地解释，我们将“赶班车” 这个例子中的人，换成带着生产日期的商品。所以现在我们班车的主要任务是运送货物，一辆  车就只装载 1 小时内生产出的所有商品，货到齐了就发车。比如某辆车要装的是 8 点到 9 点的  所有商品，那货什么时候到齐呢？ 自然可以想到，到 9 点钟的时候商品就到齐了，可以发车了。</p> <p>这里的关键问题是，“9 点钟发车”，到底是看谁的表来定时间？</p> <p>在处理时间语义下，都是以当前任务所在节点的系统时间为准的。这就相当于每辆车里都 挂了一个钟，司机看到到了 9 点就直接发车。这种方式简单粗暴容易实现， 但因为车上的钟是 独立运行的，以它为标准就不能准确地判断商品的生产时间。在分布式环境下， 这样会因为网 络传输延迟的不确定而导致误差。比如有些商品在 8 点 59 分 59 秒生产出来，可是从下生产线 到运至车上又要花费几秒，那就赶不上 9  点钟这班车了。而且现在分布式系统中有很多辆 9 点发的班车，所以同时生产出的一批商品，需要平均分配到不同班车上，可这些班车距离有近 有远、上面挂的钟有快有慢， 这就可能导致有些商品上车了、有些却被漏掉；先后生产出的商 品，到达车上的顺序也可能乱掉：统计结果的正确性受到了影响。</p> <p>所以在实际中我们往往需要以事件时间为准。如果考虑事件时间， 情况就复杂起来了。现 在不能直接用每辆车上挂的钟（系统时间），又没有统一的时钟，那该怎么确定发车时间呢？</p> <p>现在能利用的， 就只有商品的生产时间（数据的时间戳） 了。我们可以这样思考： 一般情 况下， 商品生产出来之后，就会立即传送到车上； 所以商品到达车上的时间（系统时间） 应该稍稍滞后于商品的生产时间（数据时间戳）。如果不考虑传输过程的一点点延迟，我们就可以 直接用商品生产时间来表示当前车上的时间了。如下图所示， 到达车上的商品， 生产时间是 8 点 05 分，那么当前车上的时间就是 8 点 05 分； 又来了一个 8 点 10 分生产的商品， 现在车 上的时间就是 8 点 10 分。我们直接用数据的时间戳来指示当前的时间进展， 窗口的关闭自然 也是以数据的时间戳等于窗口结束时间为准，这就相当于可以不受网络传输延迟的影响了。像之前所说 8 点 59 分 59 秒生产出来的商品，到车上的时候不管实际时间（系统时间）是几点， 我们就认为当前是 8 点 59 分 59 秒， 所以它总是能赶上车的；而 9 点这班车， 要等到 9 点整生 产的商品到来， 才认为时间到了 9 点，这时才正式发车。这样就可以得到正确的统计结果了。</p> <p><img src="https://s2.loli.net/2023/03/10/K6O3WBGmUlJzvIE.png" alt="image-20220406163239807"></p> <p>在这个处理过程中， 我们其实是基于数据的时间戳，自定义了一个“逻辑时钟”。这个时 钟的时间不会自动流逝； 它的时间进展， 就是靠着新到数据的时间戳来推动的。这样的好处在于计算的过程可以完全不依赖处理时间（系统时间），不论什么时候进行统计处理，得到的 结果都是正确的。比如双十一的时候系统处理压力大，我们可能会把大量数据缓存在 Kafka 中； 过了高峰时段之后再读取出来， 在几秒之内就可以处理完几个小时甚至几天的数据，而且 依然可以按照数据产生的时间段进行统计，所有窗口都能收集到正确的数据。而一般实时流处 理的场景中，事件时间可以基本与处理时间保持同步， 只是略微有一点延迟， 同时保证了窗口计算的正确性。</p> <h3 id="什么是watermark"><a href="#什么是watermark" class="header-anchor">#</a> 什么是Watermark？</h3> <p>在事件时间语义下，我们不依赖系统时间，而是基于数据自带的时间戳去定义了一个时钟， 用来表示当前时间的进展。于是每个并行子任务都会有一个自己的逻辑时钟，它的前进是靠数 据的时间戳来驱动的。</p> <p>但在分布式系统中，这种驱动方式又会有一些问题。因为数据本身在处理转换的过程中会 变化， 如果遇到窗口聚合这样的操作，其实是要攒一批数据才会输出一个结果， 那么下游的数 据就会变少，时间进度的控制就不够精细了。另外，数据向下游任务传递时，一般只能传输给 一个子任务（除广播外），这样其他的并行子任务的时钟就无法推进了。例如一个时间戳为 9点整的数据到来，当前任务的时钟就已经是 9 点了；处理完当前数据要发送到下游，如果下游 任务是一个窗口计算，并行度为 3，那么接收到这个数据的子任务，时钟也会进展到 9 点， 9 点结束的窗口就可以关闭进行计算了；而另外两个并行子任务则时间没有变化，不能进行窗口 计算。</p> <p>所以我们应该把时钟也以数据的形式传递出去，告诉下游任务当前时间的进展；而且这个 时钟的传递不会因为窗口聚合之类的运算而停滞。一种简单的想法是，在数据流中加入一个时 钟标记，记录当前的事件时间； 这个标记可以直接广播到下游，当下游任务收到这个标记， 就 可以更新自己的时钟了。由于类似于水流中用来做标志的记号，在 Flink 中， 这种用来衡量事 件时间（Event Time）进展的标记，就被称作“水位线”（Watermark）。</p> <p>具体实现上，水位线可以看作一条特殊的数据记录，它是插入到数据流中的一个标记点， 主要内容就是一个时间戳，用来指示当前的事件时间。而它插入流中的位置， 就应该是在某个 数据到来之后； 这样就可以从这个数据中提取时间戳，作为当前水位线的时间戳了</p> <p><img src="https://s2.loli.net/2023/03/10/QCIiOHjDgu6ELyr.png" alt="image-20220406163707752"></p> <p>如图所示， 每个事件产生的数据，都包含了一个时间戳， 我们直接用一个整数表示。 这里没有指定单位， 可以理解为秒或者毫秒（方便起见， 下面讲述统一认为是秒）。当产生于 2 秒的数据到来之后，当前的事件时间就是 2 秒； 在后面插入一个时间戳也为 2 秒的水位线， 随着数据一起向下游流动。而当 5 秒产生的数据到来之后，同样在后面插入一个水位线，时间 戳也为 5，当前的时钟就推进到了 5 秒。这样，如果出现下游有多个并行子任务的情形，我们 只要将水位线广播出去， 就可以通知到所有下游任务当前的时间进度了。</p> <p>水位线就像它的名字所表达的， 是数据流中的一部分， 随着数据一起流动， 在不同任务之 间传输。这看起来非常简单；接下来我们就进一步探讨一些复杂的状况。</p> <p><strong>(1) 有序流中的水位线</strong></p> <p>在理想状态下， 数据应该按照它们生成的先后顺序、排好队进入流中； 也就是说， 它们处 理的过程会保持原先的顺序不变，遵守先来后到的原则。这样的话我们从每个数据中提取时间 戳， 就可以保证总是从小到大增长的，从而插入的水位线也会不断增长、事件时钟不断向前推 进。</p> <p>实际应用中，如果当前数据量非常大，可能会有很多数据的时间戳是相同的，这时每来一 条数据就提取时间戳、插入水位线就做了大量的无用功。而且即使时间戳不同， 同时涌来的数 据时间差会非常小（比如几毫秒），往往对处理计算也没什么影响。所以为了提高效率， 一般 会每隔一段时间生成一个水位线，这个水位线的时间戳，就是当前最新数据的时间戳， 如图 6-6 所示。所以这时的水位线，其实就是有序流中的一个周期性出现的时间标记。</p> <p><img src="https://s2.loli.net/2023/03/10/5reFzdJDwBn8TGp.png" alt="image-20220406163735913"></p> <p>这里需要注意的是， 水位线插入的“周期”，本身也是一个时间概念。在当前事件时间语 义下， 假如我们设定了每隔 100ms 生成一次水位线，那就是要等事件时钟推进 100ms 才能插 入； 但是事件时钟本身的进展， 本身就是靠水位线来表示的——现在要插入一个水位线，可前 提又是水位线要向前推进 100ms，这就陷入了死循环。所以对于水位线的周期性生成，周期时 间是指处理时间（系统时间），而不是事件时间。</p> <p><strong>(2) 乱序流中的水位线</strong></p> <p>有序流的处理非常简单，看起来水位线也并没有起到太大的作用。但这种情况只存在于理 想状态下。我们知道在分布式系统中，数据在节点间传输，会因为网络传输延迟的不确定性， 导致顺序发生改变， 这就是所谓的“乱序数据”。</p> <p>这里所说的“乱序”（out-of-order），是指数据的先后顺序不一致，主要就是基于数据的产 生时间而言的。如图所示，一个 7 秒时产生的数据，生成时间自然要比 9 秒的数据早；但 是经过数据缓存和传输之后，处理任务可能先收到了 9 秒的数据，之后 7 秒的数据才姗姗来迟。 这时如果我们希望插入水位线， 来指示当前的事件时间进展， 又该怎么做呢？</p> <p><img src="https://s2.loli.net/2023/03/10/SpZ9V6k3wTWeEKr.png" alt="image-20220406163810009"></p> <p>最直观的想法自然是跟之前一样，我们还是靠数据来驱动，每来一个数据就提取它的时间 戳、插入一个水位线。不过现在的情况是数据乱序，所以有可能新的时间戳比之前的还小， 如 果直接将这个时间的水位线再插入， 我们的“时钟”就回退了——水位线就代表了时钟， 时光 不能倒流， 所以水位线的时间戳也不能减小。</p> <p>解决思路也很简单： 我们插入新的水位线时， 要先判断一下时间戳是否比之前的大，否则 就不再生成新的水位线，如下图所示。也就是说，只有数据的时间戳比当前时钟大，才能推 动时钟前进，这时才插入水位线。</p> <p><img src="https://s2.loli.net/2023/03/10/Ece4HL2WIkbFoTJ.png" alt="image-20220406163821800"></p> <p>如果考虑到大量数据同时到来的处理效率，我们同样可以周期性地生成水位线。这时只需 要保存一下之前所有数据中的最大时间戳，需要插入水位线时，就直接以它作为时间戳生成新 的水位线，如下图所示。</p> <p><img src="https://s2.loli.net/2023/03/10/zREdQFyUmCvIP78.png" alt="image-20220406163836952"></p> <p>这样做尽管可以定义出一个事件时钟，却也会带来一个非常大的问题：我们无法正确处理 “迟到”的数据。在上面的例子中，当 9 秒产生的数据到来之后，我们就直接将时钟推进到了 9 秒；如果有一个窗口结束时间就是 9 秒（比如， 要统计 0~9 秒的所有数据），那么这时窗口 就应该关闭、将收集到的所有数据计算输出结果了。但事实上，由于数据是乱序的，还可能有 时间戳为 7 秒、 8 秒的数据在 9 秒的数据之后才到来，这就是“迟到数据”（late  data）。它们 本来也应该属于 0~9 秒这个窗口，但此时窗口已经关闭， 于是这些数据就被遗漏了，这会导 致统计结果不正确。</p> <p>如果用之前我们类比班车的例子，现在的状况就是商品不是按照生产时间顺序到来的，所 以有可能出现这种情况： 9 点生产的商品已经到了，我们认为已经到了 9 点，所以直接发车； 但是可能还会有 8 点 59 分 59 秒生产的商品迟到了，没有赶上这班车。那怎么解决这个问题呢？</p> <p>其实我们有很多生活中的经验。假如是一个团队出去团建，那肯定希望每个人都不能落下； 如果有人因为堵车没能准时到车上， 我们可以稍微等一会儿。9 点发车， 我们可以等到 9 点 10 分， 等人都到齐了再出发。当然，实际应用的网络环境不可能跟北京的交通一样堵，所以不需 要等那么久，或许只要等一两秒钟就可以了。具体在商品班车的例子里，我们可以多等 2 秒钟， 也就是当生产时间为 9 点零 2 秒的商品到达，时钟推进到 9 点零 2 秒，这时就认为所有 8 点到 9 点生产的商品都到齐了，可以正式发车。不过这样相当于更改了发车时间，属于“违规操作”。 为了做到形式上仍然是 9 点发车，我们可以更改一下时钟推进的逻辑： 当一个商品到达时， 不 要直接用它的生产时间作为当前时间，而是减上两秒，这就相当于把车上的逻辑时钟调慢了。 这样一来， 当 9 点生产的商品到达时，我们当前车上的时间是 8 点 59 分 58 秒， 还没到发车时 间； 当 9 点零 2 秒生产的商品到达时，车上时间刚好是 9 点， 这时该到的商品都到齐了，准时 发车就没问题了。</p> <p>回到上面的例子，为了让窗口能够正确收集到迟到的数据，我们也可以等上 2 秒； 也就是 用当前已有数据的最大时间戳减去 2 秒， 就是要插入的水位线的时间戳，如下图所示。这 样的话，9 秒的数据到来之后， 事件时钟不会直接推进到9 秒，而是进展到了7 秒；必须等到 11 秒的数据到来之后， 事件时钟才会进展到 9 秒，这时迟到数据也都已收集齐， 0~9 秒的窗 口就可以正确计算结果了。</p> <p><img src="https://s2.loli.net/2023/03/10/nDtuwCN1plh6o2M.png" alt="image-20220406163914481"></p> <p>如果仔细观察就会看到， 这种“等 2 秒”的策略其实并不能处理所有的乱序数据。比如 22 秒的数据到来之后， 插入的水位线时间戳为 20，也就是当前时钟已经推进到了 20 秒； 对于 10~20 秒的窗口， 这时就该关闭了。但是之后又会有 17 秒的迟到数据到来， 它本来应该属于 10~20 秒窗口，现在却被遗漏丢弃了。那又该怎么办呢？</p> <p>既然现在等 2 秒还是等不到 17 秒产生的迟到数据，那自然我们可以试着多等几秒， 也就 是把时钟调得更慢一些。最终的目的，就是要让窗口能够把所有迟到数据都收进来，得到正确 的计算结果。对应到水位线上， 其实就是要保证， 当前时间已经进展到了这个时间戳， 在这之 后不可能再有迟到数据来了。</p> <p>下面是一个示例，我们可以使用周期性的方式生成正确的水位线。</p> <p><img src="https://s2.loli.net/2023/03/10/A4S5u3kBWD1tof8.png" alt="image-20220406163933358"></p> <p>如上图所示， 第一个水位线时间戳为 7，它表示当前事件时间是 7 秒， 7 秒之前的数据 都已经到齐，之后再也不会有了；同样，第二个、第三个水位线时间戳分别为 12 和20，表示 11 秒、 20 秒之前的数据都已经到齐， 如果有对应的窗口就可以直接关闭了， 统计的结果一定 是正确的。这里由于水位线是周期性生成的，所以插入的位置不一定是在时间戳最大的数据后 面。</p> <p>另外需要注意的是， 这里一个窗口所收集的数据， 并不是之前所有已经到达的数据。因为 数据属于哪个窗口，是由数据本身的时间戳决定的，一个窗口只会收集真正属于它的那些数据。 也就是说， 上图中尽管水位线 W(20)之前有时间戳为 22 的数据到来，10~20 秒的窗口中也不 会收集这个数据，进行计算依然可以得到正确的结果。关于窗口的原理， 我们会在后面继续展 开讲解。</p> <h3 id="水位线特性"><a href="#水位线特性" class="header-anchor">#</a> 水位线特性</h3> <p>现在我们可以知道，水位线就代表了当前的事件时间时钟，而且可以在数据的时间戳基础 上加一些延迟来保证不丢数据， 这一点对于乱序流的正确处理非常重要。</p> <p>我们可以总结一下水位线的特性：</p> <ul><li><p>水位线是插入到数据流中的一个标记，可以认为是一个特殊的数据</p></li> <li><p>水位线主要的内容是一个时间戳，用来表示当前事件时间的进展</p></li> <li><p>水位线是基于数据的时间戳生成的</p></li> <li><p>水位线的时间戳必须单调递增， 以确保任务的事件时间时钟一直向前推进</p></li> <li><p>水位线可以通过设置延迟，来保证正确处理乱序数据</p></li> <li><p>一个水位线 Watermark(t)，表示在当前流中事件时间已经达到了时间戳 t, 这代表 t 之 前的所有数据都到齐了， 之后流中不会出现时间戳 t’ ≤ t 的数据</p></li> <li><p>水位线是 Flink 流处理中保证结果正确性的核心机制，它往往会跟窗口一起配合， 完成对乱序数据的正确处理。关于这部分内容， 我们会稍后进一步展开讲解。</p></li></ul> <h2 id="实际代码中应用"><a href="#实际代码中应用" class="header-anchor">#</a> 实际代码中应用</h2> <p>在 Flink   的 DataStream  API   中 ， 有 一 个 单 独 用 于 生 成 水 位 线 的 方</p> <p>法：<code>.assignTimestampsAndWatermarks()</code>，它主要用来为流中的数据分配时间戳，并生成水位线 来指示事件时间：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">assignTimestampsAndWatermarks</span><span class="token punctuation">(</span> <span class="token class-name">WatermarkStrategy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> watermarkStrategy<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>具体使用时，直接用 DataStream 调用该方法即可，与普通的 transform 方法完全一样。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClickSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> withTimestampsAndWatermarks <span class="token operator">=</span>
stream<span class="token punctuation">.</span><span class="token function">assignTimestampsAndWatermarks</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>watermark strategy<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里读者可能有疑惑：不是说数据里已经有时间戳了吗， 为什么这里还要“分配”呢？这是 因为原始的时间戳只是写入日志数据的一个字段，如果不提取出来并明确把它分配给数据， Flink 是无法知道数据真正产生的时间的。 当然，有些时候数据源本身就提供了时间戳信息， 比如读取 Kafka 时，我们就可以从 Kafka 数据中直接获取时间戳， 而不需要单独提取字段分配 了。</p> <p><code>.assignTimestampsAndWatermarks()</code>方法需要传入一个<code>WatermarkStrategy</code>  作为参数，这就 是 所 谓 的 “ 水 位 线 生 成 策 略 ” 。 <code>WatermarkStrategy</code>  中 包 含 了 一 个 “ 时 间 戳 分 配 器”TimestampAssigner 和一个“水位线生成器”<code>WatermarkGenerator</code>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WatermarkStrategy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">TimestampAssignerSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">WatermarkGeneratorSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

<span class="token annotation punctuation">@Override</span>
<span class="token class-name">TimestampAssigner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">createTimestampAssigner</span><span class="token punctuation">(</span><span class="token class-name">TimestampAssignerSupplier<span class="token punctuation">.</span>Context</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token annotation punctuation">@Override</span>
<span class="token class-name">WatermarkGenerator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">createWatermarkGenerator</span><span class="token punctuation">(</span><span class="token class-name">WatermarkGeneratorSupplier<span class="token punctuation">.</span>Context</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>TimestampAssigner：主要负责从流中数据元素的某个字段中提取时间戳，并分配给 元素。时间戳的分配是生成水位线的基础。</p></li> <li><p>WatermarkGenerator ：主要负责按照既定的方式， 基于时间戳生成水位线。在 WatermarkGenerator 接口中，主要又有两个方法：onEvent()和 onPeriodicEmit()。</p></li> <li><p>onEvent：每个事件（数据）到来都会调用的方法， 它的参数有当前事件、时间戳， 以及允许发出水位线的一个 WatermarkOutput，可以基于事件做各种操作</p></li> <li><p>onPeriodicEmit：周期性调用的方法， 可以由 WatermarkOutput 发出水位线。周期时间 为处理时间，可以调用环境配置的.setAutoWatermarkInterval()方法来设置，默认为 200ms。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>env<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoWatermarkInterval</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="无序流应用"><a href="#无序流应用" class="header-anchor">#</a> 无序流应用</h3> <p>设置<code>Watermark</code>延迟时间为5秒，逗号分隔取第一个字段为<strong>事件时间</strong>(时间戳)字段</p> <ul><li>Flink 1.9</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">socketTextStream</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">assignTimestampsAndWatermarks</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">BoundedOutOfOrdernessTimestampExtractor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">seconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//将数据中的时间字段提取出来，然后转成long类型</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">extractTimestamp</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>Flink 1.13</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">socketTextStream</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">assignTimestampsAndWatermarks</span><span class="token punctuation">(</span>
                        <span class="token comment">// 针对乱序流插入水位线，延迟时间设置为 5s</span>
                        <span class="token class-name">WatermarkStrategy</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token function">forBoundedOutOfOrderness</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">withTimestampAssigner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SerializableTimestampAssigner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token annotation punctuation">@Override</span>
                                    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">extractTimestamp</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">long</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="有序流-不常用"><a href="#有序流-不常用" class="header-anchor">#</a> 有序流(不常用)</h3> <ul><li>Flink 1.13</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">socketTextStream</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">assignTimestampsAndWatermarks</span><span class="token punctuation">(</span>
                <span class="token class-name">WatermarkStrategy</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token function">forMonotonousTimestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">withTimestampAssigner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SerializableTimestampAssigner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">extractTimestamp</span><span class="token punctuation">(</span><span class="token class-name">String</span> element<span class="token punctuation">,</span> <span class="token keyword">long</span> recordTimestamp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                       <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/03/10, 16:57:29</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f2f1f0/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">keyBy数据分配计算方法</div></a> <a href="/pages/6ce2ab/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Flink流处理之窗口Window</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/f2f1f0/" class="prev">keyBy数据分配计算方法</a></span> <span class="next"><a href="/pages/6ce2ab/">Flink流处理之窗口Window</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/072cb2/"><div>
            TODO-Clickhouse-Explain查看执行计划
            <!----></div></a> <span class="date">07-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/f4e4dc/"><div>
            Ambari自定义服务开发-metainfo详细介绍
            <!----></div></a> <span class="date">07-01</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4983ce/"><div>
            IoTDB服务安装教程-单机版
            <!----></div></a> <span class="date">07-01</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:745925668@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://datamining.blog.csdn.net/" title="CSDN" target="_blank" class="iconfont icon-csdn"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2016-2025
    <span><a href="https://datamining.blog.csdn.net/">Jast-zsh</a> | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.a5c64990.js" defer></script><script src="/assets/js/2.9cc65402.js" defer></script><script src="/assets/js/183.4f593acd.js" defer></script>
  </body>
</html>
